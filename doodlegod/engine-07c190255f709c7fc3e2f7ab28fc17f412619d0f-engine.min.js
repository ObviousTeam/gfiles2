/**@license
* Solpeo Engine
* v1.5.0-beta2
* Copyright (c) 2009-2014 Solpeo Global sp. z o.o.
* http://www.solpeo.com
* 
* The following description of key terms of the License Agreement is for
* information only and shall not be understood to replace the full version of the
* license which is available at:
* http://cdn.solpeo.com/engine/solpeo-engine-license-v2.0.txt
* Prior to commencing use of a licensed work, please read all the terms of the
* License Agreement carefully.
* 
* 
* The License is granted by Solpeo Global Sp. z o.o. with registered office in
* Kraków, Poland, for use of a computer game engine under the name
* Solpeo Engine in accordance with its intended purpose, and for
* modifications, in each case for own use only and provided that Solpeo’s sign is
* placed in a prominent place.
* 
* This License is non-exclusive, and no limits apply to its term and territorial
* coverage.
* 
* The License is granted free of charge, and it takes effect as soon as the
* Software is copied for the first time (downloaded from Solpeo’s website).
* 
* The License does not authorise its holder to use the game engine in
* contravention of its intended purpose or the terms of the License, including by
* making it available to third parties whether in the original or adapted version
* (regardless of the extent of modifications).
* 
* Solpeo Global Sp. z o.o. with registered office in Kraków shall not accept any
* liability for lack of fitness of the game engine for a particular purpose, or
* for the consequences of using the Software or using any modified versions
* thereof.
* 
**/
/* This product includes certain free/open source software.
Terms of the licenses, disclaimers acknowledgements and
notices are reproduced in comments below */

/*!{id:msgpack.codec.js,ver:1.05,license:"MIT",author:"uupaa.js@gmail.com"}*/


(function(exports){"use strict";if(!GLMAT_EPSILON){var GLMAT_EPSILON=1e-6}if(!GLMAT_ARRAY_TYPE){var GLMAT_ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array}if(!GLMAT_RANDOM){var GLMAT_RANDOM=Math.random}var glMatrix={};glMatrix.setMatrixArrayType=function(type){GLMAT_ARRAY_TYPE=type};if(typeof exports!=="undefined"){exports.glMatrix=glMatrix}var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree};var vec2={};vec2.create=function(){var out=new GLMAT_ARRAY_TYPE(2);out[0]=0;out[1]=0;return out};vec2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out};vec2.fromValues=function(x,y){var out=new GLMAT_ARRAY_TYPE(2);out[0]=x;out[1]=y;return out};vec2.copy=function(out,a){out[0]=a[0];out[1]=a[1];return out};vec2.set=function(out,x,y){out[0]=x;out[1]=y;return out};vec2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out};vec2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out};vec2.sub=vec2.subtract;vec2.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out};vec2.mul=vec2.multiply;vec2.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out};vec2.div=vec2.divide;vec2.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out};vec2.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out};vec2.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out};vec2.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out};vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};vec2.dist=vec2.distance;vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};vec2.len=vec2.length;vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];return out};vec2.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];return out};vec2.normalize=function(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out};vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};vec2.cross=function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out};vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out};vec2.random=function(out,scale){scale=scale||1;var r=GLMAT_RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out};vec2.transformMat2=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out};vec2.transformMat2d=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out};vec2.transformMat3=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out};vec2.transformMat4=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out};vec2.forEach=function(){var vec=vec2.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=2}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}}();vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};if(typeof exports!=="undefined"){exports.vec2=vec2}var vec3={};vec3.create=function(){var out=new GLMAT_ARRAY_TYPE(3);out[0]=0;out[1]=0;out[2]=0;return out};vec3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.fromValues=function(x,y,z){var out=new GLMAT_ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out};vec3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.set=function(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out};vec3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out};vec3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out};vec3.sub=vec3.subtract;vec3.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out};vec3.mul=vec3.multiply;vec3.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out};vec3.div=vec3.divide;vec3.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out};vec3.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out};vec3.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out};vec3.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out};vec3.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.dist=vec3.distance;vec3.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z};vec3.sqrDist=vec3.squaredDistance;vec3.length=function(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.len=vec3.length;vec3.squaredLength=function(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z};vec3.sqrLen=vec3.squaredLength;vec3.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out};vec3.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];return out};vec3.normalize=function(out,a){var x=a[0],y=a[1],z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.cross=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out};vec3.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out};vec3.random=function(out,scale){scale=scale||1;var r=GLMAT_RANDOM()*2*Math.PI;var z=GLMAT_RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=Math.sin(r)*zScale;out[2]=z*scale;return out};vec3.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out};vec3.transformMat3=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out};vec3.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec3.rotateX=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c);r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateY=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c);r[1]=p[1];r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateZ=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c);r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.forEach=function(){var vec=vec3.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=3}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}}();vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};if(typeof exports!=="undefined"){exports.vec3=vec3}var vec4={};vec4.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out};vec4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.fromValues=function(x,y,z,w){var out=new GLMAT_ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.set=function(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};vec4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};vec4.sub=vec4.subtract;vec4.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out};vec4.mul=vec4.multiply;vec4.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out};vec4.div=vec4.divide;vec4.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out};vec4.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out};vec4.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};vec4.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};vec4.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.dist=vec4.distance;vec4.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w};vec4.sqrDist=vec4.squaredDistance;vec4.length=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.len=vec4.length;vec4.squaredLength=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w};vec4.sqrLen=vec4.squaredLength;vec4.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out};vec4.inverse=function(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];out[3]=1/a[3];return out};vec4.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len;out[3]=a[3]*len}return out};vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};vec4.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out};vec4.random=function(out,scale){scale=scale||1;out[0]=GLMAT_RANDOM();out[1]=GLMAT_RANDOM();out[2]=GLMAT_RANDOM();out[3]=GLMAT_RANDOM();vec4.normalize(out,out);vec4.scale(out,out,scale);return out};vec4.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out};vec4.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec4.forEach=function(){var vec=vec4.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=4}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}}();vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof exports!=="undefined"){exports.vec4=vec4}var mat2={};mat2.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.transpose=function(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out};mat2.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;if(!det){return null}det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out};mat2.adjoint=function(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out};mat2.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};mat2.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out};mat2.mul=mat2.multiply;mat2.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out};mat2.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out};mat2.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};mat2.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};mat2.LDU=function(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U]};if(typeof exports!=="undefined"){exports.mat2=mat2}var mat2d={};mat2d.create=function(){var out=new GLMAT_ARRAY_TYPE(6);out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.clone=function(a){var out=new GLMAT_ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.invert=function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out};mat2d.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};mat2d.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out};mat2d.mul=mat2d.multiply;mat2d.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out};mat2d.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out};mat2d.translate=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out};mat2d.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};mat2d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};if(typeof exports!=="undefined"){exports.mat2d=mat2d}var mat3={};mat3.create=function(){var out=new GLMAT_ARRAY_TYPE(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat4=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out};mat3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out};mat3.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out};mat3.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out};mat3.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out};mat3.mul=mat3.multiply;mat3.translate=function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out};mat3.rotate=function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out};mat3.scale=function(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromMat2d=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out};mat3.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out};mat3.normalFromMat4=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out};mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};if(typeof exports!=="undefined"){exports.mat3=mat3}var mat4={};mat4.create=function(){var out=new GLMAT_ARRAY_TYPE(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out};mat4.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out};mat4.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return out};mat4.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out};mat4.mul=mat4.multiply;mat4.translate=function(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out};mat4.scale=function(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.rotate=function(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<GLMAT_EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out};mat4.rotateX=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out};mat4.rotateY=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out};mat4.rotateZ=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out};mat4.fromRotationTranslation=function(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.frustum=function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out};mat4.perspective=function(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out};mat4.ortho=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out};mat4.lookAt=function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<GLMAT_EPSILON&&Math.abs(eyey-centery)<GLMAT_EPSILON&&Math.abs(eyez-centerz)<GLMAT_EPSILON){return mat4.identity(out)}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out};mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"
};mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};if(typeof exports!=="undefined"){exports.mat4=mat4}var quat={};quat.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.rotationTo=function(){var tmpvec3=vec3.create();var xUnitVec3=vec3.fromValues(1,0,0);var yUnitVec3=vec3.fromValues(0,1,0);return function(out,a,b){var dot=vec3.dot(a,b);if(dot<-.999999){vec3.cross(tmpvec3,xUnitVec3,a);if(vec3.length(tmpvec3)<1e-6)vec3.cross(tmpvec3,yUnitVec3,a);vec3.normalize(tmpvec3,tmpvec3);quat.setAxisAngle(out,tmpvec3,Math.PI);return out}else if(dot>.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{vec3.cross(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return quat.normalize(out,out)}}}();quat.setAxes=function(){var matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return quat.normalize(out,quat.fromMat3(out,matr))}}();quat.clone=vec4.clone;quat.fromValues=vec4.fromValues;quat.copy=vec4.copy;quat.set=vec4.set;quat.identity=function(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.setAxisAngle=function(out,axis,rad){rad=rad*.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out};quat.add=vec4.add;quat.multiply=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out};quat.mul=quat.multiply;quat.scale=vec4.scale;quat.rotateX=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out};quat.rotateY=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out};quat.rotateZ=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out};quat.calculateW=function(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out};quat.dot=vec4.dot;quat.lerp=vec4.lerp;quat.slerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>1e-6){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out};quat.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out};quat.conjugate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out};quat.length=vec4.length;quat.len=quat.length;quat.squaredLength=vec4.squaredLength;quat.sqrLen=quat.squaredLength;quat.normalize=vec4.normalize;quat.fromMat3=function(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=.5*fRoot;fRoot=.5/fRoot;out[0]=(m[5]-m[7])*fRoot;out[1]=(m[6]-m[2])*fRoot;out[2]=(m[1]-m[3])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=.5*fRoot;fRoot=.5/fRoot;out[3]=(m[j*3+k]-m[k*3+j])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out};quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof exports!=="undefined"){exports.quat=quat}})(Math);;
/*!{id:msgpack.codec.js,ver:1.05,license:"MIT",author:"uupaa.js@gmail.com"}*/
var msgpack=function(){function m(f,b,c){var a,e,h;if(null==b)f.push(192);else if(!1===b)f.push(194);else if(!0===b)f.push(195);else switch(typeof b){case "number":b!==b?f.push(203,255,255,255,255,255,255,255,255):Infinity===b?f.push(203,127,240,0,0,0,0,0,0):Math.floor(b)===b?0>b?-32<=b?f.push(224+b+32):-128<b?f.push(208,b+256):-32768<b?(b+=65536,f.push(209,b>>8,b&255)):-2147483648<b?(b+=4294967296,f.push(210,b>>>24,b>>16&255,b>>8&255,b&255)):(e=Math.floor(b/4294967296),b&=4294967295,
f.push(211,e>>24&255,e>>16&255,e>>8&255,e&255,b>>24&255,b>>16&255,b>>8&255,b&255)):128>b?f.push(b):256>b?f.push(204,b):65536>b?f.push(205,b>>8,b&255):4294967296>b?f.push(206,b>>>24,b>>16&255,b>>8&255,b&255):(e=Math.floor(b/4294967296),b&=4294967295,f.push(207,e>>24&255,e>>16&255,e>>8&255,e&255,b>>24&255,b>>16&255,b>>8&255,b&255)):((e=0>b)&&(b*=-1),h=Math.log(b)/0.6931471805599453+1023|0,c=b*Math.pow(2,1075-h),b=c&4294967295,e&&(h|=2048),e=c/4294967296&1048575|h<<20,f.push(203,e>>24&255,e>>16&255,
e>>8&255,e&255,b>>24&255,b>>16&255,b>>8&255,b&255));break;case "string":c=b.length;h=f.length;f.push(0);for(e=0;e<c;++e)a=b.charCodeAt(e),128>a?f.push(a&127):2048>a?f.push(a>>>6&31|192,a&63|128):65536>a&&f.push(a>>>12&15|224,a>>>6&63|128,a&63|128);a=f.length-h-1;32>a?f[h]=160+a:65536>a?f.splice(h,1,218,a>>8,a&255):4294967296>a&&f.splice(h,1,219,a>>>24,a>>16&255,a>>8&255,a&255);break;default:if(++c>=t)return n=1,[];if(u(b))for(a=b.length,16>a?f.push(144+a):65536>a?f.push(220,a>>8,a&255):4294967296>
a&&f.push(221,a>>>24,a>>16&255,a>>8&255,a&255),e=0;e<a;++e)m(f,b[e],c);else{h=f.length;f.push(0);a=0;for(e in b)++a,m(f,e,c),m(f,b[e],c);16>a?f[h]=128+a:65536>a?f.splice(h,1,222,a>>8,a&255):4294967296>a&&f.splice(h,1,223,a>>>24,a>>16&255,a>>8&255,a&255)}}return f}function p(){var f,b,g,a=0,e,h,d=q;b=d[++c];if(224<=b)return b-256;if(192>b){if(128>b)return b;144>b?(a=b-128,b=128):160>b?(a=b-144,b=144):(a=b-160,b=160)}switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 202:return a=
16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c],e=a>>23&255,h=a&8388607,a&&2147483648!==a?255===e?h?NaN:Infinity:(a&2147483648?-1:1)*(h|8388608)*Math.pow(2,e-127-23):0;case 203:a=16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c];b=a&2147483648;e=a>>20&2047;h=a&1048575;if(!a||2147483648===a)return c+=4,0;if(2047===e)return c+=4,h?NaN:Infinity;a=16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c];return(b?-1:1)*((h|1048576)*Math.pow(2,e-1023-20)+a*Math.pow(2,e-1023-52));case 207:return a=16777216*d[++c]+
(d[++c]<<16)+(d[++c]<<8)+d[++c],4294967296*a+16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c];case 206:a+=16777216*d[++c]+(d[++c]<<16);case 205:a+=d[++c]<<8;case 204:return a+d[++c];case 211:return a=d[++c],a&128?-1*(72057594037927936*(a^255)+281474976710656*(d[++c]^255)+1099511627776*(d[++c]^255)+4294967296*(d[++c]^255)+16777216*(d[++c]^255)+65536*(d[++c]^255)+256*(d[++c]^255)+(d[++c]^255)+1):72057594037927936*a+281474976710656*d[++c]+1099511627776*d[++c]+4294967296*d[++c]+16777216*d[++c]+65536*d[++c]+
256*d[++c]+d[++c];case 210:return a=16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c],2147483648>a?a:a-4294967296;case 209:return a=(d[++c]<<8)+d[++c],32768>a?a:a-65536;case 208:return a=d[++c],128>a?a:a-256;case 219:a+=16777216*d[++c]+(d[++c]<<16);case 218:a+=(d[++c]<<8)+d[++c];case 160:e=[];b=c;for(f=b+a;b<f;)g=d[++b],e.push(128>g?g:224>g?(g&31)<<6|d[++b]&63:(g&15)<<12|(d[++b]&63)<<6|d[++b]&63);c=b;return 10240>e.length?l.apply(null,e):r(e);case 223:a+=16777216*d[++c]+(d[++c]<<16);case 222:a+=(d[++c]<<
8)+d[++c];case 128:for(h={};a--;){f=d[++c]-160;e=[];b=c;for(f=b+f;b<f;)g=d[++b],e.push(128>g?g:224>g?(g&31)<<6|d[++b]&63:(g&15)<<12|(d[++b]&63)<<6|d[++b]&63);c=b;h[l.apply(null,e)]=p()}return h;case 221:a+=16777216*d[++c]+(d[++c]<<16);case 220:a+=(d[++c]<<8)+d[++c];case 144:for(e=[];a--;)e.push(p());return e}}function r(c){try{return l.apply(null,c)}catch(b){}for(var g=[],a=0,e=c.length,h=s;a<e;++a)g[a]=h[c[a]];return g.join("")}var k={},s={},q=[],c=0,n=0,u=Array.isArray||function(c){return"[object Array]"===
Object.prototype.toString.call(c)},l=String.fromCharCode,t=512;(function(){for(var c=0,b;256>c;++c)b=l(c),k[b]=c,s[c]=b;for(c=128;256>c;++c)k[l(63232+c)]=c})();return{pack:function(c,b){n=0;var g=m([],c,0);return n?!1:b?r(g):g},unpack:function(f){var b;if("string"===typeof f){b=[];var g=f.split(""),a=-1,e;e=g.length;for(f=e%8;f--;)++a,b[a]=k[g[a]];for(f=e>>3;f--;)b.push(k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]])}else b=f;q=b;c=-1;return p()}}}();
var global=window;global.Engine=function(a){"use strict";function b(a){this.init(a)}function c(a){this.init(a)}function d(a){this._fields=[],this._valuesTypes=[],this._count=[],this._structure={},this._structureStack=[],c.call(this,a)}function e(a){this.init(a)}function f(a){Object.getPrototypeOf(this);if("undefined"==typeof this._events&&Object.addProperty(this,"_events",{}),this.hasOwnProperty("$")&&(Object.isObject(this.$)?Object.clear(this.$):delete this.$),a){if(a.on){var b=a.on;for(var c in b)this.on(c,b[c])}if("$"in a){var d=a.$;Array.isArray(d)?d=d.clone():Object.isObject(d)&&(d=Object.clone(d)),this.$=d}if(this.hasOwnProperty("$"))var d=this.$;for(var e in a)"$"===e[0]&&"$"!==e&&(void 0===d&&(d=this.$),d[e.slice(1)]=a[e])}this.initialize(a),this.trigger(f.INITIALIZE)}function g(a,b){return b=b||!1,this.body="string"==typeof a?a:this.body,this.title=b&&"string"==typeof b.title?b.title:this.title,this.tag=b&&"string"==typeof b.tag?b.tag:this.tag,this.expireTime=b&&"number"==typeof b.expireTime&&b.expireTime>=0?b.expireTime:this.expireTime,this.iconURL=b&&"string"==typeof b.iconURL?b.iconURL:this.iconURL,this.autoshow=b&&"boolean"==typeof b.autoshow?b.autoshow:this.autoshow,this.onshow=b&&"function"==typeof b.onshow?b.onshow:this.onshow,this.onerror=b&&"function"==typeof b.onerror?b.onerror:this.onerror,this.onclick=b&&"function"==typeof b.onclick?b.onclick:this.onclick,this.onclose=b&&"function"==typeof b.onclose?b.onclose:this.onclose,lb.features.notifications?((null===this.title||"undefined"==typeof this.title)&&(this.title=String(this.body),this.body=null),void(this.autoshow&&this.show())):this.onerror&&this.onerror()}function i(a,b){b||(b=a,a=""),this.type=String(a||this.type),this.name=i.NAME.format(this.type.capitalize()),this.message=String(arguments.length?b:this.message),this.model instanceof f&&this.model.trigger(this.name.toLowerCase(),this)}function j(){i.apply(this,arguments)}function k(){i.apply(this,arguments)}function l(){i.apply(this,arguments)}function m(){i.apply(this,arguments)}function n(){i.apply(this,arguments)}function o(a){this.duration=a&&"duration"in a?Math.max(0,parseFloat(a.duration)||0):Math.max(0,parseFloat(this.duration)||0),this.delay=a&&"delay"in a?Math.max(1,parseInt(a.delay)||0):Math.max(1,parseInt(this.delay)||0),this.autoplay=a&&"autoplay"in a?Boolean(a.autoplay):this.autoplay,this.type=String(a&&"type"in a?a.type:this.type),this.loop=Boolean(a&&"loop"in a?a.loop:this.loop),this.iterations=a&&"iterations"in a?Math.max(0,Math.floor(parseFloat(a.iterations))||0):Math.max(0,Math.floor(parseFloat(this.iterations))||0),this.playing=!1,this.progress=0,this.stepprogress=0,this.count=0,f.call(this,a),this.autoplay&&this.play()}function p(a,b,c,d){var e=this instanceof p?this:p.create();return e.x=a,e.y=b,e.w=c,e.h=d,e}function q(a){this.src=String(a&&"src"in a?a.src:this.src),this.method=String(a&&"method"in a&&q.METHODS.has(a.method)?a.method:q.METHODS.has(this.method)?this.method:q.GET),this.data=a&&"data"in a?a.data:this.data,this.type=String(a&&"type"in a?a.type:this.type),this.headers=a&&"headers"in a?a.headers:this.headers,this.headers="object"==typeof this.headers?this.headers:null,this.autoload=Boolean(a&&"autoload"in a?a.autoload:this.autoload),this.pending=!1,this.response=null,this.complete=!1,f.call(this,a),""===this.src,this.autoload&&this.load()}function r(a,b){i.call(this,"Request finished with [{}] status".format(a)),this.status=parseInt(a)||0,this.data=b}function s(a){i.call(this,a)}function t(a){i.call(this,a)}function u(a){this.src=String(a&&"src"in a?a.src:this.src),f.call(this,a),""===this.src}function v(){return this?(f.call(this),void Object.addProperty(this,"_status",Object.CONFIGURABLE|Object.WRITABLE,v.INITIALIZED)):new v}function z(){return this?(f.call(this),Object.addProperty(this,"loading",Object.ENUMERABLE,[]),Object.addProperty(this,"assets",Object.ENUMERABLE,[]),this._onAssetReady=this._onAssetReady(this),void(this._onAssetError=this._onAssetError(this))):new z}function A(){if(!this)return new A;f.call(this);var a=new z;Object.addProperty(this,"loader",a),a.on(z.PROGRESS,this.trigger.bind(this,z.PROGRESS)).on(z.READY,this.trigger.bind(this,z.READY)).on(z.COMPLETE,this.trigger.bind(this,z.COMPLETE)).on(z.ERROR,this.trigger.bind(this,z.ERROR))}function B(a,b){if(!this)return new B(a,b);this._builderCallback=a;var c,d,e,f=this._extensions=[];for(d=0,c=b.length;c>d;++d)e=b[d],f.push(e)}function C(a,b,c,d){if("string"==typeof a){var e=a;if(e=C.Name[e]||e,C.cache.hasOwnProperty(e))return C.cache[e];var f;if(f=C.HASH3.exec(e))a=parseInt(f[1]+f[1],16)||0,b=parseInt(f[2]+f[2],16)||0,c=parseInt(f[3]+f[3],16)||0,d=1;else if(f=C.HASH6.exec(e))a=parseInt(f[1],16)||0,b=parseInt(f[2],16)||0,c=parseInt(f[3],16)||0,d=1;else if(f=C.RGB.exec(e))a=Math.round(f[1])||0,b=Math.round(f[2])||0,c=Math.round(f[3])||0,d=1;else if(f=C.RGBA.exec(e))a=Math.round(f[1])||0,b=Math.round(f[2])||0,c=Math.round(f[3])||0,d=+f[4]||0;else{if(!(f=C.HSL.exec(e)))throw new TypeError("Engine.Color: unknown color `"+a+"`");f=C.fromHSL(f[1],f[2],f[3],f),a=Math.round(f[0])||0,b=Math.round(f[1])||0,c=Math.round(f[2])||0,d=1}}else{if("number"!=typeof a)throw new TypeError("Engine.Color: unknown type passed as argument `"+a+"`");a=Math.round(+a)||0,b=Math.round(+b)||0,c=Math.round(+c)||0,d=void 0===d?1:+d||0}if(0>a||a>255)throw new RangeError("Engine.Color: `r` is out of range. "+a+" given.");if(0>b||b>255)throw new RangeError("Engine.Color: `g` is out of range. "+b+" given.");if(0>c||c>255)throw new RangeError("Engine.Color: `b` is out of range. "+c+" given.");if(0>d||d>1)throw new RangeError("Engine.Color: `a` is out of range. "+d+" given.");var g=C.toIndex(a,b,c,d);if(C.cache.hasOwnProperty(g))return C.cache[g];var h=C.cache[g]=Object.create(C.prototype);return v.call(h),e&&(C.cache[e]=h),h.r=a,h.g=b,h.b=c,h.a=d,h.index=g,h.status=v.READY,h}function D(a){var b=a.type||D.LINEAR,c=a.from||null,d=a.to||null,e=a.stop||null;if(!D.TYPES.has(b))throw new TypeError("Engine.Gradient: invalid `type`. `"+b+"` given.");if(!c)throw new TypeError("Engine.Gradient: `from` is empty. "+c+" given.");if(!d)throw new TypeError("Engine.Gradient: `to` is empty. "+d+" given.");if(!e)throw new TypeError("Engine.Gradient: `stop` is empty. "+e+" given.");for(var f in e)e[f]instanceof C==!1&&(e[f]=C(e[f]));var g=D.toIndex(b,c,d,e);if(D.cache.hasOwnProperty(g))return D.cache[g];var h=D.cache[g]=Object.create(D.prototype);return v.call(h),h.type=b,h.from=c,h.to=d,h.stop=e,h.index=g,h.status=v.READY,h}function E(a){if(E.cache.hasOwnProperty(a))return E.cache[a];var b=E.cache[a]=Object.create(E.prototype);return v.call(b),b.src=a,b}function F(a){if(F.cache.hasOwnProperty(a))return F.cache[a];var b=F.cache[a]=Object.create(F.prototype);return v.call(b),b.src=a,b}function G(a){if(G.cache.hasOwnProperty(a))return G.cache[a];var b=G.cache[a]=Object.create(G.prototype);return v.call(b),b.src=a,b}function H(a){f.call(this,a),this.parent=null,this.children=this.children||[],this.id=a&&"id"in a?a.id:this.id,this.name=a&&"name"in a?a.name:this.name,this.x=a&&"x"in a?a.x:this.x,this.y=a&&"y"in a?a.y:this.y,this.scale=a&&"scale"in a?a.scale:this.scale,this.rotation=a&&"rotation"in a?a.rotation:this.rotation,this.width=a&&"width"in a?a.width:this.width,this.height=a&&"height"in a?a.height:this.height,this.opacity=a&&"opacity"in a?a.opacity:this.opacity,this.clip=a&&"clip"in a?a.clip:this.clip,this.originX=a&&"originX"in a?a.originX:this._originX,this.originY=a&&"originY"in a?a.originY:this._originY,this.transform=a&&"transform"in a?a.transform:this.transform,this.zIndex=a&&"zIndex"in a?a.zIndex:this.zIndex;var b=a&&a.children;if(b)for(var c=0,d=b.length;d>c;c++)this.appendChild(b[c]);var e=a&&"parent"in a?a.parent:this.parent;e instanceof H&&e.appendChild(this)}function I(a){H.call(this,a),Object.addProperty(this,"_color",Object.WRITABLE,null),this.color=a&&"color"in a?a.color:this.color}function J(a,b){if(a instanceof S||arguments.length>1)return J.call(this,{camera:a,children:b});var c=a;H.call(this,c),this.camera=c&&"camera"in c?c.camera:this.camera}function K(a){H.call(this,a)}function L(a){K.call(this,a),Object.addProperty(this,"_color",Object.WRITABLE,null),Object.addProperty(this,"_image",Object.WRITABLE,null),Object.addProperty(this,"_gradient",Object.WRITABLE,null),Object.addProperty(this,"_stroke",Object.WRITABLE,null),this.color=a&&"color"in a?a.color:this.color,this.image=a&&"image"in a?a.image:this.image,this.gradient=a&&"gradient"in a?a.gradient:this.gradient,this.stroke=a&&"stroke"in a?a.stroke:this.stroke}function M(a){L.call(this,a)}function N(a){L.call(this,a),this.points=a&&"points"in a?a.points:this.points}function O(a){L.call(this,a),a&&"radius"in a&&(this.radiusY=this.radiusX=a.radius),a&&"radiusX"in a&&(this.radiusX=a.radiusX),a&&"radiusY"in a&&(this.radiusY=a.radiusY)}function P(a){L.call(this,a),Object.addProperty(this,"_textColor",Object.WRITABLE,P.COLOR),this.font=a&&"font"in a?a.font:this.font,"string"==typeof this.font&&(this.font=ob.getById(this.font)||F(this.font)),this.textColor=a&&"textColor"in a?a.textColor:this.textColor,this.text=a&&"text"in a?a.text:this.text,this.spacing=a&&"spacing"in a?a.spacing:this.spacing,this.lineHeight=a&&"lineHeight"in a?a.lineHeight:this.lineHeight,this.textAlign=a&&"textAlign"in a?a.textAlign:this.textAlign,this.textAlign=P.ALIGN.has(this.textAlign)?this.textAlign:P.ALIGN[0],a&&"padding"in a&&(this.padding=a.padding),this.paddingLeft=a&&"paddingLeft"in a?a.paddingLeft:this.paddingLeft,this.paddingTop=a&&"paddingTop"in a?a.paddingTop:this.paddingTop,this.paddingRight=a&&"paddingRight"in a?a.paddingRight:this.paddingRight,this.paddingBottom=a&&"paddingBottom"in a?a.paddingBottom:this.paddingBottom}function Q(a){K.call(this,a)}function R(a,b,c,d){if("string"==typeof a)return"number"==typeof b?R.call(this,{id:a,width:b,height:c,cameras:d}):R.call(this,{id:a,cameras:b});R.stack.push(this);var e=a;this.id=e&&"id"in e?e.id:"",this.width=e&&"width"in e?e.width:0,this.height=e&&"height"in e?e.height:0;var g=e&&("width"in e||"height"in e)?!1:!0;if(this.fill=e&&"fill"in e?e.fill:g,this.cameras=[],f.call(this,e),e&&"cameras"in e){var d=e.cameras instanceof S?[e.cameras]:e.cameras;if(d)for(var h=0,i=d.length;i>h;h++)this.addCamera(d[h])}}function S(a){f.call(this,a);var b=Object.getPrototypeOf(this);this.volume=a&&"volume"in a?a.volume:b.volume,this.zoom=a&&"zoom"in a?a.zoom:b.zoom,this.x=a&&"x"in a?a.x:b.x,this.y=a&&"y"in a?a.y:b.y,this.left=a&&"left"in a?a.left:b._left,this.top=a&&"top"in a?a.top:b._top,this.width=a&&"width"in a?a.width:b._width,this.height=a&&"height"in a?a.height:b._height,this.lookingAt=a&&"lookAt"in a?a.lookAt:null}function T(){}function U(a){this.rebuild(a)}function V(a){if(!a)throw"config is not defined!";if(!a.shader)throw"config 'shader' property is not defined!";if(!WebGLProgram.prototype.isPrototypeOf(a.shader))throw"config 'shader' property is not a type of WebGLProgram!";this._shader=a.shader;var b,c,d,e,f=a.uniforms,g=this._uniforms=[];if(f)for(b in f)f.hasOwnProperty(b)&&(c=f[b],"float"===c?(d=new Float32Array(1),e=V.UNIFORM_F1):"vec2"===c?(d=new Float32Array(2),e=V.UNIFORM_F2):"vec3"===c?(d=new Float32Array(3),e=V.UNIFORM_F3):"vec4"===c?(d=new Float32Array(4),e=V.UNIFORM_F4):"mat2"===c?(d=new Float32Array(4),e=V.UNIFORM_M2):"mat3"===c?(d=new Float32Array(9),e=V.UNIFORM_M3):"mat4"===c&&(d=new Float32Array(16),e=V.UNIFORM_M4),g.push(b,-1,d,e))}function W(a){if(W.cache.hasOwnProperty(a))return W.cache[a];var b=W.cache[a]=Object.create(W.prototype);return v.call(b),Object.addProperty(b,"src",Object.ENUMERABLE,a),Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,0),b}function X(a){var b=Object.getPrototypeOf(this),c=a.sound;"string"==typeof c&&(c=ob.getById(c)||W(c)),Object.addProperty(this,"sound",Object.CONFIGURABLE|Object.ENUMERABLE,c),c.status===v.INITIALIZED&&c.load(),this._impl&&this._impl.setSound(c.src),Object.addProperty(this,"autoplay",Object.CONFIGURABLE|Object.ENUMERABLE|Object.WRITABLE,"autoplay"in a?a.autoplay:b.autoplay),Object.addProperty(this,"autodestroy",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"autodestroy"in a?a.autodestroy:b.autodestroy),Object.addProperty(this,"_playing",Object.CONFIGURABLE|Object.WRITABLE,b._playing),Object.addProperty(this,"_loop",Object.CONFIGURABLE|Object.WRITABLE,b.loop),"loop"in a&&(this.loop=a.loop),Object.addProperty(this,"_volume",Object.CONFIGURABLE|Object.WRITABLE,b.volume),"volume"in a&&(this.volume=a.volume),H.call(this,a),this.hasOwnProperty("onSoundReady")||(this.onSoundReady=b.onSoundReady.bind(this)),this.hasOwnProperty("onEnd")||(this.onEnd=b.onEnd.bind(this)),this.sound.once(v.READY,this.onSoundReady),this._impl&&(this._impl.onEnd=this.onEnd)}function Y(a){var b=this instanceof Y?this:Y.create();return wb&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,wb.createAmbientSound()),X.call(b,a),b}function Z(a){H.call(this,a),this.isoX=a&&"isoX"in a?a.isoX:this.isoX,this.isoY=a&&"isoY"in a?a.isoY:this.isoY,this.isoZ=a&&"isoZ"in a?a.isoZ:this.isoZ,this.isoW=a&&"isoW"in a?a.isoW:this.isoW,this.isoH=a&&"isoH"in a?a.isoH:this.isoH}function $(a){var b=Object.getPrototypeOf(this);Object.addProperty(this,"_mutable",Object.CONFIGURABLE|Object.WRITABLE,b._mutable),f.call(this,a),Object.addProperty(this,"autoplay",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"autoplay"in a?a.autoplay:b.autoplay),Object.addProperty(this,"autodestroy",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"autodestroy"in a?a.autodestroy:b.autodestroy),a&&null!=a.duration,Object.addProperty(this,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"duration"in a?a.duration:b.duration),Object.addProperty(this,"_playing",Object.CONFIGURABLE|Object.WRITABLE,b._playing),Object.addProperty(this,"_paused",Object.CONFIGURABLE|Object.WRITABLE,b._paused),Object.addProperty(this,"_loop",Object.CONFIGURABLE|Object.WRITABLE,b._loop),a&&"loop"in a&&(this.loop=a.loop),Object.addProperty(this,"reverse",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"reverse"in a?a.reverse:b.reverse),this.hasOwnProperty("onEnd")||(this.onEnd=b.onEnd.bind(this)),this._impl&&(this._impl.onEnd=this.onEnd)}function _(a){var b=Object.getPrototypeOf(this);$.call(this,a),Object.addProperty(this,"animations",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"animations"in a?a.animations.clone():b.animations);for(var c=0,d=this.animations,e=d.length;e>c;c++){var f=d[c];_.setMutableDeep(f,!1)}Object.freeze(this.animations)}function ab(a){var b=this instanceof ab?this:ab.create();return Db&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,Db.createSequentialAnimation()),_.call(b,a),Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,ab.getTotalDuration(b)),b._impl&&b._impl.initialize(b),b.autoplay&&b.play(),b}function bb(a){var b=this instanceof bb?this:bb.create();return Db&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,Db.createParallelAnimation()),_.call(b,a),Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,bb.getMaxDuration(b)),b._impl&&b._impl.initialize(b),b.autoplay&&b.play(),b}function cb(a){var b=Object.getPrototypeOf(this);$.call(this,a),Object.addProperty(this,"target",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"target"in a?a.target:b.target),Object.addProperty(this,"property",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"property"in a?a.property:b.property),Object.addProperty(this,"updateProperty",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"updateProperty"in a?a.updateProperty:b.updateProperty),Object.addProperty(this,"easing",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"easing"in a?a.easing:b.easing)}function db(a){var b=this instanceof db?this:db.create(),c=Object.getPrototypeOf(b);Db&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,Db.createNumberAnimation()),cb.call(b,a);var d=a&&"from"in a?a.from:c.from;return d===db.AUTO&&(d=b.target[b.property]),Object.addProperty(b,"from",Object.CONFIGURABLE|Object.ENUMERABLE,d),Object.addProperty(b,"to",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"to"in a?a.to:c.to),b._impl&&b._impl.initialize(b),b.autoplay&&b.play(),b}function eb(a,b,c,d){this.buffer=eb.getBuffer(a,b,c,d),this.index=0}function fb(a){this.frames=a&&a.frames instanceof Array?a.frames:[],this.frame=0,K.call(this,a);var b=this.frames[this.frame]||null;b&&(this.x=b.x,this.y=b.y,this.width=b.w,this.height=b.h)}var gb=function(){function b(a){return a&&"object"==typeof a&&!Array.isArray(a)}function c(a,c){if(!b(a)||"function"!=typeof c)throw new TypeError;return Object.forEach(a,function(a,b,d){d.hasOwnProperty(a)&&c(a,b)}),!0}Object.defineProperty(a,"Class",{get:function(){return f}});var d="_super",e=function(){},f={extend:function(a,b){if(2!==arguments.length)throw new RangeError;if("function"!=typeof a||"function"!=typeof b)throw new TypeError;var c=Object.createProto(b.prototype);return c.constructor=a,c[d]=null,a.prototype=c,a},decorate:function(a,f,g){if(b(f))return c(f,this.decorate.bind(this,a));if("function"==typeof a&&"function"!=typeof a[f]&&(a=a.prototype),3!==arguments.length)throw new RangeError;if("string"!=typeof f||"function"!=typeof g)throw new TypeError;var h=a.hasOwnProperty(f)&&"function"==typeof a[f]?a[f]:null,i=Object.getPrototypeOf(a);return a[f]=function(){if(null===this||"undefined"==typeof this)return g.apply(this,arguments);var a=this[d],b=!h&&i&&"function"==typeof i[f]&&i[f];this[d]=h||b||e;var c=g.apply(this,arguments);return this[d]=a,c}}};return Function.prototype.property=function(a,d){if(b(a))return c(a,this.property.bind(this));if("string"!=typeof a)throw new TypeError;if(this.prototype.hasOwnProperty(a))throw new ReferenceError;this.prototype[a]=d},Function.prototype.method=function(a,d){if(b(a))return c(a,this.method.bind(this));if(this.prototype.hasOwnProperty(a))throw new ReferenceError;return f.decorate(this.prototype,a,d)},Function.prototype.decorate=function(a,d){if(b(a))return c(a,this.decorate.bind(this));if("function"!=typeof this.prototype[a])throw new ReferenceError;return f.decorate(this.prototype,a,d)},f}();Function.prototype.bind||(Function.prototype.bind=function(){var a=this,b=Array.prototype.shift.call(arguments),c=Array.prototype.slice.call(arguments,0);return function(){return a.apply(b,Array.prototype.concat.call(c,Array.prototype.slice.call(arguments,0)))}}),Function.isFunction=function(a){return"function"==typeof a},Function.prototype.hasOwnProperty("name")||Object.defineProperty(Function.prototype,"name",{get:function(){/^function\s*([^\()]+)/.test(this);var a=RegExp.$1||"Empty";return Object.defineProperty(this,"name",{value:a}),a}}),Function.override=function(a,b,c){return a[b]=c.call(a,a[b]),this},Function.prototype.override=function(a,b){return Function.override(this.prototype,a,b),this},function(){var a={},b=this.Uint8Array||Array;String.prototype.capitalize=function(){return this.length?a[this]||(a[this]=this[0].toUpperCase()+this.slice(1)):this},String.prototype.format=function(){function a(a){for(var b=a.split(c),g=0,h=b.length;h>g;g++){var i=b[g],j=i.indexOf(d);~j&&(b[g]=i.slice(j+1),b.splice(g,0,c+i.slice(0,j)+d),b.splice(g,0,i.slice(0,j)),g+=2,h+=2)}for(var k="var r = '', v = '';\n",l=[],g=0,h=b.length;h>g;g+=3){var a=b[g],m=b[g+1],n=b[g+2];if(a&&(a=a.replace(e,"\\$1"),a=a.replace(f,"\\n"),k+="r += '"+a+"';\n"),n){var o="arg"+l.length;l.push(o),m?(k+="v = arg0 && arg0['"+m+"'];\n",k+="if (typeof v === 'undefined' && '"+m+"' in arg0) v += '';"):k+="v = "+o+";\n",k+="if (v && typeof v === 'object') v = JSON.stringify(v);\n",k+="r += typeof v !== 'undefined' ? (v+'') : '"+n+"';\n\n"}}return k+="return r;",l.push(k),Function.apply(null,l)}function b(){return g[this]||(g[this]=a(this),++h===b.WARN_CACHE_LEN),g[this].apply(null,arguments)}var c="{",d="}",e=/(')/g,f=/(\n)/g;b.WARN_CACHE_LEN=500;var g={},h=0;return b}(),String.prototype.toByteArray=function(){for(var a=0,c=this.length,d=new b(c);c>a;a++)d[a]=255&this.charCodeAt(a);return d},String.prototype.contains=function(a){return!!~this.indexOf(a)},String.isString=function(a){return"string"==typeof a},String.generateUid=function(a){"undefined"==typeof a&&(a=8);for(var b="";b.length<a;)b+=Math.random().toString(16).slice(2);return b.slice(0,a)}}.call(this),"undefined"==typeof Number.MAX_SAFE_INTEGER&&(Number.MAX_SAFE_INTEGER=9007199254740992),"undefined"==typeof Number.MIN_SAFE_INTEGER&&(Number.MIN_SAFE_INTEGER=-9007199254740992),Number.prototype.between=function(a,b){return this>=Math.min(a,b)&&this<=Math.max(a,b)},Number.prototype.sign=function(){return 0>this?-1:this>0?1:0},function(a,b,c,d){Object.createProto=function(a){if(1!==arguments.length)throw new RangeError;if(!a||"object"!=typeof a)throw new TypeError;if(Object.create)return Object.create(a);var b=function(){};return b.prototype=a,new b},"undefined"==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var e=Object.merge=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};Object.mergeAll=function(a){for(var b=1,c=arguments.length;c>b;b++)e(a,arguments[b]);return a},Object.mergeDeep=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(Object.isObject(a[c])&&Object.isObject(b[c])?Object.mergeDeep(a[c],b[c]):a[c]=b[c]);return a},Object.forEach=function(a,b,d){var e=a&&"object"==typeof a&&!c(a),f=e&&"function"==typeof b;if(!e||!f)throw new TypeError;for(var g in a)b.call(d,g,a[g],a)};var f=Object.clone=function(a){var b="function"==typeof a.toClone?a.toClone():a.toClone,c=Object.getPrototypeOf(a);return c=Object.createProto(c),Object.merge(c,a),b&&Object.merge(c,b),c},g=Object.cloneDeep=function(a){var b=f(a);for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];e&&"object"==typeof e&&(b[d]=c(e)?e.clone(!0):g(e))}return b};Object.isObject=function(a){return"object"==typeof a&&null!==a},Object.isArguments=function(a){return"[object Arguments]"===d.call(a)},Object.clear=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b];return a},Object.ENUMERABLE=1,Object.CONFIGURABLE=2,Object.WRITABLE=4,Object.addProperty=function(){{var a={value:void 0,configurable:!1,writable:!1,enumerable:!1},b={get:void 0,set:void 0,configurable:!1,enumerable:!1};Object.ENUMERABLE|Object.CONFIGURABLE|Object.WRITABLE}return function(c,d,e,f,g){if(("number"!=typeof e||3===arguments.length)&&(g=f,f=e,e=0),void 0===g){var h=a;h.value=f,h.writable=!!(e&Object.WRITABLE)}else{var h=b;h.get=f||void 0,h.set=g||void 0}return h.configurable=!!(e&Object.CONFIGURABLE),h.enumerable=!!(e&Object.ENUMERABLE),Object.defineProperty(c,d,h),c}}(),Object.values=function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;c++)b[c]=a[b[c]];return b}}(Array.prototype.shift,Array.prototype.pop,Array.isArray,Object.prototype.toString),Function.prototype._pool_count=0,Function.prototype.POOL_THRESHOLD=100,Object.addProperty(Function.prototype,"_pool",function(){var a=[];return Object.addProperty(this,"_pool",a),a},null),Function.prototype.allocate=function(a){var b=this._pool,c=b.length;for(a>c&&(this._pool_count=0,b.length=a);a-->c;)b[a]=Object.create(this.prototype);return this},Function.prototype.grab=function(){return this._pool.pop()||null},Function.prototype.create=function(){var b=this.grab()||(this._pool_count++,Object.create(this.prototype));if(this._pool_count===this.POOL_THRESHOLD&&a.console&&a.console.warn){var c=this.name||"Function";a.console.warn(c+"::create: pool threshold reached. Do you call "+c+"::free when you are done with objects ?")}return b},Function.prototype.free=function(b){if(200===this._pool.length&&a.console&&a.console.warn){var c=this.name||"Function";a.console.warn(c+"::free: pool is too big")}return this._pool_count=0,this._pool.push(b),this};var hb=function(b){function c(b,c,h){var i="u"===b[0].toLowerCase(),j=~b.toLowerCase().indexOf("float");i||(c*=2);var k=0;switch(!0){case!j&&d>=c:k=8;break;case!j&&e>=c:k=16;break;case f>=c:k=32;break;case j&&g>=c:k=64;break;default:return!1}return new(a[b.capitalize()+k+"Array"])(h)}Object.defineProperty(a,"TypedArray",{get:function(){return c}}),this.Int8Array=this.Int8Array||Array,this.Int16Array=this.Int16Array||Array,this.Int32Array=this.Int32Array||Array,this.Uint8Array=this.Uint8Array||Array,this.Uint16Array=this.Uint16Array||Array,this.Uint32Array=this.Uint32Array||Array,this.Float32Array=this.Float32Array||Array,this.Float64Array=this.Float64Array||Array;var d=b(2,8)-1,e=b(2,16)-1,f=b(2,32)-1,g=b(2,64)-1;return c}.call(a,Math.pow);Array.prototype.first=function(){return this.length>0?this[0]:null},Array.prototype.last=function(){return this.length>0?this[this.length-1]:null},Array.prototype.has=function(a){return-1!==this.indexOf(a)},Array.prototype.indexOfElems=function(a){var b=-1,c=arguments.length;a:for(;~(b=this.indexOf(a,b+1));){for(var d=1;c>d;d++)if(this[b+d]!==arguments[d])continue a;return b}return b},Array.prototype.remove=function(a){for(var b=!1,c=0;-1!=(c=this.indexOf(a));)this.splice(c,1),b=!0;return b},Array.prototype.add=function(a){return-1===this.indexOf(a)?(this.push(a),!0):!1},Array.prototype.clear=function(){for(;this.length>0;)this.pop();return this},Array.prototype.filter||(Array.prototype.filter=function(a){for(var b=[],c=0;c<this.length;c++)a(this[c])&&b.push(this[c]);return b}),Array.prototype.random=function(){return this.length?this[Math.random()*this.length|0]:null},Array.prototype.swap=function(a,b){var c=null;return a<this.length&&a>=0&&b<this.length&&b>=0?(c=this[a],this[a]=this[b],this[b]=c,!0):!1},Array.prototype.clone=function(a){a="boolean"==typeof a?a:!1;var b=this.concat();if(!a)return b;for(var c=0,d=b.length;d>c;c++)b[c]&&"object"==typeof b[c]&&(b[c]=Array.isArray(b[c])?b[c].clone(!0):Object.cloneDeep(b[c]));return b},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){if("function"!=typeof a)return this;for(var c=0;c<this.length;c++)a.call(b,this[c],c,this);return this}),Array.prototype.without=function(a){if(!Array.isArray(a)||!a.length)return this.clone();a=a.slice(0);for(var b=[],c=0,d=this.length;d>c;c++){var e=this[c],f=a.indexOf(e);~f?f===a.length-1?a.pop():a[f]=a.pop():b.push(e)}return b},Array.prototype.toObject=function(a,b){a="function"==typeof a?a:null,b="undefined"!=typeof b?Object(b):null;var c=b||{};if(!this.length)return c;for(var d=0,e=this.length;e>d;d++){var f=a?a(this[d],d,this):d;f!==!1&&(c[f]=this[d])}return c},b.prototype._valuesType=Float32Array,b.prototype._valuesPerChunk=1,b.prototype._chunksCapacity=1024,b.prototype._chunksStored=0,b.prototype._memPool=null,b.prototype._CATable=null,b.prototype._CATablePointer=0,Object.defineProperty(b.prototype,"valuesType",{get:function(){return this._valuesType}}),Object.defineProperty(b.prototype,"valuesPerChunk",{get:function(){return this._valuesPerChunk}}),Object.defineProperty(b.prototype,"chunksCapacity",{get:function(){return this._chunksCapacity}}),Object.defineProperty(b.prototype,"chunksStored",{get:function(){return this._chunksStored}}),Object.defineProperty(b.prototype,"chunksAvailable",{get:function(){return this._chunksCapacity-this._chunksStored}}),b.prototype.init=function(a){if(a){if(this._valuesType=a.valuesType||this._valuesType,this._valuesPerChunk=a.valuesPerChunk||this._valuesPerChunk,this._chunksCapacity=a.chunksCapacity||this._chunksCapacity,!this._valuesType.BYTES_PER_ELEMENT)throw"Values type provided is not an ArrayBuffer view!";if(this._valuesPerChunk<=0)throw"Values per chunk must be larger than 0!";if(this._chunksCapacity<=0)throw"Chunks capacity must be larger than 0!"}this._memPool=new ArrayBuffer(this._valuesType.BYTES_PER_ELEMENT*this._valuesPerChunk*this._chunksCapacity),this._chunksStored=0,this._CATable=new Uint8Array(this._chunksCapacity),this._CATablePointer=0},b.prototype.alloc=function(){var a=this._chunksCapacity,b=this._valuesPerChunk,c=this._valuesType,d=this._CATable,e=this._CATablePointer,f=c.BYTES_PER_ELEMENT*b,g=e;if(this._chunksStored<a)do{if(!(d[g]>0))return d[g]=1,this._chunksStored++,this._CATablePointer=g,new c(this._memPool,f*g,b);g++,g>=a&&(g=0)}while(g!=e);return this._CATablePointer=e,new c(b)},b.prototype.dealloc=function(a){if(this._chunksStored>0&&a&&a.buffer==this._memPool){var b=a.byteOffset/this._valuesType.BYTES_PER_ELEMENT/this._valuesPerChunk;return b<this._chunksCapacity?(this._CATable[b]=0,this._CATablePointer=b,this._chunksStored--,!0):!1}return!1},b.prototype.contains=function(a){return a&&a.buffer==this._memPool},c.prototype._bytesCapacity=1024,c.prototype._bytesStored=0,c.prototype._statesCapacity=256,c.prototype._statesStored=0,c.prototype._memBuff=null,c.prototype._statesBuff=null,Object.defineProperty(c.prototype,"bytesCapacity",{get:function(){return this._bytesCapacity}}),Object.defineProperty(c.prototype,"bytesStored",{get:function(){return this._bytesStored}}),Object.defineProperty(c.prototype,"bytesAvailable",{get:function(){return this._bytesCapacity-this._bytesStored}}),Object.defineProperty(c.prototype,"statesCapacity",{get:function(){return this._statesCapacity}}),Object.defineProperty(c.prototype,"statesStored",{get:function(){return this._statesStored}}),Object.defineProperty(c.prototype,"statesAvailable",{get:function(){return this._statesCapacity-this._statesStored}}),c.prototype.init=function(a){if(a){if(this._bytesCapacity=a.bytesCapacity||this._bytesCapacity,this._statesCapacity=a.statesCapacity||this._statesCapacity,this._bytesCapacity<=0)throw"Bytes capacity must be larger than 0!";if(this._statesCapacity<=0)throw"States capacity must be larger than 0!"}this._memBuff=new ArrayBuffer(this._bytesCapacity),this._statesBuff=new Uint16Array(this._statesCapacity),this._bytesStored=0,this._statesStored=0},c.prototype.pushState=function(){return this._statesStored<this._statesCapacity?(this._statesBuff[this._statesStored++]=this._bytesStored,!0):!1},c.prototype.popState=function(){return this._statesStored>0?(this._bytesStored=this._statesBuff[--this._statesStored],!0):!1},c.prototype.alloc=function(a,b){if(a){b=b>0?b:1;var c=a.BYTES_PER_ELEMENT*b,d=a.BYTES_PER_ELEMENT-1,e=this._bytesStored+d&~d;if(c>0&&c<=this._bytesCapacity-e){var f=new a(this._memBuff,e,b);return this._bytesStored=e+c,f}return new a(b)}return null},c.prototype.contains=function(a){return!(!a||a.buffer!==this._memBuff)},d.prototype=Object.create(c.prototype),d.prototype.constructor=d,d.prototype._fields=null,d.prototype._valuesTypes=null,d.prototype._count=null,d.prototype._structure=null,d.prototype._structureStack=null,Object.defineProperty(d.prototype,"current",{get:function(){return this._structure}}),Object.defineProperty(d.prototype,"last",{get:function(){var a=this._structureStack,b=a.length;return b>0?a[b-1]:this._structure}}),d.prototype.init=function(a){if(!a)throw"Layout cannot be null or undefined!";if(!a.structure)throw"Layout does not have structure property!";if(!(a.structure instanceof Array))throw"Layout structure property is not an Array!";this._structure=null;var b,d,e,f=this._fields,g=this._valuesTypes,h=this._count,i=a.structure,j=i.length;for(e=0;j>e;++e){if(b=i[e],!b.field)throw"Structure item #"+e+" does not have field property!";if(!b.valuesType)throw"Structure item #"+e+" does not have valuesType property!";if(d=b.field,!b.valuesType.BYTES_PER_ELEMENT)throw"Structure item #"+e+" valuesType is not a TypedArray!";f.push(d),g.push(b.valuesType),h.push(b.count>0?b.count:1)}if(0==f.length)throw"Structure cannot be empty!";c.prototype.init.call(this,a)},d.prototype.pushState=function(){var a=this._structure,b=this._fields;this._structureStack.push(a);var d,e,f={},g=b.length;if(a)for(d=0;g>d;++d)e=b[d],f[e]=a[e];return this._structure=f,c.prototype.pushState.call(this)},d.prototype.popState=function(){return this._structure=this._structureStack.pop()||null,c.prototype.popState.call(this)},d.prototype.allocStruct=function(){this._structure=this._structure||{};var a,b=this._structure,c=this._fields,d=this._valuesTypes,e=this._count,f=c.length;for(a=0;f>a;++a)b[c[a]]=this.alloc(d[a],e[a]);return b},e.prototype._buffer=null,e.prototype._type=null,e.prototype._capacity=0,e.prototype._resize=0,e.prototype._cache=null,e.prototype._pointer=0,Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer
}}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type}}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity}}),Object.defineProperty(e.prototype,"resize",{get:function(){return this._resize}}),Object.defineProperty(e.prototype,"pointerPosition",{get:function(){return this._pointer}}),Object.defineProperty(e.prototype,"pointerLeft",{get:function(){var a=this._cache;return a?a.length-this._pointer:0}}),Object.defineProperty(e.prototype,"cacheLimit",{get:function(){var a=this._cache;return a?a.length:0}}),e.prototype.init=function(a){if(this.free(),!a)throw"config cannot be empty!";if(this._buffer=a.buffer&&a.buffer.byteLength>0?a.buffer:null,this._type=a.type&&a.type.BYTES_PER_ELEMENT>0?a.type:null,this._capacity=a.capacity>0?0|a.capacity:0,this._resize=a.resize>=0?0|a.resize:this._capacity,!this._buffer)throw"config.buffer must be type of ArrayBuffer!";if(!this._type)throw"config.type must be TypedArray type!";if(this._capacity<=0)throw"config.capacity must be greater than 0!";if(this._resize<=0)throw"config.resize must be greater than or equal to 0!";var b,c=this._cache=[],d=this._capacity;for(b=0;d>b;++b)c.push(null)},e.prototype.free=function(){this._buffer=null,this._type=null,this._capacity=0,this._resize=0,this._cache=null,this._pointer=0},e.prototype.obtain=function(a,b){var c=this._cache,d=this._buffer,e=this._type,f=this._capacity;if(!c||!d||0>=f)return null;var g=c.length,h=this._pointer,i=c[h]||null;if(i&&i.byteOffset==a&&i.length==b||(c[h]=i=new e(d,a,b)),h++,h>=g){var j,k=this._resize;for(j=0;k>j;++j)c.push(null)}return this._pointer=h,i},e.prototype.resetPointer=function(){this._pointer=0},e.prototype.resetCacheCapacity=function(){var a=this._cache;if(a){var b=a.length,c=this._capacity,d=b-c;d>0&&a.splice(c,d)}},function(){var a=Math.random;Math.randomBetween=function(b,c){return a()*(c-b)+b},Object.defineProperty(Math,"DEGREE",{value:Math.PI/180}),Math.deg2rad=function(a){return Math.DEGREE*a}}(),function(a,c,d){function e(a,b){var c=e.prototype.isPrototypeOf(this)?this:e.create(),d=a*b;return c.stream&&c.stream.length===d||(c.stream=new e.Stream(a*b)),c.width=a,c.height=b,c}function f(a,b){return 3===b?h(a):2===b?i(a):1===b?j(a):g(a,b)}function g(a,b){for(var c=0,d=0,g=1;b>d;d++,g*=-1)k(d,0,a,b,b,e.cache),c+=g*f(e.cache,b-1,b-1);return c}function h(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j+c*g*h+d*e*i-h*f*d-i*g*b-j*e*c}function i(a){return a[0]*a[3]-a[2]*a[1]}function j(a){return a[0]}function k(a,b,c,d,e,f){for(var g=0,h=e-1,i=0;e>i;i++)if(i!==b){for(var j=0,k=d-1,l=0;d>l;l++)l!==a&&(f[g*k+j]=c[i*d+l],j++);g++}return k*h}function l(a,b,c,d){for(var e=0;b>e;e++)for(var f=0;c>f;f++)d[e*b+f]=a[f*b+e]}function m(a,b,c){for(var d=0;c>d;d++)a[d]=b[d]}function n(a,b,c,d,e,f,g,h,i){var j=n.prototype.isPrototypeOf(this)?this:n.create(),k=j.stream||p.alloc();return k[0]=a,k[1]=b,k[2]=c,k[3]=d,k[4]=e,k[5]=f,k[6]=g,k[7]=h,k[8]=i,j.stream=k,j}d=d||Float32Array,a.glMatrix.setMatrixArrayType(d);var o=a.mat3,p=new b({valuesType:d,valuesPerChunk:9,chunksCapacity:c||1}),q=n(),r=new d([0,0]);a.Matrix=e,e.Stream=d,e.cache=new e.Stream(16),e.I=function(a){if(3===a)return n(1,0,0,0,1,0,0,0,1);for(var b=new e(a,a),c=b.stream,d=0;a>d;d++)for(var f=0;a>f;f++)c[f*a+d]=d===f?1:0;return b},e.prototype.set=function(){return m(this.stream,arguments,this.stream.length>arguments.length?this.stream.length:arguments.length),this},e.prototype.multiply=function(a,b){b=b||this;var c=this.stream,d=this.width,f=this.height,g=a.width,h=a.height,i=b.stream;if(a=a.stream,d!==h)throw new RangeError("Matrix::multiply: can`t multiply matrices ({},{}) x ({}, {})".format(d,f,g,h));for(var j=g*f,k=0;f>k;k++)for(var l=0;g>l;l++){for(var n=0,o=0;h>o;o++)n+=c[k*d+o]*a[o*g+l];e.cache[k*g+l]=n}return i.length!==j&&(i=b.stream=new e.Stream(j)),m(i,e.cache,j),b},e.prototype.transpose=function(){var a=this.stream,b=this.width,c=this.height;return l(a,b,c,e.cache),m(a,e.cache,a.length),this.width=c,this.height=b,this},e.prototype.determinant=function(){var a=this.width,b=this.height;if(a!==b)throw new RangeError("Matrix::determinant: matrix is not square  ("+a+"x"+b+")");if(!a||!b)throw new RangeError("Matrix::determinant: matrix is empty  ("+a+"x"+b+")");return f(this.stream,a)},e.prototype.clone=function(a){return a=a||e.create(),e.call(a,this.width,this.height),m(a.stream,this.stream,this.width*this.height),a},e.prototype.destroy=function(){e.free(this)},a.Matrix33=n,n.prototype.stream=null,Object.defineProperty(n,"I",{get:function(){return n(1,0,0,0,1,0,0,0,1)}}),Object.defineProperty(n.prototype,"width",{get:function(){return 3}}),Object.defineProperty(n.prototype,"height",{get:function(){return 3}}),Object.defineProperty(n.prototype,"m11",{get:function(){return this.stream[0]}}),Object.defineProperty(n.prototype,"m12",{get:function(){return this.stream[1]}}),Object.defineProperty(n.prototype,"m13",{get:function(){return this.stream[2]}}),Object.defineProperty(n.prototype,"m21",{get:function(){return this.stream[3]}}),Object.defineProperty(n.prototype,"m22",{get:function(){return this.stream[4]}}),Object.defineProperty(n.prototype,"m23",{get:function(){return this.stream[5]}}),Object.defineProperty(n.prototype,"m31",{get:function(){return this.stream[6]}}),Object.defineProperty(n.prototype,"m32",{get:function(){return this.stream[7]}}),Object.defineProperty(n.prototype,"m33",{get:function(){return this.stream[8]}}),n.prototype.multiply=function(a,b){return b=b||this,o.multiply(q.stream,this.stream,a.stream),o.copy(b.stream,q.stream),b},n.prototype.determinant=function(){return o.determinant(this.stream)},n.prototype.transpose=function(){return o.transpose(this.stream),this},n.prototype.inverse=function(){return o.invert(this.stream,this.stream),this},n.prototype.inv=n.prototype.inverse,n.prototype.set=function(a,b,c,d,e,f,g,h,i){var j=this.stream;return j[0]=a,j[1]=b,j[2]=c,j[3]=d,j[4]=e,j[5]=f,j[6]=g,j[7]=h,j[8]=i,this},n.prototype.clone=function(a){return a=a||n(),o.copy(a.stream,this.stream),a},n.prototype.translate=function(a,b,c){return c=c||this,r[0]=a,r[1]=b,o.translate(c.stream,this.stream,r),c},n.prototype.rotate=function(a,b){return b=b||this,o.rotate(b.stream,this.stream,a),b},n.prototype.scale=function(a,b,c){return c=c||this,r[0]=a,r[1]=b,o.scale(c.stream,this.stream,r),c},n.prototype.skew=function(a,b,c){return c=c||this,n._cache.set(1,Math.tan(b),0,Math.tan(a),1,0,0,0,1),o.multiply(c.stream,this.stream,n._cache),c},n.prototype.destroy=function(){p.dealloc(this.stream),this.stream=null,n.free(this)}}(Math,Math.FAST_MATRIX_POOL_CAPACITY,Math.FAST_MATH_TYPE),function(a,c,d){function e(a,b){var c=e.prototype.isPrototypeOf(this)?this:e.create(),d=c.stream||g.alloc();return d[0]=a,d[1]=b,c.stream=d,c}d=d||Float32Array,a.glMatrix.setMatrixArrayType(d);{var f=a.vec2;a.Matrix,a.Matrix33}a.Vector2d=e;{var g=new b({valuesType:d,valuesPerChunk:2,chunksCapacity:c||1e4});new e(0,0)}e.prototype.stream=null,Object.defineProperty(e.prototype,"x",{get:function(){return this.stream[0]},set:function(a){return this.stream[0]=a}}),Object.defineProperty(e.prototype,"y",{get:function(){return this.stream[1]},set:function(a){return this.stream[1]=a}}),Object.defineProperty(e.prototype,"length",{get:function(){return f.length(this.stream)}}),Object.defineProperty(e.prototype,"squaredLength",{get:function(){return f.squaredLength(this.stream)}}),e.prototype.set=function(a,b){return f.set(this.stream,a,b),this},e.prototype.equals=function(a,b){b=b||0;var c=this.stream,d=a.stream;return Math.abs(c[0]-d[0])<=b&&Math.abs(c[1]-d[1])<=b},e.prototype.normalize=function(){return f.normalize(this.stream,this.stream),this},e.prototype.multiplyByScalar=function(a,b){return b=b||this,f.scale(b.stream,this.stream,a),b},e.prototype.add=function(a,b){return b=b||this,f.add(b.stream,this.stream,a.stream),b},e.prototype.sub=function(a,b){return b=b||this,f.sub(b.stream,this.stream,a.stream),b},e.prototype.dot=function(a){return f.dot(this.stream,a.stream)},e.prototype.multiply=function(a,b){return b=b||this,f.transformMat3(b.stream,this.stream,a.stream),b},e.prototype.clone=function(a){return a=a||new e,f.copy(a.stream,this.stream),a},e.prototype.destroy=function(){g.dealloc(this.stream),this.stream=null,e.free(this)}}(Math,Math.FAST_VECTOR_POOL_CAPACITY,Math.FAST_MATH_TYPE);var ib=function(){function b(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}Object.defineProperty(a,"Namespace",{get:function(){return b}});var c=String.prototype.split,d=Array.prototype.indexOf,e=["function","object"],f=".",g="";return b.prototype.get=function(a){return b.get(this,a)},b.prototype.set=function(a,c){return b.set(this,a,c)},b.prototype.unset=function(a){return b.unset(this,a)},b.get=function(a,b){var e=a,h=c.call(String(b),f);if(-1!==d.call(h,g))throw'Namespace.get: Empty key passed - "'+b+'"';for(var i=0,j=h.length;j>i;i++){var k=h[i];if(!e||!e.hasOwnProperty(k))return void 0;e=e[k]}return e},b.set=function(a,b,h){var i=a,j=c.call(String(b),f);if(-1!==d.call(j,g))throw'Namespace.set: Empty key passed - "'+b+'"';for(var k=0,l=j.length-1;l>k;k++){var m=j[k];i=i&&i.hasOwnProperty(m)&&i[m]&&-1!==d.call(e,typeof i[m])?i[m]:i[m]={}}return i[j[k]]=h},b.unset=function(a,b){var h=a,i=c.call(String(b),f);if(-1!==d.call(i,g))throw'Namespace.unset: Empty key passed - "'+b+'"';for(var j=0,k=i.length-1;k>j;j++){var l=i[j];if(!(h&&h.hasOwnProperty(l)&&h[l]&&-1!==d.call(e,typeof h[l])))return null;h=h[l]}return delete h[i[k]],h},b.Chain=function(a,c){var d=b.prototype;b.prototype=c;var e=new b(a);return b.prototype=d,e},b}();Object.defineProperty(a,"Model",{get:function(){return f}}),f.INITIALIZE="initialize",f._getEventMethodName=function(){var a={};return function(b){return a[b]?a[b]:a[b]="on{}".format(b)}}(),f.prototype={constructor:f,initialize:function(){},get $(){return this.$={}},set $(a){Object.addProperty(this,"$",Object.CONFIGURABLE|Object.ENUMERABLE|Object.WRITABLE,a)},get:function(a){a+="";var b=this["get"+a.capitalize()];return"function"==typeof b?(arguments[0]=this,Function.call.apply(b,arguments)):this[a]},set:function(a){a+="";var b=this["set"+a.capitalize()];return"function"==typeof b?(arguments[0]=this,Function.call.apply(b,arguments)):this[a]=arguments[1],this},on:function(a,b){var c=this._events[a]||(this._events[a]=[]);return c.has(b)||c.push(b),this},once:function(a,b){function c(d){g.off(a,c),b.call(this,d)}var d=this._events[a];if(d)for(var e=0,f=d.length;f>e;e++)if(null!==d[e]&&d[e].handler===b)return this;var g=this;return c.handler=b,this.on(a,c),this},off:function(a,b){var c=this._events[a];if(a&&b){if(c){var d=c.indexOf(b);~d&&(c[d]=null);for(var e=0,f=c.length;f>e;e++)if(null!==c[e]&&c[e].handler===b){c[e]=null;break}}}else if(a){if(c)for(var e=0,f=c.length;f>e;e++)c[e]=null}else for(var a in this._events)this.off(a);return this},trigger:function(a,b){var c=this._events[a],d=f._getEventMethodName(a);if("function"==typeof this[d]&&this[d](b),c)for(var e=0,g=c.length;g>e;e++)null===c[e]?(c.splice(e,1),e--,g--):c[e].call(this,b);return this},destroy:function(){return this.off(),this.constructor.free(this),this}};var jb=new f;jb.ERROR="error",jb.WARN="warn",jb.INFO="info",jb.INITIALIZE="initialize",jb.BOOTSTRAP="bootstrap",jb.PRELOAD="preload",jb.READY="ready",jb.CANVAS_RENDERER="canvas_renderer",jb.WEBGL_RENDERER="webgl_renderer",jb.debug=!0,jb.rendererType=jb.CANVAS_RENDERER,jb.ready=function(a){return"function"==typeof a&&(jb.state===jb.READY?a.call(jb):jb.once(jb.READY,a)),jb},jb.state=jb.INITIALIZE,jb.initialize=function(){if(a.document&&a.document.createElement){if(a.ENGINE_FORCED_CANVAS_RENDERER)return void(jb.rendererType=jb.CANVAS_RENDERER);var b=a.document.createElement("canvas");try{var c=null!=b&&null!=(b.getContext("webgl")||b.getContext("experimental-webgl"));jb.rendererType=c?jb.WEBGL_RENDERER:jb.CANVAS_RENDERER}catch(d){jb.rendererType=jb.CANVAS_RENDERER}b.parentNode&&b.parentNode.removeChild(b)}},jb.start=function(){return jb.state!==jb.INITIALIZE?jb:(jb.state=jb.BOOTSTRAP,jb.trigger(jb.BOOTSTRAP),jb.state=jb.PRELOAD,jb.trigger(jb.PRELOAD),ob.on(z.READY,function(){jb.state=jb.READY,jb.trigger(jb.READY)}),ob.load(),jb)},jb.NOP=function(){},jb.now=Date.now||function(){return(new Date).valueOf()},jb.Class=gb,jb.Model=f,jb.Namespace=ib,jb.TypedArray=hb,jb.TypedMemoryPool=b,jb.TypedMemoryStack=c,jb.StructuredMemoryStack=d,jb.StreamedTypedArrayViewCollector=e,jb.initialize(),Object.addProperty(jb,"RELEASE",!0);var kb=jb.Loop=new f;kb.DELAY=17,kb.interval=0,kb.VSYNC="vsync",kb.REFLOW="reflow",kb.frame=function(){return clearTimeout(kb.interval),kb.interval=0,kb.trigger(kb.VSYNC),kb.trigger(kb.REFLOW),this},kb.request=function(){return kb.interval?!1:(kb.interval=setTimeout(kb.frame,kb.DELAY),!0)};var lb=jb.Device=new f;lb.platform={type:"desktop",name:""},lb.navigator={browser:{name:"",version:0},language:""},lb.keyboard=!1,lb.KEYBOARD_STATUS_CHANGE="keyboardstatuschange",lb.online=!0,lb.ONLINE="online",lb.OFFLINE="offline",lb.pageVisible=!0,lb.PAGE_SHOW="pageshow",lb.PAGE_HIDE="pagehide",lb.SCREEN_ORIENTATION_CHANGE="screenorientationchange",lb.screen={width:0,height:0,pixelDepth:24,pixelRatio:1,orientation:0},lb.features={canvas:!1,svg:!1,audio:!1,video:!1,compass:!1,fullscreen:!1,userMedia:!1,gamepad:!1,cache:{scripts:!1,files:!1,data:!1},geolocation:!1,notifications:!1,pageVisibility:!1,vibration:!1,telephony:!1,pointerLock:!1};var mb=jb.Device.Fullscreen=new f;mb.viewport=null,mb.STATUS_CHANGED="statuschanged",mb.request=function(a,b,c){return mb.viewport!==a?c(new jb.Error("Feature not implemented")):(mb.trigger(mb.STATUS_CHANGED,a),void b())},mb.exit=function(a,b){return mb.viewport?b():(mb.trigger(mb.STATUS_CHANGED),void a())},mb.toggle=function(a,b,c){return mb.viewport?mb.exit(b,c):mb.request(a,b,c)};var nb=jb.Device.Geolocation=new f;nb.position=null,nb.watching=!1,nb.getPosition=function(a,b,c){var d=nb.position;null===d?b():c(d)},nb.setPosition=function(a){nb.position!==a&&(nb.position=a,nb.trigger("positionchanged"))},nb.clearWatch=function(a,b){nb.watching===!1?b():a()},jb.Device.Notification=g,g.property({title:void 0,body:void 0,tag:void 0,expireTime:0,iconURL:void 0,autoshow:!0,onshow:null,onerror:null,onclick:null,onclose:null}),g.method({show:function(){return"function"==typeof this.onshow?this.onshow():void 0},close:function(){return"function"==typeof this.onclose?this.onclose():void 0}}),function(a,b){var c=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null;if(!c)return!1;var d=!1,e=function(){d=!1,b.frame()};b.request=function(){return d?!1:(d=!0,c(e),!0)}}(this,jb.Loop),function(a){a.userAgents={platform:{"windows nt 10.0":"Windows 10","windows nt 6.2":"Windows 8","windows nt 6.1":"Windows 7","windows nt 6.0":"Windows Vista","windows nt 5.2":"Windows 2003","windows nt 5.1":"Windows XP","windows nt 5.0":"Windows 2000","windows nt 4.0":"Windows NT","winnt4.0":"Windows NT","winnt 4.0":"Windows NT",winnt:"Windows NT","windows 98":"Windows 98",win98:"Windows 98","windows 95":"Windows 95",win95:"Windows 95",windows:"Unknown Windows OS","os x":"Mac OS X","intel mac":"Intel Mac","ppc mac":"PowerPC Mac",powerpc:"PowerPC",ppc:"PowerPC",cygwin:"Cygwin",linux:"Linux",debian:"Debian",openvms:"OpenVMS",sunos:"Sun Solaris",amiga:"Amiga",beos:"BeOS",apachebench:"ApacheBench",freebsd:"FreeBSD",netbsd:"NetBSD",bsdi:"BSDi",openbsd:"OpenBSD","os/2":"OS/2",warp:"OS/2",aix:"AIX",irix:"Irix",osf:"DEC OSF","hp-ux":"HP-UX",hurd:"GNU/Hurd",unix:"Unknown Unix OS"},browser:{opera:"Opera",msie:"Internet Explorer","internet explorer":"Internet Explorer",iemobile:"Internet Explorer",shiira:"Shiira",firefox:"Firefox",chimera:"Chimera",phoenix:"Phoenix",firebird:"Firebird",camino:"Camino",navigator:"Netscape",netscape:"Netscape",omniweb:"OmniWeb",chrome:"Chrome",safari:"Safari",cfnetwork:"Safari",konqueror:"Konqueror",epiphany:"Epiphany",galeon:"Galeon",mozilla:"Mozilla",icab:"iCab",lynx:"Lynx",links:"Links",hotjava:"HotJava",amaya:"Amaya",ibrowse:"IBrowse"},mobile:{iemobile:"Windows Phone OS","windows phone os":"Windows Phone OS",mobileexplorer:"Mobile Explorer",openwave:"Open Wave","opera mini":"Opera Mini",operamini:"Opera Mini",elaine:"Palm",palmsource:"Palm","digital paths":"Palm",avantgo:"Avantgo",xiino:"Xiino",palmscape:"Palmscape",nokia:"Nokia",ericsson:"Ericsson",blackberry:"BlackBerry",motorola:"Motorola",iphone:"iPhone",ipad:"iPad",ipod:"iPod",android:"Android"}}}(jb.Device),function(a){var b,c=function(a,b,c){c[b]=a.toLowerCase()},d=function(a,b){var c=function(a,c){return b.indexOf(a)-b.indexOf(c)};return a.length>1&&a.sort(c),a};b=function(){var b=document.documentElement;return a.features=Object.merge(a.features,{canvas:!!window.CanvasRenderingContext2D,svg:!!window.SVGElement,audio:!!window.Audio,video:!!window.HTMLVideoElement,compass:"object"==typeof window.ondeviceorientation&&"object"==typeof window.ondevicemotion,fullscreen:!!(b.requestFullscreen||b.requestFullScreen||b.mozRequestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullscreen||b.webkitRequestFullScreen),userMedia:!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia),gamepad:!!(navigator.gamepads||navigator.webkitGamepads||navigator.mozGamepads),cache:{scripts:!!window.applicationCache,files:!!(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem),data:!!(window.localStorage||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.openDatabase)},geolocation:!!navigator.geolocation,notifications:!!window.Notification,pageVisibility:!!(document.visibilityState||document.mozVisibilityState||document.webkitVisibilityState),vibration:!!navigator.vibrate,telephony:!(!navigator.telephony&&!navigator.mozTelephony),pointerLock:!!(b.requestPointerLock||b.webkitRequestPointerLock||b.mozRequestPointerLock)})}(),function(){var b,e,f,g,h,i=navigator.userAgent;g=a.userAgents.mobile,h=Object.keys(g),b=i.match(new RegExp(h.join("|"),"ig")),null!==b?e="mobile":(g=a.userAgents.platform,h=Object.keys(g),b=i.match(new RegExp(h.join("|"),"ig")),null!==b&&(e="desktop")),null!==b&&(b.forEach(c),d(b,h),f=g[b.first()],null!==f.match(/iPod|iPad|iPhone/)&&(f="iOS"),a.platform=Object.merge(a.platform,{type:e,name:f}))}(),function(){!function(){var b,e,f,g=a.userAgents.browser,h=Object.keys(g),i=navigator.userAgent;b=i.match(new RegExp(h.join("|"),"ig")),null!==b&&(e=function(){return b.forEach(c),d(b,h),b.first()}(),f=function(){var a=new RegExp(e,"i").exec(i).index,b=i.substring(a+e.length+1);return b.length>0?(b.indexOf(" ")>0&&(b=b.substring(0,b.indexOf(" "))),parseFloat(b)):void 0}(),a.navigator.browser=Object.merge(a.navigator.browser,{name:a.userAgents.browser[e],version:f}))}(),function(){var b=navigator.userLanguage||navigator.systemLanguage||navigator.language;"undefined"!=typeof b&&(b=b.split("-"),"undefined"==typeof b[1]&&(b[1]=b[0]),b=b[0]+"-"+b[1].toUpperCase(),a.navigator.language=b)}()}(),function(){if("mobile"===a.platform.type){var b=function(b){var c=a.keyboard;c!==b&&(a.keyboard=b,a.trigger(a.KEYBOARD_STATUS_CHANGE))};window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("touchstart",function(){b(!1)}),document.body.addEventListener("keydown",function(){b(!0)})})}a.keyboard="mobile"!==a.platform.type}(),"boolean"==typeof navigator.onLine&&!function(){var b=function(){a.online=navigator.onLine};window.addEventListener("online",function(){b(),a.trigger(a.ONLINE)}),window.addEventListener("offline",function(){b(),a.trigger(a.OFFLINE)}),b()}(),function(){var b,c,d=screen.mozOrientation||screen.webkitOrientation||screen.orientation;"string"==typeof d?(b=function(){a.screen.orientation=function(){switch(d){case"portrait-primary":return 0;case"portrait-secondary":return 180;case"landscape-primary":return-90;case"landscape-secondary":return 90}}()},screen.addEventListener("orientationchanged",function(){b(),a.trigger(a.SCREEN_ORIENTATION_CHANGE,a.screen.orientation)}),b()):"undefined"!=typeof window.orientation?(b=function(){a.screen.orientation=window.orientation},window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("orientationchange",function(){b(),a.trigger(a.SCREEN_ORIENTATION_CHANGE,window.orientation)}),b()})):(b=function(){a.screen.orientation=c.clientWidth>c.clientHeight?90:0},window.addEventListener("DOMContentLoaded",function(){c=document.body,window.addEventListener("resize",function(){var c=a.screen.orientation;b(),c!==a.screen.orientation&&a.trigger(a.SCREEN_ORIENTATION_CHANGE,c)}),b()})),a.screen=Object.merge(a.screen,{width:screen.width,height:screen.height,pixelDepth:screen.pixelDepth||screen.colorDepth,pixelRatio:window.devicePixelRatio||1})}(),b.pageVisibility?!function(){var b="visibilityState",c="visibilitychange";!function(){var a=document.webkitVisibilityState&&"webkit"||document.mozVisibilityState&&"moz"||document.msVisibilityState&&"ms"||null;null!==a&&(b=a+b.capitalize(),c=a+c)}(),document.addEventListener(c,function(){var c=document[b],d="visible"===c;a.pageVisible=d,a.trigger(d?a.PAGE_SHOW:a.PAGE_HIDE)})}():(window.addEventListener("focus",function(){a.pageVisible||(a.pageVisible=!0,a.trigger(a.PAGE_SHOW))}),window.addEventListener("blur",function(){a.pageVisible&&(a.pageVisible=!1,a.trigger(a.PAGE_HIDE))})),delete a.userAgents}(jb.Device),function(a,b){function c(a,b){if(a&&b){var c=document.createElement("meta");return c.setAttribute("name",a),c.setAttribute("content",b),document.head.insertBefore(c,d),c}}var d=document.head.children[1];c("viewport","width={width}, minimum-scale={scale}, maximum-scale={scale}, user-scalable=no".format({width:b.screen.width*b.screen.pixelRatio,scale:1/b.screen.pixelRatio})),c("HandheldFriendly","true"),c("MobileOptimized",480),/iPod|iPad|iPhone/.test(navigator.userAgent)&&(c("apple-mobile-web-app-capable","yes"),c("apple-mobile-web-app-status-bar-style","black-translucent"))}(jb,jb.Device),function(a,b){function c(){l={};for(var a=k.length;a--;)k.pop()()}var d=window.document,e=d.documentElement,f=null,g=null,h=null,i=null,j=null;if(function(){function a(a,b){""!==n&&(a=a.capitalize()),b=b||"";for(var c=0;l>c;c++)var f=n+a+k[c]+b;return f in d||f in e?f:null}for(var b=["moz","webkit"],c=b.length,k=["Fullscreen","FullScreen"],l=k.length,m=-1;c>m;m++){var n=b[m]||"";a("request")&&(f=a("request"),g=a("exit")||a("cancel"),h=a("","Element")||a("current","Element"),i=n+"fullscreenchange",j=n+"fullscreenerror")}}(),f&&g&&h&&i&&j){var k=[],l={};d[h]&&(b.viewport=!0,b.exit()),e.addEventListener(i,function(){var a=d[h];b.viewport=a&&l[a],c()}),e.addEventListener(j,function(){c()}),gb.decorate(b,"request",function(a,b,c){var d=this._super.bind(this,a,b,c);k.push(d);var e=a.div;l[e]=a,e[f]()}),gb.decorate(b,"exit",function(a,b){var c=this._super.bind(this,a,b);k.push(c),d[g]()})}}(jb.Device,jb.Device.Fullscreen),function(a,b){if(a.features.geolocation){var c=null;gb.decorate(b,"getPosition",function(a,d,e){var f,g=this._super;f=navigator.geolocation[a?"watchPosition":"getCurrentPosition"](function(c){b.setPosition([c.coords.latitude,c.coords.longitude]),g(a,d,e)},function(){g(a,d,e)}),a&&(c=f)}),gb.decorate(b,"clearWatch",function(a){var d=this._super;null!==c&&b.watching===!0&&(b.watching=!1,navigator.geolocation.clearWatch(c)),d(onerror,a)})}}(jb.Device,jb.Device.Geolocation),function(a,b){if(a.features.notifications){var c=!0;b.decorate("show",function(){function a(){return e.onerror&&e.onerror()}function b(){var b=e.notification=new window.Notification(e.title,{body:e.body,tag:e.tag||"",iconUrl:e.iconURL});b.addEventListener("show",function(){return d.call(e)}),b.addEventListener("error",a),b.addEventListener("click",function(){return e.onclick&&e.onclick(),c&&e.close()}),e.expireTime&&b.addEventListener("show",function(){e.timeout=window.setTimeout(function(){return e.close()},e.expireTime)}),b.show()}var d=this._super,e=this,f=window.Notification.permission||window.Notification.permissionLevel&&window.Notification.permissionLevel();"granted"===f||"undefined"==typeof f?b():window.Notification.requestPermission(function(c){return"granted"===c?b():a()})}),b.decorate("close",function(){if(!this.notification)return this._super();var a=this._super,b=this,c=this.notification,d=c.timeout;return c.addEventListener("close",function(){return a.call(b)}),d&&window.clearTimeout(d),c.close(),delete this.notification})}}(jb.Device,jb.Device.Notification),function(a,b){gb.decorate(a,"request",function(c,d,e){if(c=c instanceof jb.Viewport?c:null,d="function"==typeof d?d:b,e="function"==typeof e?e:b,!c)throw new TypeError("No viewport passed");if(a.viewport===c)return d();if(a.viewport){var f=this._super.bind(this,c,d,e);return a.exit(f,e)}this._super(c,d,e)}),gb.decorate(a,"exit",function(c,d){return c="function"==typeof c?c:b,d="function"==typeof d?d:b,a.viewport?void this._super(c,d):c()})}(jb.Device.Fullscreen,jb.NOP),jb.Error=i,i.NAME="Engine{0}Error",i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i.prototype.type="",i.prototype.model=null,i.prototype.message="",i.prototype.toString=function(){return this.name+(this.message&&": "+this.message)},jb.Error.Reference=j,j.prototype=Object.create(i.prototype),j.prototype.constructor=j,j.prototype.type="reference",jb.Error.Syntax=k,k.prototype=Object.create(i.prototype),k.prototype.constructor=k,k.prototype.type="syntax",jb.Error.Range=l,l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.type="range",jb.Error.Type=m,m.prototype=Object.create(i.prototype),m.prototype.constructor=m,m.prototype.type="type",jb.Error.NotImplemented=n,n.prototype=Object.create(i.prototype),n.prototype.constructor=n,n.prototype.type="notImplemented",jb.Timer=o,o.STANDARD="standard",o.LOOP="loop",o.STEP="step",o.STOP="stop",o.PLAY="play",o.PAUSE="pause",o.queue={},o.evaluate=function(a,b){var c=o.queue,d=c.hasOwnProperty(a)?c[a]:null;if(!d||!d.length)return!1;for(var e=d.length;e-->0;){var f=d[e];if(f){var g=f.progress+=b;f.stepprogress+=b,f.stepprogress>=f.delay&&(f.progress=Math.min(f.progress,f.duration),f.trigger(o.STEP),f.stepprogress%=f.delay),g>=f.duration&&(f.loop?(g%=f.duration,f.trigger(o.LOOP),f.count++,f.progress=g,f.count>=f.iterations&&f.stop()):f.stop())}else Array.prototype.splice.call(d,e,1)}return!!d.length},o.start=function(a){jb.trigger(o.PLAY,a)},o.stop=function(a){jb.trigger(o.STOP,a)},o.prototype=Object.create(f.prototype),o.prototype.constructor=o,o.prototype.type=o.STANDARD,o.prototype.duration=1e3,o.prototype.loop=!1,o.prototype.iterations=1/0,o.prototype.delay=1,o.prototype.autoplay=!1,o.prototype.reset=function(){this.progress=0,this.stepprogress=0,this.count=0},o.prototype.play=function(){if(!this.playing){var a=o.queue,b=a.hasOwnProperty(this.type)?a[this.type]:a[this.type]=[];return b.add(this),1===b.length&&o.start(this.type),this.playing=!0,this.trigger(o.PLAY),!0}return!1},o.prototype.pause=function(){if(this.playing){var a=o.queue,b=a.hasOwnProperty(this.type)?a[this.type]:a[this.type]=[],c=Array.prototype.indexOf.call(b,this);return~c&&(b[c]=null),this.playing=!1,this.trigger(o.PAUSE),!0}return!1},o.prototype.stop=function(){if(this.playing){var a=o.queue,b=a.hasOwnProperty(this.type)?a[this.type]:a[this.type]=[],c=Array.prototype.indexOf.call(b,this);return~c&&(b[c]=null),this.playing=!1,this.progress=0,this.stepprogress=0,this.trigger(o.STOP),!0}return!1},o.prototype.destroy=function(){return this.stop(),f.prototype.destroy.call(this)},function(a,b,c){function d(a){return a!==h?!1:(g||(i=c(),g=setInterval(f,17)),!0)}function e(a){return a!==h?!1:(clearInterval(g),g=0,!0)}function f(){var a=c()-i;i+=a,b.evaluate(h,a)||b.stop(b.STANDARD)}var g=0,h=b.STANDARD,i=0;a.on(b.PLAY,d).on(b.STOP,e)}(jb,jb.Timer,jb.now),function(a,b,c,d){function e(a){return a!==h?!1:(b.on(b.VSYNC,g),(b.request()||null===i)&&(i=d()),!0)}function f(a){return a!==h?!1:(b.off(b.VSYNC,g),i=null,!0)}function g(){var a=d()-i;i+=a,c.evaluate(h,a)?b.request():c.stop(c.VSYNC)}var h=c.VSYNC="vsync",i=null,j=0;a.Device.on(a.Device.PAGE_HIDE,function(){j=d()}).on(a.Device.PAGE_SHOW,function(){null!==i&&(i+=d()-j)}),a.on(c.PLAY,e).on(c.STOP,f)}(jb,jb.Loop,jb.Timer,jb.now),jb.Box=p,p.overlap=function(a,b,c,d,e,f,g,h){return e+g>a&&a+c>e&&f+h>b&&b+d>f},p.extend=function(a,b,c,d,e,f,g,h){return e>a&&a+c>e+g&&f>b&&b+d>f+h},p.prototype.overlap=function(a){return p.overlap(this.x,this.y,this.w,this.h,a.x,a.y,a.w,a.h)},p.prototype.extend=function(a){return p.extend(this.x,this.y,this.w,this.h,a.x,a.y,a.w,a.h)},p.prototype.bound=function(a,b){var c=this.x,d=this.y,e=a.x,f=a.y,b=b||this;return b.x=Math.min(c,e),b.y=Math.min(d,f),b.w=Math.max(c+this.w,e+a.w)-b.x,b.h=Math.max(d+this.h,f+a.h)-b.y,b},p.prototype.clip=function(a,b){var c,d,e,f,g=this.x,h=this.y,i=a.x,j=a.y,b=b||this;return c=Math.max(g,i),d=Math.max(h,j),e=Math.min(g+this.w,i+a.w)-c,f=Math.min(h+this.h,j+a.h)-d,0>e||0>f?b.reset(0,0,0,0):b.reset(c,d,e,f)},p.prototype.copy=function(a){this.x=a.x,this.y=a.y,this.w=a.w,this.h=a.h},p.prototype.area=function(){return this.w*this.h},p.prototype.toString=function(){return"Box("+this.x+","+this.y+","+this.w+","+this.h+")"},p.prototype.clone=function(){return p(this.x,this.y,this.w,this.h)},p.prototype.equal=function(a){return a.x==this.x&&a.y==this.y&&a.w==this.w&&a.h==this.h},p.prototype.reset=function(a,b,c,d){return this.x=a,this.y=b,this.w=c,this.h=d,this},p.prototype.destroy=function(){p.free(this)},jb.Network=new f,jb.Network.Url={REGEXP:new RegExp("^{}?{}?{}?{}?{}?{}?$".format("(?:([a-z0-9]+\\:?)?\\/\\/)","([^\\/\\:]+)","(?:\\:([0-9]+))","([^\\?]+)","(?:(\\?[^\\#]+))","(?:(#.*))"),"i"),parse:function(a){a=String(a);var b=this.REGEXP.exec(a)||[],c=String(b[1]||"").toLowerCase(),d=b[2]||"",e=b[3]||"",f=b[4]||"",g=b[5]||"",h=b[6]||"",i=e?d+":"+e:d;return{protocol:c,host:i,hostname:d,port:e,pathname:f,search:g,hash:h,origin:c+"//"+i,href:c+"//"+i+f+g+h}},toQuery:function(a){if(!a||"object"!=typeof a)throw new m("Engine.Network.Url::toQuery(): passed data is not an Object");var b="";for(var c in a)b+=c+"="+a[c]+"&";return b.slice(0,-1)},fromQuery:function(a){a=String(a);var b={};if(""===a)return b;a=a.split("&");for(var c=0,d=a.length;d>c;c++){var e=a[c].split("=");b[e[0]||""]=e[1]||""}return b}},jb.Network.Resource=q,q.JSON="json",q.TEXT="text",q.DATA="data",q.AUTO="auto",q.METHODS=[q.GET="get",q.POST="post",q.PUT="put",q.DELETE="delete"],q.LOAD="load",q.ERROR="error",q.PROGRESS="progress",q.ABORT="abort",q.prototype=Object.create(f.prototype),q.prototype.constructor=q,q.prototype.src="",q.prototype.headers=null,q.prototype.method=q.GET,q.prototype.type=q.AUTO,q.prototype.data=null,q.prototype.autoload=!0,q.prototype["on"+q.LOAD]=function(a){this.response=a,this.pending=!1,this.complete=!0},q.prototype["on"+q.ERROR]=function(){this.response=null,this.pending=!1,this.complete=!1},q.prototype.load=function(){return this.pending||!this.src?!1:(this.pending=!0,this.complete=!1,this.response=null,!0)},q.prototype.abort=function(){return this.pending?(this.pending=!1,this.complete=!1,this.response=null,!0):!1},jb.Network.Resource.Error={},jb.Network.Resource.Error.Request=r,r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.type="networkResourceRequest",r.prototype.status=0,r.prototype.data=null,jb.Network.Resource.Error.Parse=s,s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.type="networkResourceParse",jb.Network.Resource.Error.Send=t,t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.prototype.type="networkResourceSend",jb.Network.Socket=u,u.OPEN="open",u.MESSAGE="message",u.CLOSE="close",u.prototype=Object.create(f.prototype),u.prototype.constructor=u,u.prototype.src="",u.prototype.connect=function(){return this},u.prototype.send=function(){return this},u.prototype.close=function(){return this},jb.Asset=v,v.INITIALIZED="initialized",v.LOADING="loading",v.READY="ready",v.ERROR="error",v.prototype=Object.create(f.prototype),Object.addProperty(v.prototype,"status",Object.ENUMERABLE,function(){return this._status
},function(a){this._status=a,this.trigger(a)}),v.prototype.load=function(){return this.status=v.LOADING,this},v.prototype.unload=function(){return this.status=v.INITIALIZED,this},v.prototype.destroy=function(){throw new jb.Error("`Asset` can't be destroyed")},v.prototype.on=function(a,b){return f.prototype.on.call(this,a,b),(a===v.READY||a===v.ERROR)&&this.status===a&&b.call(this),this},v.Loader=z,z.PROGRESS="progress",z.READY="ready",z.COMPLETE="complete",z.ERROR="error",z.prototype=Object.create(f.prototype),Object.addProperty(z.prototype,"pending",Object.ENUMERABLE,function(){return!!this.loading.length},null),Object.addProperty(z.prototype,"amount",Object.ENUMERABLE,function(){return this.assets.length},null),Object.addProperty(z.prototype,"loaded",Object.ENUMERABLE,function(){return this.assets.length-this.loading.length-this._errors},null),Object.addProperty(z.prototype,"progress",Object.ENUMERABLE,function(){return(this.assets.length-this.loading.length)/this.amount||0},null),z.prototype._errors=0,z.prototype.loading=null,z.prototype.assets=null,z.prototype.add=function(a){return~this.assets.indexOf(a)?this:(this.assets.push(a),(a.status===v.INITIALIZED||a.status===v.LOADING)&&a.on(v.READY,this._onAssetReady).on(v.ERROR,this._onAssetError),this)},z.prototype.remove=function(a){return this.assets.remove(a),a.off(v.READY,this._onAssetReady).off(v.ERROR,this._onAssetError),this},z.prototype.load=function(){for(var a=this.assets,b=0,c=a.length;c>b;b++){var d=a[b];switch(d.status){case v.INITIALIZED:case v.LOADING:this.loading.push(d)}}if(0!==this.progress&&this.trigger(z.PROGRESS,0),this._refresh(),!this.pending)return this;for(var b=0,c=a.length;c>b;b++){var d=a[b];d&&d.status===v.INITIALIZED&&d.load()}return this},z.prototype._refresh=function(){this.trigger(z.PROGRESS,this.progress),this.loading.length||(this.trigger(z.COMPLETE,{readyCount:this.amount-this._errors,errorCount:this._errors}),this._errors||this.trigger(z.READY),this.assets.clear(),this._errors=0)},z.prototype._onAssetReady=function(a){return function(){var b=a.pending;a.loading.remove(this),b&&a._refresh()}},z.prototype._onAssetError=function(a){return function(b){var c=a.pending;c&&(a.trigger(z.ERROR,b),a._refresh())}},v.Group=A,A.prototype=Object.create(f.prototype),A.prototype.loader=null;var ob=v.Manager=Object.merge(new f,{META_SEPARATOR:"@",_assets:{},_assetsGroups:{},_groupsAssets:{"":{}},_assetsFactories:{},groups:{"":new A},_getGroup:function(a){var b=ob.groups[a];return b},registerFactory:function(a,b,c){return ob._assetsFactories[a]=new B(b,c),ob},unregisterFactory:function(a){return delete ob._assetsFactories[a],ob},buildAsset:function(a,b){var c=ob.getById(a);if(c)return c;var d,e,f,g,h,i=a.lastIndexOf(ob.META_SEPARATOR),j=ob._assetsFactories;if(i>=0?(d=a.substr(0,i),e=a.substr(i+1)):d=a,f=d.lastIndexOf("."),g=d.substr(f+1),void 0===b){var k,l,m;for(k in j)if(j.hasOwnProperty(k)&&(l=j[k],m=l._extensions,m&&m.indexOf(g)>=0)){h=l;break}}else h=j[b];return h?(c=h._builderCallback.call(this,a,d,e,g),c&&!ob._assets[a]&&ob.register(a,c),c):void 0},getById:function(a){return ob._assets[a]},createGroup:function(a){var b=new A;return ob.groups[a]=b,ob._groupsAssets[a]={},b},register:function(a,b,c){if(Object.isObject(a)){for(var d in a)ob.register(d,a[d],b);return ob}void 0===c&&(c=""),ob._assets[a]=b,ob._assetsGroups[a]=c,ob._groupsAssets[c][a]=!0;var e=ob._getGroup(c);return e.loader.add(b),ob},unregister:function(a){var b=ob._assets[a],c=ob._assetsGroups[a];delete ob._assets[a],delete ob._assetsGroups[a],delete ob._groupsAssets[c][a];var d=ob._getGroup(c);return d.loader.remove(b),ob},load:function(a){void 0===a&&(a="");var b=ob._getGroup(a);return b.loader.load(),ob},unload:function(a){void 0===a&&(a="");var b=ob._getGroup(a),c=b.loader,d=ob._groupsAssets[a];for(var e in d){var f=ob._assets[e];f.unload(),c.remove(f)}return ob}});Object.freeze(ob),ob.groups[""].on(z.PROGRESS,ob.trigger.bind(ob,z.PROGRESS)).on(z.READY,ob.trigger.bind(ob,z.READY)).on(z.COMPLETE,ob.trigger.bind(ob,z.COMPLETE)).on(z.ERROR,ob.trigger.bind(ob,z.ERROR)),v.Factory=B,B.prototype._builderCallback=null,B.prototype._extensions=null,jb.Color=C,C.HASH3=/^#?([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,C.HASH6=/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,C.RGBA=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*([0-9\\.]+)\)$/,C.RGB=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/,C.HSL=/^hsl\((\d+)(?:deg)?,\s*(\d+)%?,\s*(\d+)%?\)$/,C.WHITESPACE=/\s+/g,C.cache={},C.Name={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},C.fromHSL=function(a,b,c,d){if(a=+a||0,b=+b||0,c=+c||0,a=a%360/360,b/=100,c/=100,d=d||[0,0,0],0===b)d[0]=d[1]=d[2]=255*c;else{var e=.5>c?c*(1+b):c+b-c*b,f=2*c-e;d[0]=255*C.fromHSL.hue(f,e,a+1/3),d[1]=255*C.fromHSL.hue(f,e,a),d[2]=255*C.fromHSL.hue(f,e,a-1/3)}return d},C.fromHSL.hue=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},C.toIndex=function(a,b,c,d){return"rgba("+a+","+b+","+c+","+d+")"},C.prototype=Object.create(v.prototype),C.prototype.r=0,C.prototype.g=0,C.prototype.b=0,C.prototype.a=1,C.prototype.index="",C.prototype.toString=function(){return this.index},jb.Gradient=D,D.cache={},D.toIndex=function(a,b,c,d){return a+"|"+b+"|"+c+"|"+JSON.stringify(d)},D.LINEAR="linear",D.RADIAL="radial",D.TYPES=[D.LINEAR,D.RADIAL],D.prototype=Object.create(v.prototype),D.prototype.toString=function(){return this.index},jb.Image=E,E.cache={},E.prototype=Object.create(v.prototype),Object.addProperty(E.prototype,"width",Object.ENUMERABLE|Object.WRITABLE,0),Object.addProperty(E.prototype,"height",Object.ENUMERABLE|Object.WRITABLE,0),E.prototype.src="",E.prototype.toString=function(){return this.src},ob.registerFactory("Engine.Image",function(a,b){return E(b)},["png","jpg","jpeg"]),jb.Font=F,F.cache={},F.prototype=Object.create(v.prototype),Object.addProperty(F.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,F),F.prototype.src="",jb.SpriteAtlas=G,G.cache={},G.prototype=Object.create(v.prototype),Object.addProperty(G.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,G),G.prototype.src="",G.prototype.description=null,G.prototype.toString=function(){return this.src},ob.registerFactory("Engine.SpriteAtlas",function(a,b,c,d){var e=G(b);return c&&"atlas"===d?E(a):e},["atlas"]),jb.Node=H,H.elements={},H.getElementById=function(a){return this.elements[a]||null},H.register=function(a,b){return a&&(this.elements[a]=b),H},H.unregister=function(a,b){return a&&this.elements[a]===b&&delete this.elements[a],H},H.LEFT="left",H.RIGHT="right",H.TOP="top",H.BOTTOM="bottom",H.CENTER="center",H.prototype=Object.create(f.prototype),H.prototype.constructor=H,H.prototype.parent=null,H.prototype.x=0,H.prototype.y=0,H.prototype.scale=1,H.prototype.rotation=0,H.prototype.width=0,H.prototype.height=0,H.prototype.opacity=1,H.prototype.clip=!1,Object.addProperty(H.prototype,"originX",Object.ENUMERABLE,function(){switch(this._originX){case H.LEFT:return-this.width/2;case H.CENTER:return 0;case H.RIGHT:return this.width/2;default:return this._originX}},function(a){this._originX=a}),H.prototype._originX=H.CENTER,Object.addProperty(H.prototype,"originY",Object.ENUMERABLE,function(){switch(this._originY){case H.TOP:return-this.height/2;case H.CENTER:return 0;case H.BOTTOM:return this.height/2;default:return this._originY}},function(a){this._originY=a}),H.prototype._originY=H.CENTER,H.prototype.transform=void 0,H.prototype.zIndex=0,Object.addProperty(H.prototype,"root",Object.ENUMERABLE,function(){for(var a=this;a.parent;)a=a.parent;return a},null),Object.addProperty(H.prototype,"next",Object.ENUMERABLE,function(){var a=this.parent;if(a){var b=a.children;return b[b.indexOf(this)+1]||null}return null},null),Object.addProperty(H.prototype,"prev",Object.ENUMERABLE,function(){var a=this.parent;if(a){var b=a.children;return b[b.indexOf(this)-1]||null}return null},null),Object.addProperty(H.prototype,"index",Object.ENUMERABLE,function(){return this.parent?this.parent.children.indexOf(this):0},null),Object.addProperty(H.prototype,"id",Object.ENUMERABLE,function(){return this._id||""},function(a){H.unregister(this.id,this),this._id=a,H.register(a,this)}),Object.addProperty(H.prototype,"name",Object.ENUMERABLE,function(){return this._name||""},function(a){var b=this.parent,c=this.name;b&&c&&b[c]===this&&delete b[c],this._name=a,b&&a&&!b.hasOwnProperty(a)&&(b[a]=this)}),H.prototype.getPosition=function(a){return a=a||Math.Vector2d.create(),Math.Vector2d.call(a,this.x,this.y),a},H.prototype.setPosition=function(a){return this.x=a.x,this.y=a.y,a},H.prototype.getOrigin=function(a){return a=a||Math.Vector2d.create(),Math.Vector2d.call(a,this.originX,this.originY),a},H.prototype.setOrigin=function(a){return this.originX=a.x,this.originY=a.y,a};var pb=function(a,b){var c=b.parent,d=b.transform;if(c&&pb(a,c),d)a.multiply(d);else{var e=b.originX,f=b.originY,g=b.scale;a.translate(e+b.x,f+b.y).rotate(-b.rotation).scale(g,g).translate(-e,-f)}};H.prototype.getGlobalMatrix=function(){var a=Math.Matrix33(1,0,0,0,1,0,0,0,1);return pb(a,this),a},H.prototype.getLocalMatrix=function(){if(this.transform)return this.transform.clone();var a=this,b=Math.Matrix33(1,0,0,0,1,0,0,0,1),c=a.originX,d=a.originY,e=a.scale;return b.translate(c+a.x,d+a.y).rotate(-a.rotation).scale(e,e).translate(-c,-d),b},H.prototype.appendChild=function(a,b){var c=this.children;return b=void 0===b?c.length:b,a.parent===this?this:(a.parent&&a.parent.removeChild(a),c.splice(b,0,a),a.parent=this,a.name&&!this.hasOwnProperty(a.name)&&(this[a.name]=a),this)},H.prototype.removeChild=function(a){return a.parent!==this?this:(this.children.remove(a),a.parent=null,this[a.name]===a&&delete this[a.name],this)},H.prototype.destroy=function(){return H.unregister(this.id,this),this.parent&&this.parent.removeChild(this),this.destroyChildren(),f.prototype.destroy.call(this),this},H.prototype.destroyChildren=function(){for(var a=this.children,b=a.length;b-->0;)a[b].destroy();return this},H.prototype.captureByBoundingBox=function(a,b){return p.overlap(0,0,this.width,this.height,a,b,1,1)},H.prototype.captureByShape=H.prototype.captureByBoundingBox,H.prototype.captureByPixel=function(){return!1},H.prototype.getLocalBoundingBox=function(a){return a=a||p.create(),p.call(a,0,0,this.width,this.height),a},H.prototype.getGlobalBoundingBox=function(a){a=this.getLocalBoundingBox(a);var b=this.getGlobalMatrix(),c=H.toBoundingBox(a.x,a.y,a.x+a.w,a.y+a.h,b,a);return b.destroy(),c},H.toBoundingBox=function(a,b,c,d,e,f){var g,h,i,j,k=Math.Vector2d(0,0);return f=f||p.create(),k.x=a,k.y=b,k.multiply(e),g=h=k.x,i=j=k.y,k.x=c,k.y=b,k.multiply(e),g=g<k.x?g:k.x,h=h>k.x?h:k.x,i=i<k.y?i:k.y,j=j>k.y?j:k.y,k.x=a,k.y=d,k.multiply(e),g=g<k.x?g:k.x,h=h>k.x?h:k.x,i=i<k.y?i:k.y,j=j>k.y?j:k.y,k.x=c,k.y=d,k.multiply(e),g=g<k.x?g:k.x,h=h>k.x?h:k.x,i=i<k.y?i:k.y,j=j>k.y?j:k.y,p.call(f,g,i,h-g,j-i),Math.Vector2d.free(k),f},jb.Scene=jb.Node.Scene=I,I.prototype=Object.create(H.prototype),I.prototype.constructor=I,Object.addProperty(I.prototype,"color",Object.ENUMERABLE,function(){return this._color},function(a){"string"==typeof a&&(a=ob.getById(a)||C(a)),this._color=a||null}),I.prototype.search=function(a,b,c){return c=c||[],I.searchRecursive(this,a,b,c)},I.searchRecursive=function(a,b,c,d){for(var e=a.children,f=0,g=e.length;g>f;f++){var h=e[f],i=h.getGlobalBoundingBox();!i.overlap(b)||c&&!c(h)||d.push(h),p.free(i)}return d},I.prototype.captureByBoundingBox=function(){return null},I.prototype.captureByShape=function(){return null},I.prototype.captureByPixel=function(){return null},jb.Layout=J,J.prototype=Object.create(H.prototype),J.prototype.constructor=J,J.prototype.camera=null,Object.addProperty(J.prototype,"x",function(){var a=this.camera;return a?a.x-a.width/2/a.zoom:0},jb.NOP),Object.addProperty(J.prototype,"y",function(){var a=this.camera;return a?a.y-a.height/2/a.zoom:0},jb.NOP),Object.addProperty(J.prototype,"width",function(){var a=this.camera;return a?a.width/a.zoom:0},jb.NOP),Object.addProperty(J.prototype,"height",function(){var a=this.camera;return a?a.height/a.zoom:0},jb.NOP),jb.Geometry=K,K.prototype=Object.create(H.prototype),K.prototype.constructor=K,jb.Geometry.Shape=L,L.prototype=Object.create(K.prototype),L.prototype.constructor=L,Object.addProperty(L.prototype,"color",Object.ENUMERABLE,function(){return this._color},function(a){"string"==typeof a&&(a=ob.getById(a)||C(a)),this._color=a||null}),Object.addProperty(L.prototype,"image",Object.ENUMERABLE,function(){return this._image},function(a){"string"==typeof a&&(a=ob.buildAsset(a)),a&&a.status===v.INITIALIZED&&a.load(),this._image=a||null}),Object.addProperty(L.prototype,"gradient",Object.ENUMERABLE,function(){return this._gradient},function(a){if("string"==typeof a){var b=a;if(a=ob.getById(b),!a)throw new m('Gradient "{}" not found in Engine.Asset.Manager'.format(b))}this._gradient=a||null}),Object.addProperty(L.prototype,"stroke",Object.ENUMERABLE,function(){return this._stroke},function(a){"string"==typeof a&&(a=ob.getById(a)||C(a)),this._stroke=a||null}),jb.Rectangle=jb.Geometry.Rectangle=jb.Geometry.Shape.Rectangle=M,M.prototype=Object.create(L.prototype),M.prototype.constructor=M,M.prototype.getLocalBoundingBox=function(a){a=a||p.create();var b=this.width,c=this.height;return p.call(a,-b/2,-c/2,b,c),a},M.prototype.captureByBoundingBox=function(a,b){var c=this.getLocalBoundingBox(),d=p.overlap(c.x,c.y,c.w,c.h,a,b,1,1);return p.free(c),d},M.prototype.captureByShape=M.prototype.captureByBoundingBox,jb.Polygon=jb.Geometry.Polygon=jb.Geometry.Shape.Polygon=N,N.prototype=Object.create(L.prototype),N.prototype.constructor=N,N.isPointInside=function(a,b,c){var d=a.points;if(d.length<3)return!1;var e=0,f=d.last(),g=d.first();N.isCrossing(b,c,f[0],f[1],g[0],g[1])&&e++;for(var h=d.length,i=1;h>i;i++)f=d[i-1],g=d[i],N.isCrossing(b,c,f[0],f[1],g[0],g[1])&&e++;return!!(e%2)},N.isCrossing=function(a,b,c,d,e,f){var g=(f-d)/(e-c),h=d-g*c,i=(b-h)/g;return a>i&&i>=Math.min(c,e)&&i<=Math.max(c,e)},N.prototype.points=null,N.prototype.getLocalBoundingBox=function(a){a=a||p.create();var b=0,c=0,d=0,e=0,f=this.points;if(f){var g=f[0];b=g[0],d=g[1],c=g[0],e=g[1];for(var h=1,i=f.length;i>h;h++){var g=f[h],j=g[0],k=g[1];b=b>j?j:b,d=d>k?k:d,c=j>c?j:c,e=k>e?k:e}}return p.call(a,b,d,c-b,e-d),a},N.prototype.captureByShape=function(a,b){return N.isPointInside(this,a,b)},N.prototype.captureByBoundingBox=function(a,b){var c=this.getLocalBoundingBox(),d=p.overlap(c.x,c.y,c.w,c.h,a,b,1,1);return p.free(c),d},jb.Oval=jb.Geometry.Oval=jb.Geometry.Shape.Oval=O,O.prototype=Object.create(L.prototype),O.prototype.constructor=O,Object.addProperty(O.prototype,"radiusX",function(){return this.width/2},function(a){this.width=2*a}),Object.addProperty(O.prototype,"radiusY",function(){return this.height/2},function(a){this.height=2*a}),Object.addProperty(O.prototype,"radius",null,function(a){var b=2*a;this.width=b,this.height=b}),O.prototype.getLocalBoundingBox=function(a){a=a||p.create();var b=this.radiusX,c=this.radiusY;return p.call(a,-b,-c,2*b,2*c),a},O.prototype.captureByBoundingBox=function(a,b){var c=this.getLocalBoundingBox(),d=p.overlap(c.x,c.y,c.w,c.h,a,b,1,1);return p.free(c),d},O.prototype.captureByShape=function(a,b){var c=this.radiusX,d=this.radiusY;return Math.pow(a,2)/Math.pow(c,2)+Math.pow(b,2)/Math.pow(d,2)<=1},jb.Text=jb.Geometry.Text=jb.Geometry.Shape.Text=P,P.prototype=Object.create(L.prototype),P.prototype.constructor=P,P.AUTO=void 0,P.ALIGN=[P.LEFT="left",P.RIGHT="right",P.CENTER="center",P.JUSTIFY="justify",P.PRE="pre"],P.COLOR="black",P.READY="ready",P.prototype.font=null,Object.addProperty(P.prototype,"textColor",Object.ENUMERABLE|Object.CONFIGURABLE,function(){return this._textColor},function(a){"string"==typeof a&&(a=ob.getById(a)||C(a)),this._textColor=a||null}),P.prototype.text="",P.prototype.spacing=0,P.prototype.lineHeight=P.AUTO,P.prototype.textAlign=P.LEFT,P.prototype.paddingLeft=0,P.prototype.paddingRight=0,P.prototype.paddingTop=0,P.prototype.paddingBottom=0,Object.addProperty(P.prototype,"padding",null,function(a){this.paddingLeft=a,this.paddingRight=a,this.paddingTop=a,this.paddingBottom=a}),jb.Bitmap=Q,Q.prototype=Object.create(K.prototype),Q.prototype.constructor=Q,Q.prototype.getPixel=function(a,b){return jb.Renderer.Bitmap.getPixel(this,a,b)},Q.prototype.setPixel=function(a,b,c){return c=c instanceof C?c:C(c),jb.Renderer.Bitmap.setPixel(this,a,b,c),c},Q.prototype.clear=function(){return jb.Renderer.Bitmap.clear(this),this},Q.prototype.drawNode=function(a,b,c){return jb.Renderer.Bitmap.drawNode(this,a,b,c),this},Q.prototype.getLocalBoundingBox=M.prototype.getLocalBoundingBox,Q.prototype.captureByBoundingBox=M.prototype.captureByBoundingBox,Q.prototype.captureByShape=M.prototype.captureByBoundingBox,jb.Viewport=R,R.stack=[],R.prototype=Object.create(f.prototype),R.prototype.constructor=R,R.prototype.id="",R.prototype.width=0,R.prototype.height=0,Object.addProperty(R.prototype,"fill",Object.CONFIGURABLE,function(){return this._fill},function(a){this._fill=a,a&&sb&&(this.width=sb.getMaxWidth(),this.height=sb.getMaxHeight())}),Object.addProperty(R.prototype,"_fill",Object.WRITABLE,!0),R.prototype.addCamera=function(a){return a.parent===this?!1:(a.parent&&a.parent.removeCamera(a),this.cameras.add(a),a.parent=this,!0)},R.prototype.removeCamera=function(a){return a.parent!==this?!1:(this.cameras.remove(a),a.parent=null,!0)},R.prototype.getCameraByPixel=function(a,b,c){var d=null;if("number"!=typeof a||"number"!=typeof b)return d;c=Array.isArray(c)?c:null;for(var e=p(a,b,1,1),f=p(0,0,0,0),g=this.cameras,h=g.length;h--;){var i=g[h];if((!c||!c.has(i))&&(f.reset(i.left,i.top,i.width,i.height),e.overlap(f))){d=i;break}}return e.destroy(),f.destroy(),d},R.prototype.destroy=function(){this.trigger("destroy"),R.stack.remove(this);for(var a=this.cameras,b=a.length;b-->0;)this.removeCamera(a[b]);f.prototype.destroy.call(this)},jb.Camera=S,S.prototype=Object.create(f.prototype),S.prototype.constructor=S,S.prototype.volume=1,S.prototype.lookingAt=null,S.prototype.x=0,S.prototype.y=0,S.prototype.zoom=1,S.prototype.parent=null,S.isPercent=function(a){return"string"==typeof a&&"%"===a[a.length-1]},S.percentToInt=function(a){return+a.slice(0,-1)},Object.addProperty(S.prototype,"left",Object.CONFIGURABLE,function(){var a=this._left;if(!S.isPercent(a))return a;var b=this.parent;return b?S.percentToInt(a)/100*b.width:0},function(a){this._left=a}),Object.defineProperty(S.prototype,"_left",{enumerable:!1,writable:!0,value:"0%"}),Object.addProperty(S.prototype,"top",Object.CONFIGURABLE,function(){var a=this._top;if(!S.isPercent(a))return a;var b=this.parent;return b?S.percentToInt(a)/100*b.height:0},function(a){this._top=a}),Object.defineProperty(S.prototype,"_top",{enumerable:!1,writable:!0,value:"0%"}),Object.addProperty(S.prototype,"width",Object.CONFIGURABLE,function(){var a=this._width;if(!S.isPercent(a))return a;var b=this.parent;return b?S.percentToInt(a)/100*b.width:0},function(a){this._width=a}),Object.defineProperty(S.prototype,"_width",{enumerable:!1,writable:!0,value:"100%"}),Object.addProperty(S.prototype,"height",Object.CONFIGURABLE,function(){var a=this._height;if(!S.isPercent(a))return a;var b=this.parent;return b?S.percentToInt(a)/100*b.height:0},function(a){this._height=a}),Object.defineProperty(S.prototype,"_height",{enumerable:!1,writable:!0,value:"100%"}),S.prototype.projectX=function(a){return(a-this.x)*this.zoom+this.width/2},S.prototype.projectY=function(a){return(a-this.y)*this.zoom+this.height/2},S.prototype.toSceneX=function(a){return a-=this.width/2,a/this.zoom+this.x},S.prototype.toSceneY=function(a){return a-=this.height/2,a/this.zoom+this.y},S.prototype.getView=function(a){a=a||p.create();var b=this.width/this.zoom,c=this.height/this.zoom,d=this.x-b/2,e=this.y-c/2;return p.call(a,d,e,b,c),a},jb.Renderer=new f,jb.Renderer.Bitmap={setPixel:function(){throw new n("Engine.Renderer.Bitmap.setPixel is not implemented.")},getPixel:function(){throw new n("Engine.Renderer.Bitmap.getPixel is not implemented.")},clear:function(){throw new n("Engine.Renderer.Bitmap.clear is not implemented.")},drawNode:function(){throw new n("Engine.Renderer.Bitmap.drawNode is not implemented.")}},T.prototype.material=null,T.prototype.vertexData=null,T.prototype.indexData=null,T.prototype.texture=null,T.prototype.textureLinearFilteringEnabled=!0,T.prototype.textureRepeatEnabled=!1,T.prototype.blendEnabled=!0,T.prototype.optimize=!0,T.prototype.clipLeft=0,T.prototype.clipTop=0,T.prototype.clipWidth=0,T.prototype.clipHeight=0,T.prototype._verticesBase=-1,T.prototype._first=-1,T.prototype._count=0,T.prototype._skip=0,T.prototype.reset=function(){this._verticesBase=-1,this._first=-1,this._count=0,this._skip=0,this.material=null,this.vertexData=null,this.indexData=null,this.optimize=!0},T.prototype.setIndexValue=function(a,b){if(!(0>a||a>=this._count)){var c=this.indexData;c&&(c[a]=b)}},T.prototype.setVertexPosition=function(a,b,c){var d=this.vertexData;if(d){var e=U.VERTEX_DATA_ELEMENTS*a;if(!(0>a||e>=d.length)){var f=e+U.VERTEX_DATA_OFFSET_POSITION;d[f++]=b,d[f]=c}}},T.prototype.setVertexCoord=function(a,b,c){var d=this.vertexData;if(d){var e=U.VERTEX_DATA_ELEMENTS*a;if(!(0>a||e>=d.length)){var f=e+U.VERTEX_DATA_OFFSET_COORD;d[f++]=b,d[f]=c}}},T.prototype.setVertexColor=function(a,b,c,d,e){var f=this.vertexData;if(f){var g=U.VERTEX_DATA_ELEMENTS*a;if(!(0>a||g>=f.length)){var h=g+U.VERTEX_DATA_OFFSET_COLOR;f[h++]=b,f[h++]=c,f[h++]=d,f[h]=e}}},T.prototype.setVertexMatrix=function(a,b){if(b&&9===b.length){var c=this.vertexData;if(c){var d=U.VERTEX_DATA_ELEMENTS*a;if(!(0>a||d>=c.length)){var e=d+U.VERTEX_DATA_OFFSET_MATRIX_0;c.set(b,e)}}}},T.prototype.fillIndexData=function(a,b){var c=this.indexData,d=a.length;if(c&&(b=b||0,d+b<=c.length)){var e,f,g=this._verticesBase;for(e=b,f=0;d>e;++e,++f)c[e]=g+a[f]}},T.prototype.fillVertexDataPart=function(a,b,c){var d=this.vertexData;if(d)for(var e=U.VERTEX_DATA_ELEMENTS,f=0,g=a.length,h=c,i=d.length,j=0;i>h+j;)d[h+j]=a[f],f++,j++,j>=b&&(j=0,h+=e),f>=g&&(f=0)},T.prototype.fillVerticesMatrix=function(a,b){if(a&&9===a.length){var c=this.vertexData;b=0|(b||0);for(var d=U.VERTEX_DATA_OFFSET_MATRIX_0,e=U.VERTEX_DATA_ELEMENTS,f=9+b+b,g=0,h=a.length,i=d,j=c.length,k=0,l=0;j>i+k;)c[i+k]=a[g],g++,k++,l++,l>2&&(l=0,k+=b),k>=f&&(k=0,i+=e),g>=h&&(g=0)}},U.VERTEX_DATA_ELEMENTS=24,U.VERTEX_DATA_STRIDE=U.VERTEX_DATA_ELEMENTS*Float32Array.BYTES_PER_ELEMENT,U.VERTEX_DATA_CHANNELS_POSITION=2,U.VERTEX_DATA_CHANNELS_COORD=2,U.VERTEX_DATA_CHANNELS_COLOR=4,U.VERTEX_DATA_CHANNELS_EXTRA=4,U.VERTEX_DATA_CHANNELS_MATRIX_0=3,U.VERTEX_DATA_CHANNELS_MATRIX_1=3,U.VERTEX_DATA_CHANNELS_MATRIX_2=3,U.VERTEX_DATA_OFFSET_POSITION=0,U.VERTEX_DATA_OFFSET_COORD=2,U.VERTEX_DATA_OFFSET_COLOR=4,U.VERTEX_DATA_OFFSET_EXTRA=8,U.VERTEX_DATA_OFFSET_MATRIX_0=12,U.VERTEX_DATA_OFFSET_MATRIX_1=16,U.VERTEX_DATA_OFFSET_MATRIX_2=20,U.VERTEX_DATA_OFFSET_POSITION_BYTES=U.VERTEX_DATA_OFFSET_POSITION*Float32Array.BYTES_PER_ELEMENT,U.VERTEX_DATA_OFFSET_COORD_BYTES=U.VERTEX_DATA_OFFSET_COORD*Float32Array.BYTES_PER_ELEMENT,U.VERTEX_DATA_OFFSET_COLOR_BYTES=U.VERTEX_DATA_OFFSET_COLOR*Float32Array.BYTES_PER_ELEMENT,U.VERTEX_DATA_OFFSET_EXTRA_BYTES=U.VERTEX_DATA_OFFSET_EXTRA*Float32Array.BYTES_PER_ELEMENT,U.VERTEX_DATA_OFFSET_MATRIX_0_BYTES=U.VERTEX_DATA_OFFSET_MATRIX_0*Float32Array.BYTES_PER_ELEMENT,U.VERTEX_DATA_OFFSET_MATRIX_1_BYTES=U.VERTEX_DATA_OFFSET_MATRIX_1*Float32Array.BYTES_PER_ELEMENT,U.VERTEX_DATA_OFFSET_MATRIX_2_BYTES=U.VERTEX_DATA_OFFSET_MATRIX_2*Float32Array.BYTES_PER_ELEMENT,U.prototype._glContexts=null,U.prototype._glContextsCount=0,U.prototype._glUsageType=null,U.prototype._packetsCapacity=1e3,U.prototype._verticesCapacity=3e3,U.prototype._indicesCapacity=3e3,U.prototype._packetsStored=0,U.prototype._packetsStoredPrev=0,U.prototype._verticesStored=0,U.prototype._indicesStored=0,U.prototype._vertexBuffer=null,U.prototype._indexBuffer=null,U.prototype._pass=!1,U.prototype._packetsCache=null,U.prototype._packetsCachePrev=null,U.prototype._currentOptimizedPacket=null,U.prototype._verticesViewsCache=null,U.prototype._indicesViewsCache=null,U.prototype._lastDrawCallsCount=0,U.prototype._lastPacketsCount=0,U.prototype._lastVerticesStored=0,U.prototype._lastIndicesStored=0,U.prototype._lastClipChanges=0,Object.defineProperty(U.prototype,"contextsCount",{get:function(){return this._glContextsCount}}),Object.defineProperty(U.prototype,"lastDrawCallsCount",{get:function(){return this._lastDrawCallsCount}}),Object.defineProperty(U.prototype,"lastPacketsCount",{get:function(){return this._lastPacketsCount}}),Object.defineProperty(U.prototype,"verticesStored",{get:function(){return this._verticesStored}}),Object.defineProperty(U.prototype,"lastVerticesStored",{get:function(){return this._lastVerticesStored}}),Object.defineProperty(U.prototype,"verticesCapacity",{get:function(){return this._verticesCapacity}}),Object.defineProperty(U.prototype,"indicesStored",{get:function(){return this._indicesStored}}),Object.defineProperty(U.prototype,"lastIndicesStored",{get:function(){return this._lastIndicesStored}}),Object.defineProperty(U.prototype,"indicesCapacity",{get:function(){return this._indicesCapacity}}),Object.defineProperty(U.prototype,"lastClipChanges",{get:function(){return this._lastClipChanges}}),U.prototype.rebuild=function(a){a=0|(a>0?a:1e3),this._glContexts=this._glContexts||[],this._glContextsCount=this._glContexts.length/5,this._packetsCapacity=a,this._verticesCapacity=3*a,this._indicesCapacity=3*a,this._packetsStored=0,this._packetsStoredPrev=0,this._verticesStored=0,this._indicesStored=0,this._vertexBuffer=new Float32Array(U.VERTEX_DATA_ELEMENTS*this._verticesCapacity),this._indexBuffer=new Uint16Array(this._indicesCapacity),this._packetsCache=[],this._packetsCachePrev=[],this._currentOptimizedPacket=null,this._verticesViewsCache=new e({buffer:this._vertexBuffer.buffer,type:Float32Array,capacity:a,resize:100}),this._indicesViewsCache=new e({buffer:this._indexBuffer.buffer,type:Uint16Array,capacity:a,resize:100}),this._lastDrawCallsCount=0,this._lastPacketsCount=0,this._lastVerticesStored=0,this._lastIndicesStored=0,this._lastClipChanges=0;var b,c=this._packetsCache,d=this._packetsCachePrev,f=this._packetsCapacity;for(b=0;f>b;++b)c.push(Object.create(T.prototype)),d.push(Object.create(T.prototype))},U.prototype.destroy=function(){var a,b,c=this._glContexts,d=c.length;for(a=0;d>a;)b=c[a++],b.deleteBuffer(c[a++]),b.deleteBuffer(c[a++]),b.deleteBuffer(c[a++]),b.deleteBuffer(c[a++]);this._glContexts=null,this._glContextsCount=0,this._vertexBuffer=null,this._indexBuffer=null,this._packetsCache=null,this._packetsCachePrev=null,this._packetsStored=0,this._packetsStoredPrev=0,this._verticesStored=0,this._indicesStored=0,this._currentOptimizedPacket=null,this._verticesViewsCache=null,this._indicesViewsCache=null,this._lastDrawCallsCount=0,this._lastPacketsCount=0,this._lastVerticesStored=0,this._lastIndicesStored=0,this._lastClipChanges=0},U.prototype.findGL=function(a){var b,c=this._glContexts,d=c.length;for(b=0;d>b;b+=5)if(c[b]===a)return b;return-1},U.prototype.initializeGL=function(a){var b,c=this._glContexts,d=this.findGL(a);0>d&&(this._glContextsCount++,d=c.length),c[d++]=a,this._glUsageType=a.STREAM_DRAW,b=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,b),a.bufferData(a.ARRAY_BUFFER,this._vertexBuffer,this._glUsageType),c[d++]=b,b=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,b),a.bufferData(a.ARRAY_BUFFER,this._vertexBuffer,this._glUsageType),c[d++]=b,b=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer,this._glUsageType),c[d++]=b,b=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer,this._glUsageType),c[d]=b,this._pass=!1},U.prototype.releaseGL=function(a){var b=this._glContexts,c=this.findGL(a);0>c||(a.deleteBuffer(b[c+1]),a.deleteBuffer(b[c+2]),a.deleteBuffer(b[c+3]),a.deleteBuffer(b[c+4]),b.splice(c,5),this._glContextsCount--)},U.prototype.render=function(a,b){if(this._optimizeShapePacket(),this._verticesViewsCache.resetPointer(),this._indicesViewsCache.resetPointer(),a){var c=this._glContexts,d=this.findGL(a);if(!(d++<0)&&b&&9===b.length){var e=this._pass,f=c[d++],g=c[d++],h=c[d++],i=c[d],j=e?g:f,k=e?i:h,l=this._verticesStored,m=this._indicesStored,n=this._vertexBuffer,o=this._indexBuffer,p=0,q=0;a.enable(a.SCISSOR_TEST),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),l>0&&(a.bindBuffer(a.ARRAY_BUFFER,j),l<this._verticesCapacity>>1?a.bufferSubData(a.ARRAY_BUFFER,0,new Float32Array(n.buffer,0,this._verticesStored*U.VERTEX_DATA_ELEMENTS)):a.bufferData(a.ARRAY_BUFFER,n,this._glUsageType)),m>0&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,k),m<this._indicesCapacity>>1?a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(o.buffer,0,this._indicesStored*Uint16Array.BYTES_PER_ELEMENT)):a.bufferData(a.ELEMENT_ARRAY_BUFFER,o,this._glUsageType)),e=this._pass=!this._pass,j=e?g:f,k=e?i:h;var r=this._packetsCache,s=this._packetsStored;this._packetsCache=this._packetsCachePrev,this._packetsStored=this._packetsStoredPrev,this._packetsCachePrev=r,this._packetsStoredPrev=s,a.bindBuffer(a.ARRAY_BUFFER,j),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,k);var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=this._packetsCache,P=this._packetsStored,Q=null,R=null,S=null,T=!1,V=0,W=0,X=0,Y=0,Z=[a.uniform1fv,a.uniform2fv,a.uniform3fv,a.uniform4fv,a.uniformMatrix2fv,a.uniformMatrix3fv,a.uniformMatrix4fv];
for(t=0;P>t;++t)if(w=O[t],t+=w._skip,p++,A=w.material)if(G=A._uniforms,B=w.blendEnabled,C=w.clipLeft,D=w.clipTop,E=w.clipWidth,F=w.clipHeight,x=A._shader){if(x!=Q){if(H=A._aPosition,I=A._aCoord,J=A._aColor,K=A._aExtra,L=A._aMatrix0,M=A._aMatrix1,N=A._aMatrix2,0>H){S=A,Q=x;continue}Q&&(a.disableVertexAttribArray(H),0>I||a.disableVertexAttribArray(I),0>J||a.disableVertexAttribArray(J),0>K||a.disableVertexAttribArray(K),L>=0&&M>=0&&N>=0&&(a.disableVertexAttribArray(L),a.disableVertexAttribArray(M),a.disableVertexAttribArray(N))),a.useProgram(x),a.activeTexture(a.TEXTURE0),a.enableVertexAttribArray(H),0>I||a.enableVertexAttribArray(I),0>J||a.enableVertexAttribArray(J),0>K||a.enableVertexAttribArray(K),L>=0&&M>=0&&N>=0&&(a.enableVertexAttribArray(L),a.enableVertexAttribArray(M),a.enableVertexAttribArray(N)),a.vertexAttribPointer(H,U.VERTEX_DATA_CHANNELS_POSITION,a.FLOAT,!1,U.VERTEX_DATA_STRIDE,U.VERTEX_DATA_OFFSET_POSITION_BYTES),0>I||a.vertexAttribPointer(I,U.VERTEX_DATA_CHANNELS_COORD,a.FLOAT,!1,U.VERTEX_DATA_STRIDE,U.VERTEX_DATA_OFFSET_COORD_BYTES),0>J||a.vertexAttribPointer(J,U.VERTEX_DATA_CHANNELS_COLOR,a.FLOAT,!1,U.VERTEX_DATA_STRIDE,U.VERTEX_DATA_OFFSET_COLOR_BYTES),0>K||a.vertexAttribPointer(K,U.VERTEX_DATA_CHANNELS_EXTRA,a.FLOAT,!1,U.VERTEX_DATA_STRIDE,U.VERTEX_DATA_OFFSET_EXTRA_BYTES),L>=0&&M>=0&&N>=0&&(a.vertexAttribPointer(L,U.VERTEX_DATA_CHANNELS_MATRIX_0,a.FLOAT,!1,U.VERTEX_DATA_STRIDE,U.VERTEX_DATA_OFFSET_MATRIX_0_BYTES),a.vertexAttribPointer(M,U.VERTEX_DATA_CHANNELS_MATRIX_1,a.FLOAT,!1,U.VERTEX_DATA_STRIDE,U.VERTEX_DATA_OFFSET_MATRIX_1_BYTES),a.vertexAttribPointer(N,U.VERTEX_DATA_CHANNELS_MATRIX_2,a.FLOAT,!1,U.VERTEX_DATA_STRIDE,U.VERTEX_DATA_OFFSET_MATRIX_2_BYTES))}if(A!=S){for(v=G.length,u=0;v>u;u+=5)Z[G[u+4]](G[u+1],G[u+2]);a.uniformMatrix3fv(A._uViewProjectionLocation,!1,b)}y=w.texture,y!=R&&(z=A._textureLocation,0>z||!y?a.bindTexture(a.TEXTURE_2D,null):(a.bindTexture(a.TEXTURE_2D,y),a.uniform1i(z,0),w.textureLinearFilteringEnabled?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)),w.textureRepeatEnabled?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)))),T!=B&&(B?a.enable(a.BLEND):a.disable(a.BLEND)),(V!=C||W!=D||X!=E||Y!=F)&&(a.scissor(C,D,E,F),++q,V=C,W=D,X=E,Y=F),a.drawElements(a.TRIANGLES,w._count,a.UNSIGNED_SHORT,w._first*Uint16Array.BYTES_PER_ELEMENT),Q=x,S=A,T=B,R=y}else S=A,Q=x;else S=A;a.useProgram(null),a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.disable(a.SCISSOR_TEST),this._lastDrawCallsCount=p,this._lastPacketsCount=this._packetsStored,this._lastVerticesStored=this._verticesStored,this._lastIndicesStored=this._indicesStored,this._lastClipChanges=q,this._packetsStored=0,this._verticesStored=0,this._indicesStored=0,this._currentOptimizedPacket=null}}},U.prototype.requestShapePacket=function(a,b,c,d){if(0>=b&&0>=c)return null;var e=this._verticesStored,f=this._indicesStored;if(this._packetsStored<this._packetsCapacity&&e+b<this._verticesCapacity&&f+c<this._indicesCapacity){this._optimizeShapePacket();var g=this._packetsCache[this._packetsStored++];return g.material=a,g.vertexData=this._verticesViewsCache.obtain(e*U.VERTEX_DATA_STRIDE,b*U.VERTEX_DATA_ELEMENTS),g.indexData=this._indicesViewsCache.obtain(f*Uint16Array.BYTES_PER_ELEMENT,c),d&&(g.clipLeft=d[0],g.clipTop=d[1],g.clipWidth=d[2],g.clipHeight=d[3]),g._first=this._indicesStored,g._count=c,g._skip=0,g._verticesBase=e,this._verticesStored+=b,this._indicesStored+=c,g}return null},U.prototype.amendShapePacket=function(){var a=this._packetsStored;if(a>0){if(a<this._packetsCapacity){this._optimizeShapePacket();var b=this._packetsCache[a-1],c=this._packetsCache[this._packetsStored++];return c.material=b.material,c.texture=b.texture,c.textureLinearFilteringEnabled=b.textureLinearFilteringEnabled,c.textureRepeatEnabled=b.textureRepeatEnabled,c.blendEnabled=b.blendEnabled,c.vertexData=b.vertexData,c.indexData=b.indexData,c.clipLeft=b.clipLeft,c.clipTop=b.clipTop,c.clipWidth=b.clipWidth,c.clipHeight=b.clipHeight,c._first=b._first,c._count=b._count,c._skip=0,c._verticesBase=b._verticesBase,c}return null}return null},U.prototype._optimizeShapePacket=function(){return},function(a,b,c,e){function g(a,b,c,d){this._manager=a,this._id=b,this._meta=c,this._owner=d,this._glResources=[]}function h(a){this.init(a)}if(c.rendererType==c.WEBGL_RENDERER){g.prototype._manager=null,g.prototype._id=null,g.prototype._meta=null,g.prototype._owner=null,g.prototype._glResources=null,g.prototype._createDelayed=!1,g.prototype._destroyDelayed=!1,g.prototype.getResourceGL=function(a){if(!a)return null;var b=this._glResources,c=b.indexOf(a);return 0>c?null:b[c+1]},g.prototype.attachResourceGL=function(a,b){if(a&&b){var c=this._glResources,d=c.indexOf(a);0===c.length&&++this._manager._itemsCount,0>d?c.push(a,b):c[d+1]=b}},g.prototype.detachResourceGL=function(a){var b=this._glResources,c=b.indexOf(a);c>=0&&b.splice(c,2),0===b.length&&--this._manager._itemsCount},h.prototype._glContexts=null,h.prototype._items=null,h.prototype._itemsCount=0,h.prototype._delayedManagementMode=!1,h.prototype._onCreateResourceGL=null,h.prototype._onDestroyResourceGL=null,Object.defineProperty(h.prototype,"itemsCount",{get:function(){return this._itemsCount}}),h.prototype.init=function(a){this.reset(),this._items=[],this._itemsCount=0,this._glContexts=[],this._delayedManagementMode=!1,a&&(a.delayedManagementMode&&(this._delayedManagementMode=!!a.delayedManagementMode),a.onCreateResource&&a.onCreateResource instanceof Function&&(this._onCreateResourceGL=a.onCreateResource),a.onDestroyResource&&a.onDestroyResource instanceof Function&&(this._onDestroyResourceGL=a.onDestroyResource))},h.prototype.free=function(){},h.prototype.reset=function(){this.free(),this._items=null,this._itemsCount=0,this._glContexts=null,this._onCreateResourceGL=null,this._onDestroyResourceGL=null},h.prototype.registerResource=function(a,b,c){var d=this._items,e=this._glContexts;if(!d||!e)return null;var f,h=d.indexOf(c);return h>=0&&this.unregisterResource(c),f=new g(this,a,b,c),this._delayedManagementMode?(f._createDelayed=!0,f._destroyDelayed=!1):this._createResourcesGL(f),d.push(a,f),f},h.prototype.unregisterResource=function(a){var b=this._items;if(!b)return!1;var c,d=b.indexOf(a);return 0>d?!1:(c=b[d+1],this._delayedManagementMode?(c._destroyDelayed=!0,c._createDelayed=!1):(this._destroyResourcesGL(c),b.splice(d,2)),!0)},h.prototype.getResource=function(a){var b,c=this._items;return c?(b=c.indexOf(a),0>b?null:c[b+1]):null},h.prototype.processDelayedResources=function(){if(this._delayedManagementMode){var a=this._items,b=this._glContexts,c=this._onCreateResourceGL,d=this._onDestroyResourceGL;if(a&&b&&c&&d){var e,f,g,h,i=a.length;for(f=1;i>f;f+=2)e=a[f],g=e._createDelayed,h=e._destroyDelayed,e._createDelayed=!1,e._destroyDelayed=!1,g&&!h?this._createResourcesGL(e):h&&!g&&(this._destroyResourcesGL(e),a.splice(f-1,2),f-=2,i-=2)}}},h.prototype.initializeGL=function(a){var b=this._items,c=this._glContexts,d=this._onCreateResourceGL;if(b&&c&&d){c.indexOf(a)<0&&c.push(a);var e,f,g,h=b.length;for(g=1;h>g;g+=2)e=b[g],f=d(a,e._id,e._meta,e._owner),e.attachResourceGL(a,f)}},h.prototype.releaseGL=function(a){var b=this._items,c=this._glContexts,d=this._onDestroyResourceGL;if(b&&c&&d){var e=c.indexOf(a);if(!(0>e)){c.splice(e,1);var f,g,h=b.length;for(g=1;h>g;g+=2)f=b[g],d(a,f._id,f.getResourceGL(a),f._owner),f.detachResourceGL(a)}}},h.prototype._createResourcesGL=function(a){var b=this._glContexts,c=this._onCreateResourceGL;if(a&&b&&c){var d,e,f,g=b.length,h=a._id,i=a._meta,j=a._owner;for(f=0;g>f;++f)d=b[f],e=c(d,h,i,j),a.attachResourceGL(d,e)}},h.prototype._destroyResourcesGL=function(a){var b=this._glContexts,c=this._onDestroyResourceGL;if(a&&b&&c){var d,e,f=b.length,g=a._id,h=a._owner;for(e=0;f>e;++e)d=b[e],c(d,g,a.getResourceGL(d),h),a.detachResourceGL(d)}};var i=e,j=b.mat3,k=9216,l=256,m=4096,n=256,o=2e4;a.WebglRenderer=i;var p=new h({onCreateResource:function(a,b,c){var d=a.createTexture();return a.bindTexture(a.TEXTURE_2D,d),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),a.bindTexture(a.TEXTURE_2D,null),d},onDestroyResource:function(a,b,c){a.deleteTexture(c)}}),q=new h({onCreateResource:function(a,b,c){var d=i.createShaderFromCode(a,c.vertShaderCode,c.fragShaderCode),e=new V({shader:d,uniforms:c.uniforms});return e.initialize(a),e},onDestroyResource:function(a,b,c){c&&c._shader&&(a.deleteProgram(c._shader),c._shader=null)}}),r=new f;r.on("gl-initialized",function(a){s.initializeGL(a),p.initializeGL(a),q.initializeGL(a)}),r.on("gl-restored",function(a){s.initializeGL(a),p.initializeGL(a),q.initializeGL(a)}),r.on("gl-lost",function(a){s.releaseGL(a),p.releaseGL(a),q.releaseGL(a)});var s=new U(o),t=new d({bytesCapacity:k,statesCapacity:l,structure:[{field:"modelTransform",valuesType:Float32Array,count:9},{field:"globalAlpha",valuesType:Float32Array}]}),u=new d({bytesCapacity:m,statesCapacity:n,structure:[{field:"area",valuesType:Float32Array,count:4}]}),v=new Float32Array(9),w=new Float32Array(2),x=new Float32Array(9),y=new Uint16Array([0,1,2,2,3,0]),z=new Float32Array([0,0,0,0,1,0,1,0,1,1,1,1,0,1,0,1]),A=new Float32Array([0,0,0,0,1,0,1,0,1,1,1,1,0,1,0,1]),B=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),C=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),D=[new Float32Array(9),new Float32Array(9)],E=new Float32Array([1,1,1,1]),F=new Float32Array([1,1]),G=new Float32Array([0,0]),I=a.ENGINE_WEBGL_RENDERER_DEBUG_MODE?!!a.ENGINE_WEBGL_RENDERER_DEBUG_MODE:!1,J=a.ENGINE_WEBGL_RENDERER_DEBUG_FRAMES_DELAY?0|a.ENGINE_WEBGL_RENDERER_DEBUG_FRAMES_DELAY:-1,K=0,L=a.ENGINE_WEBGL_RENDERER_DEBUG_LEVEL?0|a.ENGINE_WEBGL_RENDERER_DEBUG_LEVEL:0;Object.defineProperty(i,"nodeStack",{get:function(){return t}}),Object.defineProperty(i,"currentViewProjectionMatrix",{get:function(){return v}}),Object.defineProperty(i,"lastDrawCallsCount",{get:function(){return s.lastDrawCallsCount}}),Object.defineProperty(i,"lastPacketsCount",{get:function(){return s.lastPacketsCount}}),Object.defineProperty(i,"texturesCount",{get:function(){return p.itemsCount}}),Object.defineProperty(i,"clippedWindowSpaceArea",{get:function(){var a=u.current;return a?a.area:null}}),i._onViewportDestroy=function(a){r.trigger("gl-lost",a.ctx)},i._onContextLost=function(a){a.preventDefault(),r.trigger("gl-lost",a.currentTarget.gl)},i._onContextRestored=function(a){a.preventDefault(),r.trigger("gl-restored",a.currentTarget.gl)},i.resourceIdFromPath=function(n){var e=document.getElementsByTagName("base"),o=[window.location.protocol,"//",window.location.host,window.location.pathname].join(""),t=e.length>0?e[0].href:o,r=t.substring(0,t.lastIndexOf("/")),a=r.length;return n.substring(0,a)===r?n.substring(a+1):n},i.onContextInitialized=function(a){r.once("gl-initialized",a)},i.offContextInitialized=function(a){r.off("gl-initialized",a)},i.onContextRestored=function(a){r.on("gl-restored",a)},i.offContextRestored=function(a){r.off("gl-restored",a)},i.onContextLost=function(a){r.on("gl-lost",a)},i.offContextLost=function(a){r.off("gl-lost",a)},i.createContext=function(){var a=document.createElement("canvas").getContext("2d");return a.canvas.width=0,a.canvas.height=0,a},i.createContextFromCanvas=function(a){try{var b={antialias:!1,depth:!1,stencil:!1,alpha:!1,premultipliedAlpha:!1},c=a.getContext("webgl",b)||a.getContext("experimental-webgl",b);return a.gl=c,a.addEventListener("webglcontextlost",i._onContextLost,!1),a.addEventListener("webglcontextrestored",i._onContextRestored,!1),r.trigger("gl-initialized",c),c}catch(d){return null}},i.listenToViewport=function(a){a.once("destroy",i._onViewportDestroy)},i.ctx=i.createContext(),i.currentGL=null,i.currentViewport=null,i.ID=0,i.createShaderFromCode=function(a,b,c){var d,e=a.createShader(a.VERTEX_SHADER),f=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(e,b),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))return d=a.getShaderInfoLog(e),a.deleteShader(e),null;if(a.shaderSource(f,c),a.compileShader(f),!a.getShaderParameter(f,a.COMPILE_STATUS))return d=a.getShaderInfoLog(f),a.deleteShader(e),a.deleteShader(f),null;var g=a.createProgram();return a.attachShader(g,e),a.attachShader(g,f),a.linkProgram(g),a.getProgramParameter(g,a.LINK_STATUS)?g:(d=a.getProgramInfoLog(g),a.deleteShader(e),a.deleteShader(f),a.deleteProgram(g),null)},i.registerTextureImage=function(a,b,c){return p.registerResource(a,b,c)},i.unregisterTextureImage=function(a){p.unregisterResource(a)},i.registerMaterial=function(a,b,c,d){return q.registerResource(a,{vertShaderCode:b,fragShaderCode:c,uniforms:d},null)},i.unregisterMaterial=function(a){q.unregisterResource(a)},i.clipWindowSpace=function(a,b,c,d){var e=u.allocStruct();if(e){var f=u.last,g=e.area,h=f?f.area:null;if(h){var i=a+c,j=b+d,k=h[0],l=h[1],m=h[2],n=h[3],o=k+m,p=l+n,q=a>k?a:k,r=b>l?b:l,s=o>i?i:o,t=p>j?j:p;g[0]=q,g[1]=r,g[2]=s-q,g[3]=t-r}else g[0]=a,g[1]=b,g[2]=c,g[3]=d}},i.makeProjectionMatrixFromCamera=function(a,b){var c=b.zoom;j.identity(a),w[0]=2*c/b.width,w[1]=-2*c/b.height,j.scale(x,a,w),w[0]=-b.x,w[1]=-b.y,j.translate(a,x,w)},i.renderViewport=function(a){var b,c=a.ctx,d=a._dom,e=a.cameras,f=e.length;if(c){for((a.width!==a._cachedWidth||a.height!==a._cachedHeight)&&(d.width=a._cachedWidth=a.width,d.height=a._cachedHeight=a.height),i.currentGL=c,i.currentViewport=a,c.viewport(0,0,a.width,a.height),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT),b=0;f>b;++b)i.renderCamera(c,e[b]);i.currentGL=null,i.currentViewport=null}},i.renderCamera=function(a,b){var c=b.lookingAt;if(!c)return this;var d=b.left,e=b.top,f=b.width,g=b.height,h=c.color,k=1/255;u.pushState(),i.clipWindowSpace(d,e,f,g),h&&(a.clearColor(h.r*k,h.g*k,h.b*k,h.a),a.clear(a.COLOR_BUFFER_BIT));var l={ctx:a,camera:b};i.makeProjectionMatrixFromCamera(v,b),t.pushState(),t.allocStruct();var m=t.current;return i.trigger("preRenderScene",l),m.globalAlpha[0]=1,j.identity(m.modelTransform),i.renderNode(a,c),i.trigger("postRenderScene",l),t.popState(),s.render(a,v),u.popState(),this},i.renderNode=function(a,b){var c=b.clip;t.pushState(),c&&u.pushState(),b.render(a),b._sort&&(b._renderStack.sort(H._renderSort),b._sort=!1);var d,e=b._renderStack,f=e.length;for(d=0;f>d;++d)i.renderNode(a,e[d]);return c&&u.popState(),t.popState(),this},i.renderDirty=function(a,b,c,d,e){var f=q.getResource("rectangleColor"),g=f?f.getResourceGL(a):null,h=t.current,i=h.globalAlpha[0];if(!g||0>=i)return this;E[0]=Math.random(),E[1]=Math.random(),E[2]=Math.random(),E[3]=.2*i,F[0]=d,F[1]=e,G[0]=b,G[1]=c,j.translate(D[1],h.modelTransform,G),j.scale(D[0],D[1],F);var k=u.current,l=s.requestShapePacket(g,4,6,k?k.area:null);return l&&(l.fillIndexData(y,0),l.fillVertexDataPart(z,4,0),l.fillVertexDataPart(E,4,4),l.fillVerticesMatrix(D[0],1)),this},i.renderRectangleColor=function(a,b,c,d,e,f){if(f.a<=0)return this;var g=q.getResource("rectangleColor"),h=g?g.getResourceGL(a):null,i=t.current,k=i.globalAlpha[0];if(!h||0>=k)return this;var l=1/255;E[0]=f.r*l,E[1]=f.g*l,E[2]=f.b*l,E[3]=f.a*k,F[0]=d,F[1]=e,G[0]=b,G[1]=c,j.translate(D[1],i.modelTransform,G),j.scale(D[0],D[1],F);var m=u.current,n=s.requestShapePacket(h,4,6,m?m.area:null);return n&&(n.fillIndexData(y,0),n.fillVertexDataPart(z,4,0),n.fillVertexDataPart(E,4,4),n.fillVerticesMatrix(D[0],1)),this},i.renderRectangleImage=function(a,b,c,d,e,f){var g=!!f.subTextureId,h=q.getResource("rectangleImage"),i=h?h.getResourceGL(a):null,k=t.current,l=k.globalAlpha[0],m=p.getResource(g?f.subTextureId:f.src),n=m?m.getResourceGL(a):null;if(!i||!n||0>=l)return this;E[0]=1,E[1]=1,E[2]=1,E[3]=l,F[0]=d,F[1]=e,G[0]=b,G[1]=c,j.translate(D[1],k.modelTransform,G),j.scale(D[0],D[1],F);var o=u.current,r=s.requestShapePacket(i,4,6,o?o.area:null);if(r){if(r.texture=n,r.fillIndexData(y,0),g){var v=f.subCoordLeft,w=f.subCoordTop,x=f.subCoordRight,B=f.subCoordBottom;A[2]=v,A[3]=w,A[6]=x,A[7]=w,A[10]=x,A[11]=B,A[14]=v,A[15]=B,r.fillVertexDataPart(A,4,0)}else r.fillVertexDataPart(z,4,0);r.fillVertexDataPart(E,4,4),r.fillVerticesMatrix(D[0],1)}return this},i.renderRectangleCustom=function(a,b,c,d,e,f,g,h,i,k){var l=!!g.subTextureId,m=q.getResource(f),n=m?m.getResourceGL(a):null,o=t.current,r=o.globalAlpha[0],v=p.getResource(l?g.subTextureId:g.src),w=v?v.getResourceGL(a):null;if(!n||h.a<=0||!w||0>=r)return this;var x=1/255;E[0]=h.r*x,E[1]=h.g*x,E[2]=h.b*x,E[3]=h.a*r,F[0]=d,F[1]=e,G[0]=b,G[1]=c,j.translate(D[1],o.modelTransform,G),j.scale(D[0],D[1],F);var B=u.current,C=s.requestShapePacket(n,4,6,B?B.area:null);if(C){if(C.texture=w,C.fillIndexData(y,0),l){var H=g.subCoordLeft,I=g.subCoordTop,J=g.subCoordRight,K=g.subCoordBottom;A[2]=H,A[3]=I,A[6]=J,A[7]=I,A[10]=J,A[11]=K,A[14]=H,A[15]=K,C.fillVertexDataPart(A,4,0)}else C.fillVertexDataPart(z,4,0);C.fillVertexDataPart(E,4,4),i&&i.length&&k>0&&C.fillVertexDataPart(i,k,8),C.fillVerticesMatrix(D[0],1)}return this},i.renderOvalColor=function(a,b,c,d,e,f){if(f.a<=0)return this;var g=q.getResource("ovalColor"),h=g?g.getResourceGL(a):null,i=t.current,k=i.globalAlpha[0];if(!h||0>=k)return this;var l=1/255;E[0]=f.r*l,E[1]=f.g*l,E[2]=f.b*l,E[3]=f.a*k,F[0]=d,F[1]=e,G[0]=b,G[1]=c,j.translate(D[1],i.modelTransform,G),j.scale(D[0],D[1],F);var m=u.current,n=s.requestShapePacket(h,4,6,m?m.area:null);return n&&(n.fillIndexData(y,0),n.fillVertexDataPart(B,4,0),n.fillVertexDataPart(E,4,4),n.fillVerticesMatrix(D[0],1)),this},i.renderOvalImage=function(a,b,c,d,e,f){var g=!!f.subTextureId,h=q.getResource("ovalImage"),i=h?h.getResourceGL(a):null,k=t.current,l=k.globalAlpha[0],m=p.getResource(g?f.subTextureId:f.src),n=m?m.getResourceGL(a):null;if(!i||!n||0>=l)return this;E[0]=1,E[1]=1,E[2]=1,E[3]=l,F[0]=d,F[1]=e,G[0]=b,G[1]=c,j.translate(D[1],k.modelTransform,G),j.scale(D[0],D[1],F);var o=u.current,r=s.requestShapePacket(i,4,6,o?o.area:null);if(r){if(r.texture=n,r.fillIndexData(y,0),g){var v=f.subCoordLeft,w=f.subCoordTop,x=f.subCoordRight,z=f.subCoordBottom;C[2]=v,C[3]=w,C[6]=x,C[7]=w,C[10]=x,C[11]=z,C[14]=v,C[15]=z,r.fillVertexDataPart(C,4,0)}else r.fillVertexDataPart(B,4,0);r.fillVertexDataPart(E,4,4),r.fillVerticesMatrix(D[0],1)}return this},i.renderText=function(a,b,c,d,e,f,g,h){var i=q.getResource("rectangleImage"),k=i?i.getResourceGL(a):null,l=t.current;if(!k||l.globalAlpha[0]<=0)return this;G[0]=b,G[1]=c,j.translate(D[0],l.modelTransform,G);var m,n,o,r,v,w,x=u.current,y=!1,z=h.length,A=0;for(w=0;z>w;++w)if(n=p.getResource(h[w]),r=h[++w],v=h[++w],n&&v>0&&(o=n.getResourceGL(a)))if(y)m=s.amendShapePacket(),m&&(m.optimize=!1,m.texture=o,m._first=A+r,m._count=v);else{if(y=!0,m=s.requestShapePacket(k,f,g,x?x.area:null),!m)return this;m.optimize=!1,m.texture=o,m.vertexData.set(d),m.fillVerticesMatrix(D[0],1),m.fillIndexData(e),A=m._first,m._first=A+r,m._count=v}return this},i.REFLOW_RENDER_REPEATS=0,i.reflow=function(){i.stop();var a=R.stack;i.trigger("reflow"),p.processDelayedResources();var b,c,d=a.length,e=1+i.REFLOW_RENDER_REPEATS;for(c=0;e>c;++c)for(b=0;d>b;++b)i.renderViewport(a[b]);i.trigger("reflowed"),I&&--K<=0&&(K=J,i.logCurrentState(L)),i.start()},i.stop=function(){this.ID&&(rb(this.ID),this.ID=0)},i.start=function(){this.ID=this.ID||qb(i.reflow)},i.logCurrentState=function(a){a=0|a;{var b=(s.lastPacketsCount,s.lastDrawCallsCount,s.contextsCount,p.itemsCount,s.verticesCapacity),c=s.lastVerticesStored,d=(c+" / "+b+" ("+(100*c/b).toFixed(2)+"%)",s.indicesCapacity),e=s.lastIndicesStored;e+" / "+d+" ("+(100*e/d).toFixed(2)+"%)",s.lastClipChanges}if(1>a);else{var f,g,h,i,j,k,l,m,n=p._items,o=n.length;for(f=1;o>f;f+=2)if(g=n[f],j=g._glResources,g&&j)for(i=j.length,l=0,m=i>>>1,h=0;i>h;++h)k=j[h],k&&k.isTexture(j[++h])&&++l}}}}(a,Math,jb,jb.Renderer),V.UNIFORM_F1=0,V.UNIFORM_F2=1,V.UNIFORM_F3=2,V.UNIFORM_F4=3,V.UNIFORM_M2=4,V.UNIFORM_M3=5,V.UNIFORM_M4=6,V.prototype._shader=null,V.prototype._uniforms=null,V.prototype._textureLocation=null,V.prototype._aPosition=null,V.prototype._aCoord=null,V.prototype._aColor=null,V.prototype._aExtra=null,V.prototype._aMatrix0=null,V.prototype._aMatrix1=null,V.prototype._aMatrix2=null,V.prototype._uViewProjectionLocation=null,V.prototype.initialize=function(a){var b,c,d,e=this._uniforms,f=this._shader;for(this._aPosition=a.getAttribLocation(f,"se_aPosition"),this._aCoord=a.getAttribLocation(f,"se_aCoord"),this._aColor=a.getAttribLocation(f,"se_aColor"),this._aExtra=a.getAttribLocation(f,"se_aExtra"),this._aMatrix0=a.getAttribLocation(f,"se_aMatrix0"),this._aMatrix1=a.getAttribLocation(f,"se_aMatrix1"),this._aMatrix2=a.getAttribLocation(f,"se_aMatrix2"),this._textureLocation=a.getUniformLocation(f,"se_sBaseTexture"),this._uViewProjectionLocation=a.getUniformLocation(f,"se_uViewProjection"),c=e.length,b=0;c>b;b+=4)d=e[b+2],e[b+1]=a.getUniformLocation(f,e[b])},function(a,b){if(a.rendererType==a.WEBGL_RENDERER){var c="attribute vec2 se_aPosition;\nattribute vec4 se_aColor;\nattribute vec3 se_aMatrix0;\nattribute vec3 se_aMatrix1;\nattribute vec3 se_aMatrix2;\nuniform mat3 se_uViewProjection;\nvarying vec4 vColor;\n\nvoid main()\n{\n   mat3 model = mat3(se_aMatrix0, se_aMatrix1, se_aMatrix2);\n   mat3 modelViewProjection = se_uViewProjection * model;\n   vColor = se_aColor;\n   gl_Position = vec4(modelViewProjection * vec3(se_aPosition, 1.0), 1.0);\n}\n",d="precision mediump float;\nvarying vec4 vColor;\n\nvoid main()\n{\n   gl_FragColor = vColor;\n}\n",e="attribute vec2 se_aPosition;\nattribute vec2 se_aCoord;\nattribute vec4 se_aColor;\nattribute vec3 se_aMatrix0;\nattribute vec3 se_aMatrix1;\nattribute vec3 se_aMatrix2;\nuniform mat3 se_uViewProjection;\nvarying vec2 vCoord;\nvarying vec4 vColor;\n\nvoid main()\n{\n   mat3 model = mat3(se_aMatrix0, se_aMatrix1, se_aMatrix2);\n   mat3 modelViewProjection = se_uViewProjection * model;\n   vCoord = se_aCoord;\n   vColor = se_aColor;\n   gl_Position = vec4(modelViewProjection * vec3(se_aPosition, 1.0), 1.0);\n}\n",f="precision mediump float;\nuniform sampler2D se_sBaseTexture;\nvarying vec2 vCoord;\nvarying vec4 vColor;\n\nvoid main()\n{\n   vec4 tex = texture2D(se_sBaseTexture, vCoord);\n   gl_FragColor = tex * vColor;\n}\n",g="attribute vec2 se_aPosition;\nattribute vec2 se_aCoord;\nattribute vec4 se_aColor;\nattribute vec3 se_aMatrix0;\nattribute vec3 se_aMatrix1;\nattribute vec3 se_aMatrix2;\nuniform mat3 se_uViewProjection;\nvarying vec2 vCoord;\nvarying vec4 vColor;\n\nvoid main()\n{\n   mat3 model = mat3(se_aMatrix0, se_aMatrix1, se_aMatrix2);\n   mat3 modelViewProjection = se_uViewProjection * model;\n   vCoord = se_aPosition;\n   vColor = se_aColor;\n   gl_Position = vec4(modelViewProjection * vec3(se_aPosition, 1.0), 1.0);\n}\n",h="precision mediump float;\nvarying vec2 vCoord;\nvarying vec4 vColor;\n\nvoid main()\n{\n   float f = ceil(1.0 - length(vCoord));\n   gl_FragColor = vColor * vec4(f);\n}\n",i="attribute vec2 se_aPosition;\nattribute vec2 se_aCoord;\nattribute vec4 se_aColor;\nattribute vec3 se_aMatrix0;\nattribute vec3 se_aMatrix1;\nattribute vec3 se_aMatrix2;\nuniform mat3 se_uViewProjection;\nvarying vec2 vPosition;\nvarying vec2 vCoord;\nvarying vec4 vColor;\n\nvoid main()\n{\n   mat3 model = mat3(se_aMatrix0, se_aMatrix1, se_aMatrix2);\n   mat3 modelViewProjection = se_uViewProjection * model;\n   vPosition = se_aPosition;\n   vCoord = se_aCoord;\n   vColor = se_aColor;\n   gl_Position = vec4(modelViewProjection * vec3(se_aPosition, 1.0), 1.0);\n}\n",j="precision mediump float;\nuniform sampler2D se_sBaseTexture;\nvarying vec2 vPosition;\nvarying vec2 vCoord;\nvarying vec4 vColor;\n\nvoid main()\n{\n   float f = ceil(1.0 - length(vPosition));\n   vec4 tex = texture2D(se_sBaseTexture, vCoord);\n   gl_FragColor = tex * vColor * vec4(f);\n}\n";b.registerMaterial("rectangleColor",c,d),b.registerMaterial("rectangleImage",e,f),b.registerMaterial("ovalColor",g,h),b.registerMaterial("ovalImage",i,j)}}(jb,jb.Renderer),function(a,b,c){if(a.rendererType==a.WEBGL_RENDERER){var d=b.mat3,e=b.vec3,f=new Float32Array(3),g=new Float32Array(3),h=new Float32Array(9);c.fillRect=function(a,b,d,e,f,g,h,i){return g&&c.renderRectangleColor(a,b,d,e,f,g),i&&c.renderRectangleImage(a,b,d,e,f,i),this},c.maskRect=function(a,i,j,k,l){var m=c.nodeStack,n=m.current,o=n?n.modelTransform:null,p=c.currentViewProjectionMatrix,q=c.currentViewport;if(o&&p&&q){d.multiply(h,p,o),f[0]=i,f[1]=j,f[2]=1,e.transformMat3(g,f,h);var r=g[0]+1,s=g[1]+1;f[0]=i+k,e.transformMat3(g,f,h);var t=g[0]+1,u=g[1]+1;f[1]=j+l,e.transformMat3(g,f,h);var v=g[0]+1,w=g[1]+1;f[0]=i,e.transformMat3(g,f,h);var x=g[0]+1,y=g[1]+1,z=q.width>>>1,A=q.height>>>1,B=b.min(r,t,v,x)*z,C=b.min(s,u,w,y)*A,D=b.max(r,t,v,x)*z,E=b.max(s,u,w,y)*A;c.clipWindowSpace(B,C,D-B,E-C)}}}}(jb,Math,jb.Renderer),function(a,b){a.rendererType==a.WEBGL_RENDERER&&(jb.Renderer.fillOval=function(a,c,d,e,f,g,h,i){return g&&b.renderOvalColor(a,c,d,e,f,g),i&&b.renderOvalImage(a,c,d,e,f,i),this},jb.Renderer.maskOval=function(){})}(jb,jb.Renderer),function(a,b){a.rendererType==a.WEBGL_RENDERER&&(b.Text={},b.Text.get=function(a){var b=this,c=new XMLHttpRequest;return c.open("GET",a,!0),c.onload=function(c){c.target.status>=200&&c.target.status<400?b.onLoad.call({src:a},c.target.response):b.onError.call({src:a})},c.onerror=b.onError.bind({src:a}),c.send(),c},b.Text.onLoad=function(a){var c=this.src,d=F(this.src);if(d.status===v.LOADING){var e=c.slice(0,c.lastIndexOf("/")+1),f=b.Text.AngelCode.textToJson(a),g=0,h=f.page;g++;for(var i in h)g++,b.Image.get(e+h[i],function(){--g||(d.status=v.READY),b.registerTextureImage(b.resourceIdFromPath(this.src),this,d)},function(){d.status=v.ERROR});g--,d.options=f,g||(d.status=v.READY)}},b.Text.onError=function(){var a=F(this.src);a.options=null,a.status=v.ERROR})}(jb,jb.Renderer),function(a,b){if(a.rendererType==a.CANVAS_RENDERER){var c=b;c.createContext=function(){var a=document.createElement("canvas").getContext("2d");return a.canvas.width=0,a.canvas.height=0,a},c.createContextFromCanvas=function(a){return a.getContext("2d")},c.listenToViewport=function(){},c.ctx=c.createContext(),c.ID=0,c.renderViewport=function(a){var b=a.ctx,d=a._dom;(a.width!==a._cachedWidth||a.height!==a._cachedHeight)&&(a._cachedWidth=a.width,a._cachedHeight=a.height,d.width=a.width,d.height=a.height),b.clearRect(0,0,a.width,a.height);for(var e=a.cameras,f=0,g=e.length;g>f;f++)c.renderCamera(b,e[f])},c.renderCamera=function(a,b){var d=b.lookingAt;if(!d)return this;{var e=b.left,f=b.top,g=b.x,h=b.y,i=b.width,j=b.height,k=b.zoom;a.canvas}a.save(),a.translate(e,f),a.beginPath(),a.rect(0,0,i,j),a.closePath(),a.clip(),d.color&&(a.fillStyle=d.color.index,a.fillRect(0,0,i,j)),a.save(),a.scale(k,k),a.translate(-g+i/2/k,-h+j/2/k);var l={ctx:a,camera:b};return c.trigger("preRenderScene",l),c.renderNode(a,d),c.trigger("postRenderScene",l),a.restore(),a.restore(),this},c.renderNode=function(a,b){a.save(),b.render(a),b.clip&&b.addMask(a),b._sort&&(b._renderStack.sort(H._renderSort),b._sort=!1);for(var d=0,e=b._renderStack,f=e.length;f>d;d++)c.renderNode(a,e[d]);return a.restore(),this},c.renderDirty=function(a,b,c,d,e){var f=255*Math.random()|0,g=255*Math.random()|0,h=255*Math.random()|0,i=.2;return a.fillStyle="rgba("+f+","+g+","+h+","+i+")",a.fillRect(b,c,d,e),this},c.reflow=function(){c.ID=0;var a=R.stack;c.trigger("reflow");for(var b=0,d=a.length;d>b;b++)c.renderViewport(a[b]);c.trigger("reflowed"),c.start()},c.stop=function(){this.ID&&(rb(this.ID),this.ID=0)},c.start=function(){this.ID=this.ID||qb(c.reflow)}}}(jb,jb.Renderer);var qb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,17)},rb=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){return clearTimeout(a)};jb.Renderer.requestAnimationFrame=function(a){return qb(a)},jb.Renderer.cancelAnimationFrame=function(a){return rb(a)},jb.Renderer.Image=new f,jb.Renderer.Image.cache={},jb.Renderer.Image.LOAD="load",jb.Renderer.Image.ERROR="error",jb.Renderer.Image.filesInBatch=0,jb.Renderer.Image.pendingImages=[],jb.Renderer.Image.inLoading=0,jb.Renderer.Image.loadingInterval=setInterval(function(){for(var a;jb.Renderer.Image.pendingImages.length>0&&jb.Renderer.Image.inLoading<jb.Renderer.Image.filesInBatch;)jb.Renderer.Image.inLoading++,a=a||[],a.push(jb.Renderer.Image.pendingImages.shift());for(;a&&a.length;)a.shift()()},100),jb.Renderer.Image.onLoadSynchronized=function(){jb.Renderer.Image.inLoading--},jb.Renderer.Image.onErrorSynchronized=function(){jb.Renderer.Image.inLoading--},jb.Renderer.Image.get=function(a,b,c){function d(){e.src=null,e.addEventListener("error",jb.Renderer.Image.onLoadSynchronized),e.addEventListener("load",jb.Renderer.Image.onErrorSynchronized),e.src=g,f.set(g,e)}var e=this.cache[a],f=this,g=a;return e||(e=new window.Image,e.crossOrigin="anonymous",jb.Renderer.Image.filesInBatch>0?jb.Renderer.Image.pendingImages.push(d):(e.src=null,e.src=g,f.set(g,e))),this.isImageReady(e)?b&&b.call(e):(e.addEventListener("load",b),e.addEventListener("error",c)),e},jb.Renderer.Image._onLoad=function(){var a=jb.Renderer;a.Image.validate(this),a.Image.trigger(a.Image.LOAD,this)},jb.Renderer.Image._onError=function(){var a=jb.Renderer;a.Image.validate(this),a.Image.trigger(a.Image.ERROR,this)},jb.Renderer.Image.validate=function(a){a.width&&a.height?(a.ready=!0,a.fault=!1):"complete"in a&&!a.complete||(a.ready=!1,a.fault=!0)},jb.Renderer.Image.set=function(a,b){return this.cache[a]=b,b.ready=!1,b.fault=!1,b.addEventListener("load",this._onLoad),b.addEventListener("error",this._onError),this.validate(b),this.isImageReady(b)?this.trigger(this.LOAD,b):this.isImageFault(b)&&this.trigger(this.ERROR,b),b},jb.Renderer.Image.isReady=function(a){return this.isImageReady(this.cache[a])},jb.Renderer.Image.isImageReady=function(a){return!(!a||!a.ready)},jb.Renderer.Image.isFault=function(a){return this.isImageFault(this.cache[a])},jb.Renderer.Image.isImageFault=function(a){return!(!a||!a.fault)},jb.Renderer.Pattern={},jb.Renderer.Pattern.cache={},jb.Renderer.Pattern.REPEAT="repeat",jb.Renderer.Pattern.get=function(a){var b=this.cache;return b[a]=b[a]||this.create(a,this.REPEAT)},jb.Renderer.Pattern.create=function(a,b){var c=jb.Renderer;return c.ctx.createPattern(c.Image.get(a),b||this.REPEAT)},jb.Renderer.Gradient={},jb.Renderer.Gradient.cache={},jb.Renderer.Gradient.get=function(a,b,c,d){var e=D.toIndex(a,b,c,d);return this.cache[e]=this.cache[e]||this.create(a,b,c,d)},jb.Renderer.Gradient.getByIndex=function(a){return this.cache[a]||null},jb.Renderer.Gradient.create=function(a,b,c,d){var e=jb.Renderer,f=null;if("linear"===a)f=e.ctx.createLinearGradient(b[0],b[1],c[0],c[1]);else{if("radial"!==a)return null;f=e.ctx.createRadialGradient(b[0],b[1],b[2],c[0],c[1],c[2])}for(var g in d)f.addColorStop(g,d[g]);return f},function(a,b){a.rendererType==a.CANVAS_RENDERER&&(b.Text={},b.Text.get=function(a){return new q({src:a,type:"text",on:{load:this.onLoad,error:this.onError}})},b.Text.onLoad=function(a){function c(){--i||(f.status=v.READY)}function d(){f.status===v.LOADING&&(f.status=v.ERROR)}var e=this.src,f=F(this.src);if(f.status===v.LOADING){var g=e.slice(0,e.lastIndexOf("/")+1),h=b.Text.AngelCode.textToJson(a),i=0,j=h.page;i++;for(var k in j)i++,b.Image.get(g+j[k],c,d);i--,f.options=h,i||(f.status=v.READY)}},b.Text.onError=function(){var a=F(this.src);a.options=null,a.status=v.ERROR})}(jb,jb.Renderer),jb.Renderer.Text.AngelCode={textToJson:function(a){for(var b={},c=a.trim().split("\n"),d=0;d<c.length;d++){var e=c[d],f=/^[a-zA-Z0-9]+/.exec(e);if(f){f=f[0];var g=this.getOptionsFromText(e.slice(f.length).trim());
switch(f){case"chars":case"kernings":break;case"page":b.page=b.page||{},b.page[g.id]=g.file.slice(1,-1);break;case"char":b.char=b.char||{},b.char[g.id]=g,g.chnl=+g.chnl,g.height=+g.height,g.id=+g.id,g.page=+g.page,g.width=+g.width,g.x=+g.x,g.xadvance=+g.xadvance,g.xoffset=+g.xoffset,g.y=+g.y,g.yoffset=+g.yoffset;break;case"kerning":b.kerning=b.kerning||{},b.kerning[[g.first,g.second]]=+g.amount;break;case"common":g.alphaChnl=+g.alphaChnl,g.base=+g.base,g.blueChnl=+g.blueChnl,g.greenChnl=+g.greenChnl,g.lineHeight=+g.lineHeight,g.packed=+g.packed,g.pages=+g.pages,g.redChnl=+g.redChnl,g.scaleH=+g.scaleH,g.scaleW=+g.scaleW,b.common=g;break;case"info":g.aa=+g.aa,g.bold=+g.bold,g.face=g.face.slice(1,-1),g.italic=+g.italic,g.outline=+g.outline,g.padding=g.padding.split(",").map(Math.round),g.size=+g.size,g.smooth=+g.smooth,g.spacing=g.spacing.split(",").map(Math.round),g.stretchH=+g.stretchH,g.unicode=+g.unicode,b.info=g;break;default:b[f]=g}}}return b},getOptionsFromText:function(a,b){b=b||{};for(var c=/([a-zA-Z0-9]+=\"[\-\_\.\s\,a-zA-Z0-9]+\")|([a-zA-Z0-9]+=[\-\.\,a-zA-Z0-9]+)/g,d=null;d=c.exec(a);)d=d[0].split("="),b[d[0]]=d[1];return b}},jb.Renderer.Text.Color={},jb.Renderer.Text.Color.cache={},jb.Renderer.Text.Color.get=function(a,b){var c=jb.Renderer,d=a+";"+b;if(!this.cache[d]){var e=c.Image.get(a);if(c.Image.isImageReady(e))return this.cache[d]=this.fillPNG(null,e,b)}return this.cache[d]},jb.Renderer.Text.Color.fillPNG=function(a,b,c){a=a||jb.Renderer.createContext();var d=b.width,e=b.height;return a.canvas.width=d,a.canvas.height=e,a.save(),a.fillStyle=c.index,a.fillRect(0,0,d,e),a.globalCompositeOperation="destination-in",a.drawImage(b,0,0),a.restore(),a.canvas},jb.Renderer.Text.LN="\n",jb.Renderer.Text.WHITESPACE_WORD_REGEX=/(\n|\s+|\S+)/g,jb.Renderer.Text.NO_WHITESPACE_WORD_REGEX=/(\n|\s{1}|\S{1})/g,jb.Renderer.Text.WORD_REGEX=jb.Renderer.Text.WHITESPACE_WORD_REGEX,jb.Renderer.Text.WHITESPACE_REGEX=/^\s+$/,jb.Renderer.Text.SPACE=" ",jb.Renderer.Text.SPACE_CODE=" ".charCodeAt(0),jb.Renderer.Text.prepare=function(a,b,c,d,e,f){{var g=jb.Renderer.Text,h=(b.pages,b.common);b.chars,b.kerning}f=f||0,e=void 0===e?h.lineHeight:e,d=d||P.LEFT;var i,j=0,k=c,l=1/0;d===P.PRE?(a=String(a),i=[a]):(a=String(a).trim().replace(g.WORD_REGEX,g.normalize),i=a.match(g.WORD_REGEX)||[]);for(var m=0,n=0,o=c,p=0,q=[],r=null,s=0,t=0,u=0;u<i.length;u++)switch(r=r||[],!0){case i[u]===g.LN:m=0,n+=e,q.add(r),r=null;break;default:var v=new this.Word(i[u],b,e,c,f),w=v.x,x=v.y,y=v.w,z=v.h;if(t=Math.max(v.exceededWidth,t),u>0&&m+w+y>k&&(q.add(r),r=[],m=0,n+=e),!r.length&&g.WHITESPACE_REGEX.test(v.text))continue;v.ox=m,v.oy=n,r.push(v),p=Math.max(j,Math.min(Math.max(p,n+x+z),l)),m+=w+y,q.add(r)}d!==P.PRE&&this.align(q,d,o);var A,B,C,D=q.length;for(A=0;D>A;++A)for(r=q[A],C=r.length,B=0;C>B;++B)v=r[B],s+=v.length;return{width:o,height:p,lines:q,visibleChars:s,exceededWidth:t}},jb.Renderer.Text.normalize=function(a){var b=jb.Renderer.Text;return a===b.LN?b.LN:b.WHITESPACE_REGEX.test(a)?b.SPACE:a},jb.Renderer.Text.align=function(a,b,c){for(var d=0;d<a.length;d++){var e,f,g,h,i=this.trim(a[d]);if(i.length)switch(b){case P.RIGHT:for(e=i.last(),f=c,g=f-(e.ox+e.x+e.w),h=0;h<i.length;h++)i[h].ox+=g;break;case P.CENTER:for(e=i.last(),f=c,g=(f-(e.ox+e.x+e.w))/2,h=0;h<i.length;h++)i[h].ox+=g;break;case P.JUSTIFY:if(d===a.length-1)break;for(e=i.last(),f=c,g=f-(e.ox+e.x+e.w),h=1;h<i.length;h++)i[h].ox+=parseInt(g*(h/(i.length-1)));break;case P.LEFT:}}},jb.Renderer.Text.trim=function(a){return a.length?(jb.Renderer.Text.WHITESPACE_REGEX.test(a.first().text)&&a.shift(),a.length?(jb.Renderer.Text.WHITESPACE_REGEX.test(a.last().text)&&a.pop(),a):a):a},jb.Renderer.Text.Word=function(a,b,c,d,e){this.ox=0,this.oy=0,this.length=0,this.text=a,this.exceededWidth=0;var f=jb.Renderer.Text,g=b.char,h=b.kerning,i=0,j=0,k=0,l=0,m=0,n=0,o=0;a=a.split("");for(var p=0,q=a.length;q>p;p++)switch(!0){case a[p]===f.LN||"|"===a[p]:m=0,n+=c,i=Math.min(m,i),j=Math.min(n,j),k=Math.max(k,m),l=Math.max(l,n+c);break;default:var r=a[p].charCodeAt(0),s=g[r]||g[f.SPACE_CODE],t=s.x,u=s.y,v=s.width,w=s.height,x=s.xoffset,y=s.yoffset,z=s.xadvance,A=s.page,B=h&&h[[o,r]]||0;m+x+v>d?(m+=x,d>0&&(this.exceededWidth=m+x+v)):m+=x,i=Math.min(m,i),j=Math.min(n,j),k=Math.max(k,m+v),l=Math.max(l,n+y+w),Array.prototype.push.call(this,new f.Character(m,n+y,t,u,v,w,A)),m+=z,m+=B,m+=e,o=r}this.x=i,this.y=j,this.w=k-i,this.h=l-j},jb.Renderer.Text.Character=function(a,b,c,d,e,f,g){this.dx=a,this.dy=b,this.sx=c,this.sy=d,this.sw=e,this.sh=f,this.page=g},function(a,b){a.rendererType==a.CANVAS_RENDERER&&(b.fillRect=function(a,b,c,d,e,f,g,h,i){return f&&(a.fillStyle=f.index,a.fillRect(b,c,d,e)),g&&(a.fillStyle=this.Gradient.getByIndex(g.index)||this.Gradient.get(g.type,g.from,g.to,g.stop),a.fillRect(b,c,d,e)),h&&h._dom&&a.drawImage(h._dom,b,c,d,e),i&&(a.strokeStyle=i.index,a.strokeRect(b,c,d,e)),this},b.maskRect=function(a,b,c,d,e){a.beginPath(),a.rect(b,c,d,e),a.closePath(),a.clip()})}(jb,jb.Renderer),function(a){a.rendererType==a.CANVAS_RENDERER&&(jb.Renderer.KAPPA=.5522848,jb.Renderer.fillOval=function(a,b,c,d,e,f,g,h,i){a.save();var j=b-d,k=c-e,l=2*d,m=2*e,n=e/d;return a.beginPath(),a.scale(1,n),a.arc(b,c,d,0,2*Math.PI),a.closePath(),a.save(),a.clip(),a.scale(1,1/n),f&&(a.fillStyle=f.index,a.fillRect(j,k,l,m)),g&&(a.fillStyle=this.Gradient.getByIndex(g.index)||this.Gradient.get(g.type,g.from,g.to,g.stop),a.fillRect(j,k,l,m)),h&&h._dom&&a.drawImage(h._dom,j,k,l,m),a.restore(),i&&(a.strokeStyle=i.index,a.stroke()),a.restore(),this},jb.Renderer.maskOval=function(a,b,c,d,e){var f=e/d;a.beginPath(),a.scale(1,f),a.arc(b,c,d,0,2*Math.PI),a.closePath(),a.clip(),a.scale(1,1/f)})}(jb,jb.Renderer),jb.Renderer.fillPolygon=function(a,b,c,d,e,f){if(!b||b.length<2)return this;a.save(),a.beginPath();var g=b[0],h=g[0],i=g[1],j=h,k=h,l=i,m=i,n=0,o=0;a.moveTo(h,i);for(var p=1,q=b.length;q>p;p++)g=b[p],h=g[0],i=g[1],j=j>h?h:j,l=l>i?i:l,k=h>k?h:k,m=i>m?i:m,a.lineTo(h,i);return g=b[0],a.lineTo(g[0],g[1]),a.closePath(),a.save(),a.clip(),h=j,i=l,n=k-j,o=m-l,c&&(a.fillStyle=c.index,a.fillRect(h,i,n,o)),d&&(a.fillStyle=this.Gradient.getByIndex(d.index)||this.Gradient.get(d.type,d.from,d.to,d.stop),a.fillRect(h,i,n,o)),e&&e._dom&&a.drawImage(e._dom,h,i,n,o),a.restore(),f&&(a.strokeStyle=f.index,a.stroke()),a.restore(),this},jb.Renderer.maskPolygon=function(a,b){if(!b||b.length<2)return this;a.beginPath();var c=b[0],d=c[0],e=c[1],f=d,g=d,h=e,i=e;a.moveTo(d,e);for(var j=1,k=b.length;k>j;j++)c=b[j],d=c[0],e=c[1],f=f>d?d:f,h=h>e?e:h,g=d>g?d:g,i=e>i?e:i,a.lineTo(d,e);return c=b[0],a.lineTo(c[0],c[1]),a.closePath(),a.clip(),this},jb.Renderer.Bitmap.setPixel=function(a,b,c,d){var e=this._getImageData(a),f=4*(c*a.width+b),g=e.data;return g[f++]=d.r,g[f++]=d.g,g[f++]=d.b,g[f]=255*d.a,a._dirty=!0,d},jb.Renderer.Bitmap.getPixel=function(a,b,c){var d=this._getImageData(a),e=4*(c*a.width+b),f=d.data;return C(f[e++],f[e++],f[e++],f[e]/255)},jb.Renderer.Bitmap.clear=function(a){var b=a._cache;b.width=this.width,b.height=this.height,a._imageData=null},jb.Renderer.Bitmap._getImageData=function(a){var b=a.width,c=a.height,d=a._cacheCtx,e=a._imageData||d.getImageData(0,0,b,c);return(a.width!==e.width||a.height!==e.height)&&this._resize(a,e.width,e.height,b,c),a._imageData=e},jb.Renderer.Bitmap._resize=function(a,b,c,d,e){var f=a._cacheCtx,g=f.canvas,h=b&&c?f.getImageData(0,0,b,c):null;g.width=d,g.height=e,h&&f.putImageData(h,0,0),a._imageData=f.getImageData(0,0,d,e)},jb.Renderer.Bitmap.drawNode=function(a,b,c,d){var e=a._cacheCtx,f=e.canvas,g=f.width,h=f.height;(g!==a.width||h!==a.height)&&this._resize(a,g,h,a.width,a.height),e.save(),e.translate(b,c),jb.Renderer.renderNode(e,d),e.restore(),a._imageData=e.getImageData(0,0,a.width,a.height)},jb.Font.PATH="fonts/",Object.addProperty(R.prototype,"_cachedWidth",Object.WRITABLE,0),Object.addProperty(R.prototype,"_cachedHeight",Object.WRITABLE,0),Object.defineProperty(R.prototype,"_dom",{get:function(){var a=document.getElementById(this.id)||document.createElement("canvas");return Object.addProperty(this,"_dom",a),a}}),Object.defineProperty(R.prototype,"ctx",{get:function(){var a=jb.Renderer,b=this._dom,c=a.createContextFromCanvas(b);return a.listenToViewport(this),Object.addProperty(this,"ctx",c),c}}),window.addEventListener("resize",function(){for(var a=R.stack,b=0,c=a.length;c>b;b++){var d=a[b];d.fill&&(d.width=sb.getMaxWidth(),d.height=sb.getMaxHeight())}});var sb={getMaxWidth:function(){return innerWidth},getMaxHeight:function(){return innerHeight}};!function(a,b){a.rendererType==a.CANVAS_RENDERER&&(H.prototype.render=function(a){var b=this.transform;if(a.globalAlpha*=this.opacity,b)return a.transform(b.m11,b.m12,b.m21,b.m22,b.m31,b.m32);var c=this.originX,d=this.originY,e=this.rotation,f=this.scale,g=this.x,h=this.y;a.translate(g+c,h+d),a.rotate(-e),a.scale(f,f),a.translate(-c,-d)},H.prototype.addMask=function(a){b.maskRect(a,0,0,this.width,this.height)},Object.addProperty(H.prototype,"_sort",Object.WRITABLE,!1),H._renderSort=function(a,b){return a._zIndex-b._zIndex||a.index-b.index},Object.addProperty(H.prototype,"_zIndex",Object.WRITABLE,0),Object.defineProperty(H.prototype,"zIndex",{set:function(a){this._zIndex=a,this._parent&&(this._parent._sort=!0)},get:function(){return this._zIndex}}),Object.defineProperty(H.prototype,"_renderStack",{get:function(){var a=[];return Object.addProperty(this,"_renderStack",Object.CONFIGURABLE|Object.ENUMERABLE|Object.WRITABLE,a),a}}),Object.addProperty(H.prototype,"_parent",Object.WRITABLE,null),Object.defineProperty(H.prototype,"parent",{set:function(a){var b=this._parent;b&&b._renderStack.remove(this),this._parent=a,a&&(a._renderStack.add(this),a._sort=!0)},get:function(){return this._parent}}))}(jb,jb.Renderer),function(a,b,c){if(a.rendererType==a.WEBGL_RENDERER){var d=b.mat3,e=new Float32Array(2),f=new Float32Array(9);H.prototype.render=function(a){var b=c.nodeStack,g=b.allocStruct(),h=g.globalAlpha,i=g.modelTransform,j=b.last,k=j.globalAlpha,l=j.modelTransform,m=this.transform;if(h[0]=k[0]*this.opacity,m)return void d.multiply(i,l,m.stream);var n=this.originX,o=this.originY,p=this.rotation,q=this.scale;d.copy(i,l),e[0]=this.x+n,e[1]=this.y+o,d.translate(f,i,e),d.rotate(i,f,-p),e[0]=q,e[1]=q,d.scale(f,i,e),e[0]=-n,e[1]=-o,d.translate(i,f,e),this.clip&&this.addMask(a)},H.prototype.addMask=function(a){c.maskRect(a,0,0,this.width,this.height)},Object.addProperty(H.prototype,"_sort",Object.WRITABLE,!1),H._renderSort=function(a,b){return a._zIndex-b._zIndex||a.index-b.index},Object.addProperty(H.prototype,"_zIndex",Object.WRITABLE,0),Object.defineProperty(H.prototype,"zIndex",{set:function(a){this._zIndex=a,this._parent&&(this._parent._sort=!0)},get:function(){return this._zIndex}}),Object.defineProperty(H.prototype,"_renderStack",{get:function(){var a=[];return Object.addProperty(this,"_renderStack",Object.CONFIGURABLE|Object.ENUMERABLE|Object.WRITABLE,a),a}}),Object.addProperty(H.prototype,"_parent",Object.WRITABLE,null),Object.defineProperty(H.prototype,"parent",{set:function(a){var b=this._parent;b&&b._renderStack.remove(this),this._parent=a,a&&(a._renderStack.add(this),a._sort=!0)},get:function(){return this._parent}})}}(jb,Math,jb.Renderer),I.prototype.captureByBoundingBox=function(a,b,c){var d=Math.Matrix.I(3),e=I._captureByBoundingBox(this,a,b,c,d);return Math.Matrix33.free(d),e},I.prototype.captureByShape=function(a,b,c){var d=Math.Matrix.I(3),e=I._captureByShape(this,a,b,c,d);return Math.Matrix33.free(d),e},I.prototype.captureByPixel=function(a,b,c){var d=jb.Renderer.ctx;d.canvas.width=1,d.canvas.height=1,d.save(),d.setTransform(1,0,0,1,-a,-b);var e=I._captureByPixel(d,this,c);return d.restore(),e},I._captureByBoundingBox=function(a,b,c,d,e){for(var f=a._renderStack,g=f.length;g--;){var h=f[g],i=h.getLocalMatrix(),j=Math.Matrix33();e.multiply(i,j);var k=j.clone().inverse(),l=Math.Vector2d(b,c).multiply(k),m=I._captureByBoundingBox(h,b,c,d,j);if(m||!h.captureByBoundingBox(l.x,l.y)||d&&!d(h)||(m=h),Math.Matrix33.free(j),Math.Matrix33.free(i),Math.Matrix33.free(k),Math.Vector2d.free(l),m)return m}return null},I._captureByShape=function(a,b,c,d,e){for(var f=a._renderStack,g=f.length;g--;){var h=f[g],i=h.getLocalMatrix().multiply(e),j=i.clone().inverse(),k=Math.Vector2d(b,c).multiply(j),l=I._captureByShape(h,b,c,d,i);if(l||d&&!d(h)||!h.captureByShape(k.x,k.y)||(l=h),Math.Matrix33.free(i),Math.Matrix33.free(j),Math.Vector2d.free(k),l)return l}return null},I._captureByPixel=function(a,b,c){for(var d=b._renderStack,e=d.length;e--;){var f=d[e];a.save(),f.render(a);var g=I._captureByPixel(a,f);if(g||c&&!c(f)||!a.getImageData(0,0,1,1).data[3]||(g=f),a.restore(),g)return g}return null},Object.addProperty(Q.prototype,"_cache",function(){var a=this._cacheCtx.canvas;return Object.addProperty(this,"_cache",Object.WRITABLE,a),a},null),Object.addProperty(Q.prototype,"_cacheCtx",function(){var a=jb.Renderer.createContext();return Object.addProperty(this,"_cacheCtx",Object.WRITABLE,a),a},null),Q.prototype._dirty=!1,Q.prototype._imageData=null,Q.prototype.render=function(a){H.prototype.render.call(this,a);var b=this.width,c=this.height,d=this._cache;if(this._dirty){var e=this._cacheCtx;d.width=b,d.height=c,e.putImageData(this._imageData,0,0),this._dirty=!1}a.drawImage(d,-b/2,-c/2)},Q.prototype.addMask=function(a){var b=this.width,c=this.height;jb.Renderer.maskRect(a,-b/2,-c/2,b,c)},M.prototype.render=function(a){H.prototype.render.call(this,a);var b=this.width,c=this.height,d=-b/2,e=-c/2;jb.Renderer.fillRect(a,d,e,b,c,this.color,this.gradient,this.image,this.stroke)},M.prototype.addMask=function(a){var b=this.width,c=this.height;jb.Renderer.maskRect(a,-b/2,-c/2,b,c)},N.prototype.render=function(a){H.prototype.render.call(this,a),jb.Renderer.fillPolygon(a,this.points,this.color,this.gradient,this.image,this.stroke)},N.prototype.addMask=function(a){jb.Renderer.maskPolygon(a,this.points)},O.prototype.render=function(a){H.prototype.render.call(this,a);var b=this.radiusX,c=this.radiusY;jb.Renderer.fillOval(a,0,0,b,c,this.color,this.gradient,this.image,this.stroke)},O.prototype.addMask=function(a){jb.Renderer.maskOval(a,0,0,this.radiusX,this.radiusY)},function(a){function b(a,b,c,d,e){for(var f=jb.Renderer.Text.Color,g=c.page,h=0,i=d.length;i>h;h++)for(var j=d[h],k=0,l=j.length;l>k;k++)for(var m=j[k],n=m.ox,o=m.oy,p=0,q=m.length;q>p;p++){var r=m[p],s=e+g[r.page],t=f.get(s,b),u=n+r.dx,v=o+r.dy,w=r.sx,x=r.sy,y=r.sw,z=r.sh;y&&z&&t&&a.drawImage(t,w,x,y,z,u,v,y,z)}}a.rendererType==a.CANVAS_RENDERER&&(P.prototype.render=function(a){H.prototype.render.call(this,a),this._prepareBuffer();var b=0,c=0,d=this._width,e=this.height,f=this.color;f&&(a.fillStyle=f.index,a.fillRect(b,c,d,e));var g=this.gradient;g&&(a.fillStyle=jb.Renderer.Gradient.getByIndex(g.index)||jb.Renderer.Gradient.get(g.type,g.from,g.to,g.stop),a.fillRect(b,c,d,e));var h=this.image;h&&h._dom&&a.drawImage(h._dom,b,c,d,e),!this._recalculate&&this._width&&this.height&&a.drawImage(this._buffer.canvas,this.paddingLeft,this.paddingTop);var i=this.stroke;i&&(a.strokeStyle=i.index,a.strokeRect(b,c,d,e))},P.prototype.addMask=function(a){var b=this.width,c=this.height;jb.Renderer.maskRect(a,0,0,b,c)},P.prototype._prepareBuffer=function(){var a=this.font,c=this._buffer,d=c.canvas;if(this._recalculate&&a&&a.status===v.READY){var e=jb.Renderer.Text.prepare(this.text,a.options,this.width-this.paddingLeft-this.paddingRight,this.textAlign,this.lineHeight,this.spacing),f=e.lines,g=a.src.slice(0,a.src.lastIndexOf("/"));d.width=e.width,d.height=e.height,b(c,this.textColor,a.options,f,g+"/"),this._recalculate=!1,this.height=e.height+this.paddingTop+this.paddingBottom,this.exceededWidth=e.exceededWidth}},P.prototype._recalculate=!0,Object.addProperty(P.prototype,"exceededWidth",Object.ENUMERABLE|Object.WRITABLE,0),Object.addProperty(P.prototype,"_buffer",function(){var a=jb.Renderer.createContext();return Object.addProperty(this,"_buffer",Object.WRITABLE,a),a},null),Object.addProperty(P.prototype,"width",Object.ENUMERABLE,function(){return this._width},function(a){this._width=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_width",Object.WRITABLE,0),Object.addProperty(P.prototype,"font",Object.ENUMERABLE,function(){return this._font},function(a){this._font=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_font",Object.WRITABLE,null),function(){var a=Object.getOwnPropertyDescriptor(P.prototype,"textColor"),b=a.get,c=a.set;Object.addProperty(P.prototype,"textColor",Object.ENUMERABLE,b,function(a){c.call(this,a),this._recalculate=!0})}(),Object.addProperty(P.prototype,"text",Object.ENUMERABLE,function(){return this._text},function(a){this._text=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_text",Object.WRITABLE,""),Object.addProperty(P.prototype,"spacing",Object.ENUMERABLE,function(){return this._spacing},function(a){this._spacing=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_spacing",Object.WRITABLE,0),Object.addProperty(P.prototype,"lineHeight",Object.ENUMERABLE,function(){return this._lineHeight},function(a){this._lineHeight=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_lineHeight",Object.WRITABLE,void 0),Object.addProperty(P.prototype,"textAlign",Object.ENUMERABLE,function(){return this._textAlign},function(a){this._textAlign=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_textAlign",Object.WRITABLE,P.LEFT),Object.addProperty(P.prototype,"paddingLeft",Object.ENUMERABLE,function(){return this._paddingLeft},function(a){this._paddingLeft=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingLeft",Object.WRITABLE,0),Object.addProperty(P.prototype,"paddingTop",Object.ENUMERABLE,function(){return this._paddingTop},function(a){this._paddingTop=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingTop",Object.WRITABLE,0),Object.addProperty(P.prototype,"paddingRight",Object.ENUMERABLE,function(){return this._paddingRight},function(a){this._paddingRight=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingRight",Object.WRITABLE,0),Object.addProperty(P.prototype,"paddingBottom",Object.ENUMERABLE,function(){return this._paddingBottom},function(a){this._paddingBottom=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingBottom",Object.WRITABLE,0))}(jb,jb.Renderer),function(a,b){function c(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=d.page,F=[],G=0,H=0,I=0,J=d.common.scaleW,K=d.common.scaleH,L=J>0?1/J:1,M=K>0?1/K:1,N=c?c.r/255:1,O=c?c.g/255:1,P=c?c.b/255:1,Q=c.a,R=[];for(l in E)E.hasOwnProperty(l)&&F.push([],f+E[l]);for(y=0,z=e.length;z>y;++y)for(g=e[y],A=0,B=g.length;B>A;++A)for(h=g[A],i=h.ox,j=h.oy,C=0,D=h.length;D>C;++C)k=h[C],o=k.sw,p=k.sh,q=i+k.dx,r=j+k.dy,s=q+o,t=r+p,u=k.sx*L,v=k.sy*M,w=(k.sx+o)*L,x=(k.sy+p)*M,o>0&&p>0&&(a[G++]=q,a[G++]=r,a[G++]=u,a[G++]=v,a[G++]=N,a[G++]=O,a[G++]=P,a[G++]=Q,G+=16,a[G++]=s,a[G++]=r,a[G++]=w,a[G++]=v,a[G++]=N,a[G++]=O,a[G++]=P,a[G++]=Q,G+=16,a[G++]=s,a[G++]=t,a[G++]=w,a[G++]=x,a[G++]=N,a[G++]=O,a[G++]=P,a[G++]=Q,G+=16,a[G++]=q,a[G++]=t,a[G++]=u,a[G++]=x,a[G++]=N,a[G++]=O,a[G++]=P,a[G++]=Q,G+=16,F[k.page<<1].push(I,I+1,I+2,I+2,I+3,I),I+=4);for(H=0,A=0,D=F.length,y=0,z=D;z>y;++y)l=F[y],m=F[++y],n=l.length,b.set(l,H),n>0&&(R.push(m,H,n),++A),H+=n;return A>0?R:null}a.rendererType==a.WEBGL_RENDERER&&(P.prototype._vertexData=null,P.prototype._indexData=null,P.prototype._verticesCount=0,P.prototype._indicesCount=0,P.prototype._recalculate=!0,P.prototype._packets=null,P.prototype.render=function(a){H.prototype.render.call(this,a),this._prepareBuffer();var c=(this._width,this.height,this._vertexData),d=this._indexData,e=this._verticesCount,f=this._indicesCount,g=this._packets;c&&d&&e>0&&f>0&&g&&b.renderText(a,this.paddingLeft,this.paddingTop,c,d,e,f,g)},P.prototype.addMask=function(){},P.prototype._prepareBuffer=function(){var a,b,d=this.font;if(this._recalculate&&d&&d.status===v.READY){var e,f=5;do if(e=jb.Renderer.Text.prepare(this.text,d.options,this.width-this.paddingLeft-this.paddingRight,this.textAlign,this.lineHeight,this.spacing),e.exceededWidth>0)if(e.exceededWidth>this.width){var g=this.width/e.exceededWidth;this.scale*=g,this.width=e.exceededWidth}else e.exceededWidth=0;while(e.exceededWidth>0&&--f>0);var h=e.lines,i=e.visibleChars,j=4*i,k=6*i,l=d.src.slice(0,d.src.lastIndexOf("/"));a=new Float32Array(U.VERTEX_DATA_ELEMENTS*j),b=new Uint16Array(k),this._packets=c(a,b,this.textColor,d.options,h,l+"/"),this._recalculate=!1,this.height=e.height+this.paddingTop+this.paddingBottom,this._vertexData=a,this._indexData=b,this._verticesCount=j,this._indicesCount=k}},Object.addProperty(P.prototype,"_buffer",function(){var a=jb.Renderer.createContext();return Object.addProperty(this,"_buffer",Object.WRITABLE,a),a},null),Object.addProperty(P.prototype,"width",Object.ENUMERABLE,function(){return this._width},function(a){this._width=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_width",Object.WRITABLE,0),Object.addProperty(P.prototype,"font",Object.ENUMERABLE,function(){return this._font},function(a){this._font=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_font",Object.WRITABLE,null),function(){var a=Object.getOwnPropertyDescriptor(P.prototype,"textColor"),b=a.get,c=a.set;Object.addProperty(P.prototype,"textColor",Object.ENUMERABLE,b,function(a){c.call(this,a),this._recalculate=!0})}(),Object.addProperty(P.prototype,"text",Object.ENUMERABLE,function(){return this._text},function(a){this._text=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_text",Object.WRITABLE,""),Object.addProperty(P.prototype,"spacing",Object.ENUMERABLE,function(){return this._spacing},function(a){this._spacing=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_spacing",Object.WRITABLE,0),Object.addProperty(P.prototype,"lineHeight",Object.ENUMERABLE,function(){return this._lineHeight},function(a){this._lineHeight=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_lineHeight",Object.WRITABLE,void 0),Object.addProperty(P.prototype,"textAlign",Object.ENUMERABLE,function(){return this._textAlign},function(a){this._textAlign=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_textAlign",Object.WRITABLE,P.LEFT),Object.addProperty(P.prototype,"paddingLeft",Object.ENUMERABLE,function(){return this._paddingLeft},function(a){this._paddingLeft=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingLeft",Object.WRITABLE,0),Object.addProperty(P.prototype,"paddingTop",Object.ENUMERABLE,function(){return this._paddingTop},function(a){this._paddingTop=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingTop",Object.WRITABLE,0),Object.addProperty(P.prototype,"paddingRight",Object.ENUMERABLE,function(){return this._paddingRight},function(a){this._paddingRight=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingRight",Object.WRITABLE,0),Object.addProperty(P.prototype,"paddingBottom",Object.ENUMERABLE,function(){return this._paddingBottom},function(a){this._paddingBottom=a,this._recalculate=!0}),Object.addProperty(P.prototype,"_paddingBottom",Object.WRITABLE,0))}(jb,jb.Renderer),function(a,b){a.rendererType==a.CANVAS_RENDERER&&(E.prototype.load=function(){v.prototype.load.call(this);var a=this;return b.Image.get(this.src,function(){Object.addProperty(a,"_dom",Object.CONFIGURABLE|Object.WRITABLE,this),a.width=this.width,a.height=this.height,a.status=v.READY},function(){Object.addProperty(a,"_dom",Object.CONFIGURABLE|Object.WRITABLE,null),a.width=0,a.height=0,a.status=v.ERROR}),this},E.prototype.unload=function(){return v.prototype.unload.call(this),delete this._dom,delete this.cache[this.src],this.width=0,this.height=0,this},E.prototype.createSubImage=function(b){return a.Image(b)})}(jb,jb.Renderer),function(a,b){if(a.rendererType==a.WEBGL_RENDERER){E.prototype.sourceImage=null,E.prototype.subTextureId=null,E.prototype.subCoordLeft=0,E.prototype.subCoordTop=0,E.prototype.subCoordRight=1,E.prototype.subCoordBottom=1,E.prototype.load=function(){v.prototype.load.call(this);var a=this,c=a.sourceImage;return c?c.status===v.INITIALIZED&&(c.once(v.READY,function(){a.status=v.READY}),c.once(v.ERROR,function(){a.status=v.ERROR}),c.load()):b.Image.get(this.src,function(){Object.addProperty(a,"_dom",Object.CONFIGURABLE|Object.WRITABLE,this),a.width=this.width,a.height=this.height,b.registerTextureImage(b.resourceIdFromPath(this.src),this,a),a.status=v.READY},function(){Object.addProperty(a,"_dom",Object.CONFIGURABLE|Object.WRITABLE,null),a.width=0,a.height=0,a.status=v.ERROR}),this},E.prototype.unload=function(){var a=this.src;return this.status===v.READY&&b.unregisterTextureImage(a),v.prototype.unload.call(this),delete this._dom,delete b.Image.cache[a],this.width=0,this.height=0,this};var c=function(a,b,c,d,e,f){for(var g=b.sourceImage,h=b.width,i=b.height;g;)h=g.width,i=g.height,g=g.sourceImage;0>=h||0>=i||(a.width=e,a.height=f,b.sourceImage?(a.subCoordLeft=b.subCoordLeft+c/h,a.subCoordTop=b.subCoordTop+d/i):(a.subCoordLeft=c/h,a.subCoordTop=d/i),a.subCoordRight=a.subCoordLeft+e/h,a.subCoordBottom=a.subCoordTop+f/i)};E.prototype.createSubImage=function(d,e,f,g,h){for(var i=a.Image(d),j=this.src,k=this.sourceImage;k;)j=k.src,k=k.sourceImage;if(i.sourceImage=this,i.subTextureId=b.resourceIdFromPath(j),this.status===v.READY)c(i,this,e,f,g,h),i.status=v.READY;else{var l=this;l.once(v.READY,function(){c(i,l,e,f,g,h),i.status=v.READY}),l.once(v.ERROR,function(){i.status=v.ERROR})}return i}}}(jb,jb.Renderer),Object.addProperty(F.prototype,"src",function(){return Object.getPrototypeOf(this).src},function(a){Object.addProperty(this,"src",Object.ENUMERABLE,a),this.status=v.LOADING,jb.Renderer.Text.get(a)}),Object.addProperty(G.prototype,"src",function(){return Object.getPrototypeOf(this).src},function(a){Object.addProperty(this,"src",Object.ENUMERABLE,a),this.status=v.LOADING,new q({src:a,type:"json",on:{load:G._onLoad,error:G._onError}})}),G._onLoad=function(a){var b=this.src,c=G(b),d=c.description=a;if(d){var e=d.frames,f=d.meta;if(e&&f){var g=f.image,h=jb.Image(g);h.once(v.READY,function(){var a,d,f,g,i,j;for(d=0,a=e.length;a>d;++d)f=e[d],g=b+ob.META_SEPARATOR+f.filename,i=f.frame,j=h.createSubImage(g,i.x,i.y,i.w,i.h),ob.getById(g)||ob.register(g,j);c.status=v.READY}),h.once(v.ERROR,function(){c.description=null,c.status=v.ERROR}),h.status===v.INITIALIZED&&h.load()}}},G._onError=function(){var a=G(this.src);a.description=null,a.status=v.ERROR},jb.Renderer.start(),function(a,b,c,d,e,f){function g(b){var f=this.self,g=this;if(!f.pending)return!1;if(g instanceof c&&g.readyState!==l)return!1;var h=parseInt(g.status)||200;try{var i=a.parse(f,g)}catch(b){var j=b}switch(!0){case m.test(h):if(j)return f.trigger(a.ERROR,new e(j.message));f.trigger(a.LOAD,i);break;case n.test(h):f.trigger(a.ERROR,new d(h,i))}}function h(b){var c=this.self,d=b?b.position||b.loaded:1,e=b?b.totalSize||b.total:1;c.trigger(a.PROGRESS,d,e)}function i(b){var c=this.self;c.trigger(a.ERROR,b)}function j(){var b=this.self;b.trigger(a.ABORT)}var k=a.XHR="_xhr",l=4,m=/^[23]\d+$/,n=/^[45]\d+$/;a.property(k,null),a.decorate("load",function(){if(!this._super())return!1;var c=this[k]=a.transport(this);c.self=this,c.onload=g,c.onreadystatechange=g,c.onerror=i,c.onprogress=h,c.onabort=j;var d,e=this.method,l=this.src;switch(e){case a.GET:case a.DELETE:var m=l.indexOf("?"),n=l.indexOf("#");m=~m?m+1:l.length,n=~n?n:l.length,d=b.fromQuery(l.slice(m,n)),this.data&&Object.merge(d,this.data),d=b.toQuery(d),"?"!==Array.prototype.last.call(l.slice(0,m))&&(d="?"+d),l=l.slice(0,m)+d+l.slice(n),d=null;break;case a.POST:case a.PUT:if(d=this.data,!d)break;try{d=JSON.stringify(d)}catch(o){return this.trigger(a.ERROR,new f(o.message))}}return c.open(e,l,!0),a.prepare(this,c),c.send(d),!0}),a.decorate("abort",function(){return this._super()?(this[k]&&this[k].abort(),!0):!1})}.call(this,jb.Network.Resource,jb.Network.Url,a.XMLHttpRequest||jb.NOP,jb.Network.Resource.Error.Request,jb.Network.Resource.Error.Parse,jb.Network.Resource.Error.Send),function(a,b,c,d){var e="Internet Explorer"===c.navigator.browser.name,f=parseInt(c.navigator.browser.version),g=b.parse(d);a.transport=function(a){var c=b.parse(a.src);return e&&10>f&&c.host&&c.host!==g.host?new XDomainRequest:new XMLHttpRequest}}(jb.Network.Resource,jb.Network.Url,jb.Device,a.location),function(a,b){var c="application/x-www-form-urlencoded",d="application/json",e={};e[a.TEXT]="text",e[a.JSON]="json",e[a.DATA]="arraybuffer",e[a.AUTO]="",a.prepare=function(f,g){if(g instanceof b){var h=f.headers;if(g.setRequestHeader){if(h)for(var i in h)g.setRequestHeader(i,h[i]);var j=f.method!==a.POST&&f.method!==a.PUT||!f.data||"object"!=typeof f.data?c:d;g.setRequestHeader("Content-Type",j+"; charset=UTF-8")}g.responseType=e[f.type]||e[a.AUTO]}}}(jb.Network.Resource,a.XMLHttpRequest||jb.NOP),function(a,b,c,d){function e(a){return i&&a.response instanceof i?new Uint8Array(a.response):h&&a instanceof XMLHttpRequest?new VBArray(a.responseBody).toArray():a.responseText.toByteArray()}function f(a){var b=a.response||a.responseText;return"object"==typeof b?b:JSON.parse(b)}function g(a){return a.responseText}var h="Internet Explorer"===b.navigator.browser.name,i=c.ArrayBuffer,j="Content-type",k=/text/,l=/json/;a.parse=function(b,c){switch(b.type){case a.DATA:return e(c);case a.JSON:return f(c);case a.TEXT:return g(c);case a.AUTO:var h=String(c instanceof d?c.contentType:c.getResponseHeader(j));return k.test(h)?g(c):l.test(h)?f(c):e(c)}}}(jb.Network.Resource,jb.Device,a,a.XDomainRequest||jb.NOP),function(a){function b(){this._opened=!0,this.trigger(a.OPEN)}function c(b){this.trigger(a.MESSAGE,b.data)}function d(){this._opened&&(this._opened=!1,this.trigger(a.CLOSE),this._sock&&(this._sock.onopen=void 0,this._sock.onmessage=void 0,this._sock.onclose=void 0,this._sock=void 0))}a.property({_sock:null,_opened:!1}),a.decorate({connect:function(a){return this._sock?this:(this._sock=new SockJS(this.src,null,a),this._sock.onopen=b.bind(this),this._sock.onmessage=c.bind(this),this._sock.onclose=d.bind(this),this)},send:function(a){return this._sock&&this._sock.send(a),this},close:function(){return this._sock?(this._sock.close(),this):this}})}(jb.Network.Socket),jb.I18n=function(a,b,c){var d=null,e={},f={tr:function(){var a=d?d.tr:f.Translator.prototype.tr;return a.apply(null,arguments)},changeLang:function(a){var b=null!==a?f.getTranslator(a):null;return f.setDefaultTranslator(b)},setDefaultTranslator:function(b){if(null===b)return d=null;if(!(b instanceof f.Translator))throw new a.Type;if(!f.getTranslator(b.code))throw new a.Reference("Engine.I18n.setDefaultTranslator: specified "+b.code+" language translator doesn't exist; Create it using `Engine.I18n.translatorFactory()` method.");d=b},translatorFactory:function(){c.call(arguments,null);var a=new(b.apply(f.Translator,arguments)),d=f.getTranslator(a.code);return d?(Object.merge(d,a),d):(f.registerTranslator(a),a)},getTranslator:function(a){return a+="",e[a]},getDefaultTranslator:function(){return d},registerTranslator:function(b){if(!(b instanceof f.Translator))throw new a.Type;if(f.getTranslator(b.code))throw new a.Reference;e[b.code]=b,d||f.setDefaultTranslator(b)},unregisterTranslator:function(b){if(!(b instanceof f.Translator))throw new a.Type;if(!f.getTranslator(b.code))throw new a.Reference;e[b.code]=null,d===b&&f.setDefaultTranslator(null)}};return f}(jb.Error,Function.prototype.bind,Array.prototype.unshift),jb.I18n.Translator=function(a,b,c,d,e){function g(a,c,d){var e;if(Object.isObject(a)&&(e=a,a=e.code,c=e.rules,d=e.strings),f.call(this,e),this.code=a?a:this.code,this.rules=c||this.rules,this.strings=d||this.strings,this.defaultContext=e&&"defaultContext"in e?e.defaultContext:this.defaultContext,!i(this.code))throw new b.Type("Engine.I18n.Translator: language code is invalid");if(c=this.rules,this.rules=null,!this.setRules(c))throw new b.Type("Engine.I18n.Translator: specified `rules` has to be an array of functions");if(d=this.strings,this.strings=null,!this.setStrings(d))throw new b.Type("Engine.I18n.Translator: `strings` has to be an object");
this.tr=this.tr.bind(this)}function h(a){return"function"==typeof a&&"boolean"==typeof a(0)}function i(a){return j.test(a+"")}gb.extend(g,f),g.DEFAULT_CONTEXT="";var j=/^[a-z]{2}-[A-Z]{2}$/;return g.property({code:"",rules:null,strings:null,defaultContext:g.DEFAULT_CONTEXT}),g.parseRulesFromJSON=function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(d){throw new b.Type("Engine.I18n.Translator.parseRulesFromJSON: specified `rules` can't be parsed from JSON")}if(!c(a)||!a.every(e))throw new b.Type("Engine.I18n.Translator.parseRulesFromJSON: array of strings expected");for(var f=0,g=a.length;g>f;f++){var h=a[f],i=new Function("n","return "+h+";");try{i(0)}catch(d){throw new b.Type("Engine.I18n.Translator.parseRulesFromJSON: "+f+" element of `rules` ("+h+") can't be parsed into function")}if("boolean"!=typeof i(0))throw new b.Type("Engine.I18n.Translator.parseRulesFromJSON: element index "+f+" of `rules` ("+h+") doesn't return boolean value");a[f]=i}return a},g.method({setRules:function(a){return this.rules!==a&&c(a)&&a.every(d)&&a.every(h)?(this.rules=a,!0):!1},setStrings:function(a){return this.strings===a||"object"!=typeof a||c(a)?!1:(this.strings=a,!0)},tr:function(){function a(a,b){if(a.length)for(var c=0,d=a.length;d>c;c++)if(a[c](b))return c}return function(d,e,f,h){var i=Object(this);if("undefined"==typeof d)throw new b.Type("Engine.I18n.Translator::tr: Nothing to translate");if(null!=e&&"string"!=typeof e)throw new b.Type("Engine.I18n.Translator::tr: disambiguation is not a string");if(null!=f&&("number"!=typeof f||!isFinite(f)))throw new b.Type("Engine.I18n.Translator::tr: count is not a proper number");if(null!=h&&"object"!=typeof h)throw new b.Type("Engine.I18n.Translator::tr: format is not an object");d+="",e=e||i.defaultContext||g.DEFAULT_CONTEXT,f=f||0,h=h||null;var j=i.strings&&i.strings[d];return j&&("object"!=typeof j||c(j)||(j=j[e]),d="string"==typeof j?j:c(j)&&i.rules&&j[a(i.rules,f)]||d),d=d.replace("{n}",f),h?d.format(h):d}}()}),g}(jb.I18n,jb.Error,Array.isArray,Function.isFunction,String.isString);var tb=jb.Input=new f;tb.KEY_DOWN="keydown",tb.KEY_UP="keyup",tb.Keyboard=Object.merge(Object.create({CTRL_MODIFIER:1,ALT_MODIFIER:2,SHIFT_MODIFIER:4}),{key:"",text:"",modifiers:0}),Object.seal(tb.Keyboard),tb.MOUSE_DOWN="mousedown",tb.MOUSE_MOVE="mousemove",tb.MOUSE_UP="mouseup",tb.Mouse=Object.merge(Object.create({LEFT_BUTTON:0,MIDDLE_BUTTON:1,RIGHT_BUTTON:2,getPosition:function(a){return void 0===a&&(a=Math.Vector2d()),a[0]=this.x,a[1]=this.y,a}}),{viewport:null,x:0,y:0,dx:0,dy:0,button:0}),Object.seal(tb.Mouse),I.MOUSE_DOWN="mousedown",I.MOUSE_MOVE="mousemove",I.MOUSE_UP="mouseup",function(){function a(a){return function(c){var d=c.viewport.getCameraByPixel(c.x,c.y);if(d){var e=d.lookingAt;if(e){var f=d.toSceneX(c.x-d.left),g=d.toSceneY(c.y-d.top);b.x=f,b.y=g,e.trigger(a,b)}}}}var b=Object.create(tb.Mouse);b.x=b.y=0,Object.seal(b),tb.on(tb.MOUSE_DOWN,a(I.MOUSE_DOWN)).on(tb.MOUSE_MOVE,a(I.MOUSE_MOVE)).on(tb.MOUSE_UP,a(I.MOUSE_UP))}(),tb.WHEEL="wheel",tb.Wheel={deltaX:0,deltaY:0},Object.seal(tb.Wheel);var ub,vb=tb.Pointer=new f;vb.viewport=null,vb.LOCK="lock",vb.UNLOCK="unlock",Object.addProperty(vb,"isLocked",Object.ENUMERABLE,function(){return!!vb.viewport},null),vb.lock=function(a,b,c){return vb.viewport===a?b&&b():ub?ub.lock(a,function(){vb.viewport=a,b&&b()},c):c&&c(new Error.NotImplemented),vb},vb.unlock=function(a,b){return vb.isLocked?(ub?ub.unlock(a,b):b&&b(new Error.NotImplemented),vb):(a&&a(),tb.Pointer)},vb.toggle=function(a,b,c){return vb.viewport?vb.unlock(b,c):vb.lock(a,b,c)},jb.ready(function(){ub&&(ub.onLock=vb.trigger.bind(vb,vb.LOCK),ub.onUnlock=function(){vb.viewport=null,vb.trigger(vb.UNLOCK)})}),function(a,b,c){function d(a){return 0|(a.keyCode||a.which||a.key&&a.key.toUpperCase().charCodeAt()||0)}function e(a){return a&&(a["char"]||c(a.charCode))}function f(f,h,j){var k=d(h);if(k)return b.key=g[k]||c(k),b.text=f===a.KEY_DOWN&&e(j)||"",b.modifiers=0|(h.ctrlKey&&b.CTRL_MODIFIER)|((h.altKey||h.altGraphKey)&&b.ALT_MODIFIER)|(h.shiftKey&&b.SHIFT_MODIFIER),a.trigger(f,b),i}var g={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS_LOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"ARROW_LEFT",38:"ARROW_UP",39:"ARROW_RIGHT",40:"ARROW_DOWN",45:"INSERT",46:"DELETE",91:"SUPER_LEFT",92:"SUPER_RIGHT",93:"SELECT",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUM_LOCK",145:"SCROLL_LOCK"},h=document.documentElement,i=null,j=null,k={},l=[8,9];h.addEventListener("keydown",function(b){var c=d(b);l.has(c)&&b.target===document.body&&b.preventDefault(),j=null,!k[c]&&setTimeout(function(){k[c]=f(a.KEY_DOWN,b,j)},0),i=b}),h.addEventListener("keyup",function(b){f(a.KEY_UP,b,j),i=0,j=null,k[d(b)]=null}),h.addEventListener("keypress",function(a){j=a})}(jb.Input,jb.Input.Keyboard,String.fromCharCode),function(a,b,c,d){function e(b,d,e){if(s.hasOwnProperty(d)){var f=jb.now();if(f-s[d]<r)return;s[d]=f}var g=c.x,h=c.y;c.viewport=b,c.x=e[p]-b._dom.offsetLeft,c.y=e[q]-b._dom.offsetTop,c.dx=c.x-g,c.dy=c.y-h,c.button=e.button,a.trigger(d,c)}function f(a,c,d){if(u!==d){var a=a instanceof b?a:null;e(a,c,d),u=d}}function g(a,b,c){v.x=c[p],v.y=c[q],w.x=a._dom.offsetLeft,w.y=a._dom.offsetTop,w.w=a._dom.offsetWidth,w.h=a._dom.offsetHeight,v.overlap(w)&&e(a,b,c)}function h(a,c,d){if(a instanceof b){document.activeElement.blur();var e=d.touches.item(0)||d.changedTouches.item(0);g(a,c,e)}}function i(a,b,c){var d="touch"===b,e=d?h:f,g=(d?"touchEventHandler":"mouseEventHandler")+c;return z[g]||(z[g]=e.bind(null,a,c)),z[g]}function j(b,c,d,e){var f="touch"===d;e+="EventListener",c[e](f?"touchstart":"mousedown",i(b,d,a.MOUSE_DOWN)),c[e](f?"touchend":"mouseup",i(b,d,a.MOUSE_UP)),c[e](f?"touchmove":"mousemove",i(b,d,a.MOUSE_MOVE))}function k(a){j(a,a._dom,"mouse","add")}function l(a){j(a,a._dom,"mouse","remove")}function m(a){if(!o)throw"Touch events are not supported";j(a,a._dom,"touch","add"),a._dom.addEventListener("touchmove",function(a){a.preventDefault()})}function n(){y.forEach(x?l:k),x=!x}var o="undefined"!=typeof window.ontouchstart,p="pageX",q="pageY",r=50,s={};s[a.MOUSE_DOWN]=0,s[a.MOUSE_UP]=0;var t=document.documentElement,u=null,v=d(0,0,1,1),w=d(0,0,0,0),x=!o,y=[],z={};if(b.decorate("initialize",function(a){this._super(a),y.push(this),o&&m(this),x&&k(this)}),o){var A=0,B=1e3;t.addEventListener("touchstart",function(){x&&n()}),t.addEventListener("touchend",function(a){A=a.timeStamp}),t.addEventListener("mousemove",function(a){!x&&a.timeStamp-A>B&&n()})}}(jb.Input,jb.Viewport,jb.Input.Mouse,jb.Box),function(a){function b(b){var c=void 0!==b.wheelDeltaX?b.wheelDeltaX:0,d=void 0!==b.wheelDeltaY?b.wheelDeltaY:b.wheelDelta||-b.detail;a.deltaX=Math.max(-1,Math.min(1,c)),a.deltaY=Math.max(-1,Math.min(1,d)),tb.trigger(tb.WHEEL,a),b.preventDefault()}document.addEventListener("mousewheel",b,!1),window.addEventListener("DOMMouseScroll",b,!1)}(tb.Wheel),ub=function(){function a(a){for(var c=b[d];j.length;){var e=j.shift(),f=j.shift(),g=j.shift();!e&&!c||e&&c===e._dom?f&&f():g&&g(new jb.Error(i))}"change"===a&&(c?ub.onLock():ub.onUnlock())}var b=window.document,c=b.documentElement,d="pointerLockElement"in b&&"pointerLockElement"||"webkitPointerLockElement"in b&&"webkitPointerLockElement"||"mozPointerLockElement"in b&&"mozPointerLockElement",e="onpointerlockchange"in b&&"pointerlockchange"||"onwebkitpointerlockchange"in b&&"webkitpointerlockchange"||"onmozpointerlockchange"in b&&"mozpointerlockchange",f="onpointerlockerror"in b&&"pointerlockerror"||"onwebkitpointerlockerror"in b&&"webkitpointerlockerror"||"onmozpointerlockerror"in b&&"mozpointerlockerror",g=c.requestPointerLock||c.webkitRequestPointerLock||c.mozRequestPointerLock,h=b.exitPointerLock||b.webkitExitPointerLock||b.mozExitPointerLock;if(d&&e&&f&&g&&h){var i="Pointer can't be locked due to client restrictions; Remember to lock pointer in `mousedown` or `keydown` events",j=[];return b.addEventListener(e,a.bind(null,"change")),b.addEventListener(f,a.bind(null,"error")),jb.ready(function(){b[d]&&ub.unlock()}),{onLock:jb.NOP,onUnlock:jb.NOP,lock:function(a,b,c){return j.push(a,b,c),g.call(a._dom),this},unlock:function(a,c){return j.push(null,a,c),h.call(b),this}}}}();var wb;jb.Sound=W,W.cache={},W.initSubsystem=function(){wb&&wb.unlock&&wb.unlock()},W.prototype=Object.create(v.prototype),Object.addProperty(W.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,W),W.prototype.src="",Object.addProperty(W.prototype,"duration",Object.ENUMERABLE,0),W.prototype.load=function(){var a=v.prototype.load.call(this);if(wb){var b=this;wb.load(this.src,function(a){Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,a),b.status=v.READY},function(){b.hasOwnProperty("status")||(b.status=v.ERROR)})}return a},W.prototype.unload=function(){var a=v.prototype.unload.call(this);return wb&&(wb.unload(this.src),Object.addProperty(this,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,0)),a},W.prototype.toString=function(){return this.src},Object.freeze(W.prototype),jb.ready(function(){});var xb=!wb&&function(){function a(){for(var a=new window.Audio,b=["probably","maybe"],c={mp3:"audio/mpeg",ogg:'audio/ogg; codecs="vorbis"'},d=0,e=b.length;e>d;d++){var f;for(f in c)if(c.hasOwnProperty(f)){var g=c[f],h=a.canPlayType(g);if(h===b[d])return{ext:f,mime:g}}}return null}function b(a){return/\/?\.(\w+)$/.test(a)?a:"{}.{}".format(a,c.ext)}if("undefined"!=typeof window.Audio){var c=a();if(c)return{format:c,normalizeSrc:b}}}();xb&&!wb&&function(){function a(){var b=a.create();return b._source=null,b._gain=null,b._src="",b._loop=!1,b._volume=1,b._startTime=0,b._offset=0,b.onEnd=null,b.hasOwnProperty("_onSourceEnd")||(b._onSourceEnd=b._onSourceEnd.bind(b)),b}var b=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(b){var c={},d=new b,e="iOS"===jb.Device.platform.name,f=!e;wb={load:function(a,b,e){var f=xb.normalizeSrc(a);new jb.Network.Resource({src:f,type:"data",on:{load:function(g){d.decodeAudioData(g.buffer,function(d){c[a]=d,b(Math.ceil(1e3*d.duration))},function(){e(new jb.Error("Sound file {} can't be decoded".format(f)))})},error:e}})},unload:function(a){c[a]=null},createAmbientSound:function(){return a()},unlock:function(){f||(f=!0,d.createBufferSource())}},a.prototype={constructor:a,_source:null,_gain:null,_src:"",_loop:!1,_volume:1,_startTime:0,_offset:0,_endTimer:null,onEnd:null,_onSourceEnd:function(){!this._loop&&this._source&&this.onEnd&&(this._endTimer&&this._endTimer.stop(),this.onEnd())},setSound:function(a){this._src=a},play:function(){var a=this._source=d.createBufferSource(),b=d.destination,e=this._gain=a.gain;if(!e){var f=d[d.createGain?"createGain":"createGainNode"]();f.connect(d.destination),b=f,this._gain=e=f.gain}a.buffer=c[this._src],a.connect(b),a.loop=this._loop,e.setValueAtTime(this._volume,0),a[a.start?"start":"noteOn"](0,this._offset),this._startTime=d.currentTime,a.hasOwnProperty("onended")?a.onended=this._onSourceEnd:(this._endTimer||(this._endTimer=new jb.Timer({type:jb.Timer.VSYNC,duration:1/0,on:{step:this._onSourceEnd}})),this._endTimer.stop(),this._endTimer.delay=1e3*(a.buffer.duration-this._offset),this._endTimer.play())},pause:function(){this.stop(),this._offset=d.currentTime-this._startTime},stop:function(){var a=this._source;this._source=null,this._endTimer&&this._endTimer.stop(),this._offset=0,a[a.stop?"stop":"noteOff"](0)},seek:function(a){var b=this._onEnd;this._onEnd=null,this.stop(),this._offset=a/1e3,this.play(),this._onEnd=b},fadeTo:function(a,b,c){!this.fadeTimer&&c&&(this.fadeTimer=new jb.Timer({type:jb.Timer.VSYNC})),this.fadeTimer&&this.fadeTimer.playing&&this.fadeTimer.stop(),c&&(this.fadeTimer.delay=this.fadeTimer.duration=b,this.fadeTimer.once(jb.Timer.STOP,c),this.fadeTimer.play());var e=d.currentTime+b/1e3;this._gain.cancelScheduledValues(0),this._gain.setValueAtTime(this._volume,d.currentTime+.1),this._gain.linearRampToValueAtTime(a,e),this._volume=a},setLoop:function(a){this._loop=a,this._source&&(this._source.loop=a)},setVolume:function(a){this._volume=a,this._gain&&this._gain.setValueAtTime(a,0)},destroy:function(){a.free(this)}}}}(),xb&&!wb&&function(){function a(){var b=a.create();return b.src="",b._audio=null,b.onEnd=null,b._fadeValueFrom=b._fadeValueTo=0,b._fadeTimer=null,b.hasOwnProperty("_onAudioEnd")||(b._onAudioEnd=b._onAudioEnd.bind(b)),b.hasOwnProperty("_onFadeTimerStep")||(b._onFadeTimerStep=b._onFadeTimerStep.bind(b)),b}if(window.HTMLAudioElement){var b={};wb={load:function(a,c,d){function e(){g||(g=!0,c(isFinite(f.duration)?Math.ceil(1e3*f.duration):0))}var f=b[a]=new Audio;f.src=xb.normalizeSrc(a);var g=!1;f.readyState===f.HAVE_ENOUGH_DATA?e():(f.addEventListener("canplaythrough",e),f.addEventListener("loaded",e),f.addEventListener("suspend",e)),f.addEventListener("error",function(){d(new jb.Error("Sound file {} can't be loaded".format(f.src)))})},unload:function(a){b[a]=null},createAmbientSound:function(){return a()}};var c=[];a.prototype={constructor:a,_audio:null,onEnd:null,_fadeValueFrom:0,_fadeValueTo:0,_fadeTimer:null,_onAudioEnd:function(){this.onEnd&&this.onEnd()},_onFadeTimerStep:function(){this.setVolume(this._fadeTimer.progress/this._fadeTimer.duration*(this._fadeValueTo-this._fadeValueFrom)+this._fadeValueFrom)},setSound:function(a){this.src=a,b[a]||wb.load(a,jb.NOP,jb.NOP),c[a]||(c[a]=[]),this._audio=c[a].pop()||b[a].cloneNode(),this._audio.addEventListener("ended",this._onAudioEnd)},play:function(){this._audio&&this._audio.play()},pause:function(){this._audio&&this._audio.pause()},stop:function(){if(this._audio){this._audio.pause();try{this._audio.currentTime=0}catch(a){}}},seek:function(a){this._audio&&(this._audio.currentTime=a/1e3)},fadeTo:function(a,b,c){if(this._audio){this._fadeTimer||(this._fadeTimer=new jb.Timer({type:jb.Timer.VSYNC,on:{step:this._onFadeTimerStep}})),this._fadeTimer.playing&&this._fadeTimer.stop(),this._fadeValueFrom=this._audio.volume,this._fadeValueTo=a,this._fadeTimer.duration=b,c&&this._fadeTimer.once(jb.Timer.STOP,c),this._fadeTimer.play()}},setLoop:function(a){this._audio&&(this._audio.loop=a)},setVolume:function(a){this._audio&&(this._audio.volume=a)},destroy:function(){this._audio&&(this._audio.removeEventListener("ended",this._onAudioEnd),c[this.src].push(this._audio),this._audio=null,this.onEnd=null,this._fadeTimer&&this._fadeTimer.playing&&this._fadeTimer.stop(),a.free(this))}}}}(),Object.addProperty(jb,"_SoundNode",Object.CONFIGURABLE|Object.WRITABLE,X),X.prototype=Object.create(H.prototype),Object.addProperty(X.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,X),Object.addProperty(X.prototype,"sound",Object.ENUMERABLE,null),X.prototype.autoplay=!1,X.prototype.autodestroy=!1,Object.addProperty(X.prototype,"_playing",Object.WRITABLE,!1),Object.addProperty(X.prototype,"playing",Object.ENUMERABLE,function(){return this._playing},null),Object.addProperty(X.prototype,"_loop",Object.WRITABLE,!1),Object.addProperty(X.prototype,"loop",Object.ENUMERABLE,function(){return this._loop},function(a){this._loop!==a&&(this._impl&&this._impl.setLoop(a),this._loop=a)}),Object.addProperty(X.prototype,"_volume",Object.WRITABLE,1),Object.addProperty(X.prototype,"volume",Object.ENUMERABLE,function(){return this._volume},function(a){this._impl&&this._impl.setVolume(a),this._volume=a}),X.prototype.onSoundReady=function(){this.autoplay&&this.play(),Object.addProperty(this,"autoplay",Object.CONFIGURABLE|Object.ENUMERABLE,this.autoplay)},X.prototype.onEnd=function(){this.stop()},X.prototype.play=function(){return this._impl&&(this._impl.play(this),this._playing=!0),this},X.prototype.pause=function(){return this._impl&&this._impl.pause(this),this._playing=!1,this},X.prototype.stop=function(){return this._impl&&this._impl.stop(this),this._playing=!1,this.autodestroy&&this.destroy(),this},X.prototype.seek=function(a){return this._impl&&this._impl.seek(a),this},X.prototype.fadeTo=function(a,b,c){return this._impl&&this._impl.fadeTo(a,b,c),this},X.prototype.destroy=function(){return this.playing&&this.stop(),this.sound.status!==v.READY&&this.sound.off(v.READY,this.onSoundReady),this._impl&&this._impl.destroy(),H.prototype.destroy.call(this)},Object.seal(X.prototype),jb.AmbientSound=Y,Y.prototype=Object.create(X.prototype),Object.addProperty(Y.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,Y),jb.Particles=function(){function a(a){f.call(this,a)}return gb.extend(a,f),a}(),jb.Particles=function(a){function b(b){a.call(this,b),this.timer.duration=this.emitDelay}function c(a){for(var b=0,c=e.length;c>b;b++){var d=e[b];if(d.amount===a)return b===e.length-1?e.pop():e[b]=e.pop(),d}}gb.extend(b,a),b.BEFORE_EMIT="beforeemit",b.EMIT="emit",b.BEFORE_CREATE_PARTICLE="beforecreateparticle",b.CREATE_PARTICLE="createparticle";var d={emitter:null,i:0};b.property({amount:10,iterations:1/0,emitDelay:1e3,emitters:null});var e=[],f=5;return b.method({onstep:function(){this._super(),!this.emitters.length&&this.timer.count>=this.iterations&&this.stop()},onplay:function(){this._super(),this.emitters=[],this.emit()},onstop:function(){this._super(),this.emitters=b.prototype.emitters},onloop:function(){this._super(),this.timer.count<this.iterations&&this.emit()},onemitterdestroyed:function(a){e.push(a),e.length>f&&e.shift()},emit:function(){if(this.timer.playing){this.trigger(b.BEFORE_EMIT);var a=this.amount,e=c(a)||{amount:a};this.emitters.push(e),this.trigger(b.EMIT,e);for(var f=0,g=a;g>f;f++)this.trigger(b.BEFORE_CREATE_PARTICLE,f),d.emitter=e,d.i=f,this.trigger(b.CREATE_PARTICLE,d)}}}),b}(jb.Particles,jb.now),jb.Particles=function(a,b){function c(b){var c=function(a,b,c,d){var e=d[c]-b;d[c]=0>e?0:e};c.shortcutArguments=["timeleft"],this.funcs.push(c),a.call(this,b)}return gb.extend(c,a),c.EMITTER_DESTROYED="emitterdestroyed",c.property({lifetime:5e3}),c.method({onemit:function(a){this._super(a),a.lifetime=a.lifetime||new hb("uint",this.lifetime,this.amount),a.timeleft=a.timeleft||new hb("uint",this.lifetime,this.amount)},oncreateparticle:function(a){this._super(a),a.emitter.lifetime[a.i]=a.emitter.timeleft[a.i]=b(0,this.lifetime)},onstep:function(){if(this._super(),this.timer.playing)a:for(var a=0,b=this.emitters,d=b.length;d>a;a++){for(var e=0,f=b[a].timeleft,g=f.length;g>e;e++)if(f[e])continue a;var h=b[a];a===b.length-1?b.pop():b[a]=b.pop(),this.trigger(c.EMITTER_DESTROYED,h),a--,d--}}}),c}(jb.Particles,Math.max),jb.Particles=function(a){function b(b){a.call(this,b),this.timer.delay=this.redrawDelay}return gb.extend(b,a),b.property({geometry:null,redrawDelay:1,parent:null,x:0,y:0,width:1,height:1}),b.method({onplay:function(){this._super(),this.geometry=new jb.Particles.Geometry({emitters:this.emitters,parent:this.parent,x:this.x,y:this.y,width:this.width,height:this.height})},onstop:function(){this._super(),this.geometry.destroy()}}),b}(jb.Particles),jb.Particles=function(a){function b(b){a.call(this,b);var c=b&&"color"in b?b.color:this.color,d=b&&"image"in b?b.image:this.image,e=b&&"gradient"in b?b.gradient:this.gradient;this.color=c?c instanceof C?c:C(c):null,this.image=d?d instanceof E?d:E(d):null,this.gradient=e instanceof D?e:null,this.image&&this.image.status===v.INITIALIZED&&this.image.load()}gb.extend(b,a),b.property({image:null,gradient:null,color:null,particleWidth:10,particleHeight:10});return b.method({onemit:function(a){this._super(a);var b=this.amount;a.shape=a.shape||{image:new Array(b),color:new Array(b),gradient:new Array(b),width:new hb("int",255,b),height:new hb("int",255,b)}},oncreateparticle:function(a){this._super(a),this.color&&(this.color=this.color instanceof C?this.color:C(this.color)),this.image&&(this.image=this.image instanceof E?this.image:E(this.image)),this.gradient=this.gradient instanceof D?this.gradient:null;var b=a.emitter.shape,c=a.i;b.color[c]=this.color,b.image[c]=this.image,b.gradient[c]=this.gradient,b.width[c]=this.particleWidth,b.height[c]=this.particleHeight}}),b}(jb.Particles),jb.Particles=function(a,b,c){function d(b){var c=b&&"dx"in b?b.dx:this.dx,d=b&&"dy"in b?b.dy:this.dy;if(c!==!1&&d!==!1){var e=function(a,b,c,d,e){d&&e&&(c*=2,d[c]+=e[c]*b/1e3,d[c+1]+=e[c+1]*b/1e3)};e.shortcutArguments=["position","move"],this.funcs.push(e)}a.call(this,b),this.dx=b&&"undefined"!=typeof b.dx?b.dx:this.dx,this.dy=b&&"undefined"!=typeof b.dy?b.dy:this.dy,this.originX=b&&"number"==typeof b.originX?b.originX:this.width/2,this.originY=b&&"number"==typeof b.originY?b.originY:this.height/2}return gb.extend(d,a),d.property({originX:null,originY:null,dx:100,dy:100}),d.method({onemit:function(a){this._super(a);var c=b(this.width,this.height);a.position=a.position||new hb("float",c,2*this.amount),a.move=a.move||new hb("int",c,2*this.amount)},oncreateparticle:function(a){this._super(a);var b=a.emitter,c=a.i;c*=2,b.position[c]=this.originX,b.move[c]=this.dx,c++,b.position[c]=this.originY,b.move[c]=this.dy},verifyPosition:function(a,b,d,e){return"undefined"==typeof d&&(d=this.dx),"undefined"==typeof e&&(e=this.dy),c(d)+(a+1)/2>this.width/2?!1:c(e)+(b+1)/2>this.height/2?!1:!0}}),d}(jb.Particles,Math.max,Math.abs),jb.Particles=function(a){function b(b){var c=b&&"opacity"in b?b.opacity:this.opacity;if(c!==!1){var d=function(a,b,c,d,e){d&&(d[c]*=1-b/e[c])};d.shortcutArguments=["opacity","timeleft"],this.funcs.push(d)}a.call(this,b),this.opacity=b&&"undefined"!=typeof b.opacity?b.opacity:this.opacity}return gb.extend(b,a),b.property({opacity:1}),b.method({onemit:function(a){return this._super(a),this.opacity===!1?void(a.opacity&&(a.opacity=null)):void(a.opacity=a.opacity||new hb("float",1,this.amount))},oncreateparticle:function(a){this._super(a),this.opacity!==!1&&(a.emitter.opacity[a.i]="number"==typeof this.opacity?this.opacity:b.prototype.opacity)}}),b}(jb.Particles),jb.Particles=function(a,b){function c(b){var c=Math.PI,d=b&&"rotate"in b?b.rotate:this.rotate;if(d!==!1){var e=function(a,b,d,e,f){e&&(e[d]+=f[d]*b/1e3,e[d]%=2*c)};e.shortcutArguments=["rotation","rotate"],this.funcs.push(e)}a.call(this,b),this.rotate=b&&"undefined"!=typeof b.rotate?b.rotate:this.rotate}return gb.extend(c,a),c.property({rotate:0}),c.method({onemit:function(a){return this._super(a),this.rotate===!1?(a.rotate&&(a.rotate=null),void(a.rotation&&(a.rotation=null))):(a.rotate=a.rotate||new hb("float",2*b,this.amount),void(a.rotation=a.rotation||new hb("float",2*b,this.amount)))},oncreateparticle:function(a){this._super(a),a.emitter.rotate&&(a.emitter.rotate[a.i]=this.rotate,a.emitter.rotation[a.i]=0)}}),c}(jb.Particles,Math.PI),jb.Particles=function(a,b){function c(c){function d(a,b,c){b.on(c,function(b){a.trigger(c,b)})}var e=this.timer=new b({type:b.VSYNC,loop:!0});d(this,e,b.PLAY),d(this,e,b.PAUSE),d(this,e,b.STOP),d(this,e,b.STEP),d(this,e,b.LOOP),this.reset=e.reset.bind(e),this.play=e.play.bind(e),this.pause=e.pause.bind(e),this.stop=e.stop.bind(e),a.call(this,c)}return gb.extend(c,a),c.STEP="step",c.LOOP="loop",c.PLAY="play",c.STOP="stop",c.property({timer:null,autoplay:!0,oninitialize:function(){this.autoplay&&setTimeout(this.timer.play.bind(this.timer),0)},reset:null,play:null,pause:null,stop:null}),c}(jb.Particles,jb.Timer),jb.Particles=function(a,b,c){function d(d){this.funcs=[],a.call(this,d),d&&c(d.funcs)&&b.apply(this.funcs,d.funcs)}return gb.extend(d,a),d.property({funcs:null}),d.method({onstep:function(){var a=arguments,b=this.funcs,c=b.length;if(this._super(),this.timer.playing){a[1]=this.timer.stepprogress;for(var d=0,e=this.emitters,f=e.length;f>d;d++)for(var g=a[0]=e[d],h=0;c>h;h++){var i=b[h],j=i.shortcutArguments;if(a.length=3,j){a.length=j.length+3;for(var k=0,l=j.length;l>k;k++)a[k+3]=g[j[k]]}for(var m=g.timeleft,n=0,o=m.length;o>n;n++)m[n]&&(a[2]=n,i.apply(null,a))}}}}),d}(jb.Particles,Array.prototype.push,Array.isArray),jb.Particles.Geometry=function(a){function b(b){a.call(this,b)}return gb.extend(b,a),b.property({emitters:null}),b}(jb.Geometry),jb.Particles.Geometry.prototype.render=function(a){var b=this.emitters;if(b&&b.length){H.prototype.render.call(this,a);for(var c=0,d=b.length;d>c;c++){var e=b[c],f=e.shape,g=f.color,h=f.gradient,i=f.image,j=f.width,k=f.height,l=e.opacity,m=e.rotation,n=e.position,o=e.timeleft;a.globalAlpha=1;for(var p=0,q=o.length,r=0;q>p;r=2*++p)if(o[p]){var s=j[p],t=k[p];if(s&&t){l&&(a.globalAlpha=l[p]);var u=0|n[r],v=0|n[r+1],w=m[p];a.save(),a.translate(u,v),w&&a.rotate(w),jb.Renderer.fillRect(a,-s/2,-t/2,s,t,g[p],h[p],i[p]),a.restore()}}}}},jb.Path=function(){var a=new f;return a.Metric={},a.METRIC="euclidean",a.distance=function(b,c,d,e,f){var g=a.Metric[f]||a.Metric[a.METRIC]||null;return g?g.distance(b,c,d,e):0},a}(),function(a){var b=Math.sqrt,c=Math.pow,d=Math.abs;a.Metric.euclidean={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1],[1,1,Math.SQRT2],[-1,-1,Math.SQRT2],[-1,1,Math.SQRT2],[1,-1,Math.SQRT2]],distance:function(a,d,e,f){return b(c(a-e,2)+c(d-f,2))}},a.Metric.manhattan={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1]],distance:function(a,b,c,e){return d(a-c)+d(b-e)}}}(jb.Path),function(a){function b(a,b){return b.g+b.h-a.g-a.h||b.h-a.h}function c(a,b){b="function"==typeof b?b:f;for(var c=[];a;)c.unshift(b(a)),a=a.parent;return c}function d(a,b,c,d,e,f){this.x=a,this.y=b,this.g=c,this.h=d,this.parent=e,this.cost=f}function e(a,b){return a+","+b}function f(a){return[a.x,a.y]}a.MAX=500,a.INVALID=-1,a.search=function(f,g,h,i,j,k,l){if(f===h&&g===i)return[];var m=a.Metric[a.METRIC]||null;if(!m)throw new jb.Error.Type('Engine.Path.search: no "'+a.METRIC+'" metric found');if("function"!=typeof j)throw new jb.Error.Type('Engine.Path.search: validation method is not a function. "'+typeof j+'" passed instead.');l=arguments.length<7?this:l;for(var n=m.directions,o=n.length,p=m.distance,q=Math.max(0,parseFloat(a.MAX)||0),r=a.INVALID,s=0,t=p.call(null,f,g,h,i),u=[new d(f,g,s,t,null,0)],v={},w={},x=u.last();u.length&&q-->0;){var y=u.pop(),z=y.x,A=y.y;if(x.h>y.h&&(x=y),z===h&&A===i)return c(y,k);v[y]=y;for(var B=0;o>B;B++){var C=n[B],D=C[0],E=C[1],F=C[2],G=z+D,H=A+E;if(!v[e(G,H)]&&!w[e(G,H)]){var I=j.call(l,G,H,D,E);if(w[e(G,H)]=!0,Number(I)!==r){var s=y.g+I*F,t=p.call(null,G,H,h,i);u.push(new d(G,H,s,t,y,I))}}}u.sort(b)}return c(x,k)},d.prototype.toString=function(){return e(this.x,this.y)}}(jb.Path);var yb=64,zb=40,Ab=Math.Matrix33(1,0,0,0,1,0,0,0,1).rotate(Math.deg2rad(-45)).scale(1,zb/yb),Bb=jb.Isometry={project:function(a,b,c,d){var e=yb*(a-b)/2,f=zb*(a/2+b/2-c);return d?(d.x=e,d.y=f):(d=Math.Vector2d.create(),Math.Vector2d.call(d,e,f)),d},coords:function(a,b,c){var d=a/yb+b/zb,e=a/-yb+b/zb;return c?(c.x=d,c.y=e):(c=Math.Vector2d.create(),Math.Vector2d.call(c,d,e)),c},getVisibleArea:function(a,b){b=b||jb.Box.create();var c=Math.Vector2d(0,0);Bb.coords(a.x,a.y,c);var d=c.x,e=d,f=c.y,g=f;return Bb.coords(a.x,a.y+a.h,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Bb.coords(a.x+a.w,a.y,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Bb.coords(a.x+a.w,a.y+a.h,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Math.Vector2d.free(c),p.call(b,d,f,e-d,g-f)},isAreaVisible:function(a,b){var c=Math.Vector2d(0,0);Bb.project(x,y,0,c);var d=c.x,e=d,f=c.y,g=f;return Bb.project(x,y+h,0,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Bb.project(x+w,y,0,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Bb.project(x+w,y+h,0,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Math.Vector2d.free(c),p.overlap(d,f,e-d,g-f,b.x,b.y,b.w,b.h)}};Object.addProperty(Bb,"UNIT",function(){return yb/Math.SQRT2},null),Object.addProperty(Bb,"TILE_WIDTH",function(){return yb},function(a){yb=a,Ab.set(1,0,0,0,1,0,0,0,1).rotate(Math.deg2rad(-45)).scale(1,zb/yb)}),Object.addProperty(Bb,"TILE_HEIGHT",function(){return zb},function(a){zb=a,Ab.set(1,0,0,0,1,0,0,0,1).rotate(Math.deg2rad(-45)).scale(1,zb/yb)}),Object.addProperty(Bb,"TRANSFORM",function(){return Ab},null),jb.Isometry.Node=Z,Z.prototype=Object.create(H.prototype),Z.prototype.constructor=Z,Z.prototype._isoX=0,Z.prototype._isoY=0,Z.prototype._isoZ=0,Z.prototype._isoW=0,Z.prototype._isoH=0,Object.addProperty(Z.prototype,"isoX",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._isoX},function(a){this._isoX=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ,Bb.project(this._isoX,this._isoY,this._isoZ,this)}),Object.addProperty(Z.prototype,"isoY",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._isoY},function(a){this._isoY=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ,Bb.project(this._isoX,this._isoY,this._isoZ,this)}),Object.addProperty(Z.prototype,"isoZ",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._isoZ},function(a){this._isoZ=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ,Bb.project(this._isoX,this._isoY,this._isoZ,this)}),Object.addProperty(Z.prototype,"isoW",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._isoW},function(a){this._isoW=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ}),Object.addProperty(Z.prototype,"isoH",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._isoH},function(a){this._isoH=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ});var Cb=jb.Storage=new f;Cb.TYPES=[Cb.STRING=1,Cb.OBJECT=2],Cb._set=function(a,b,c,d,e){e(new jb.Error.NotImplemented)},Cb._get=function(a,b,c){c(new jb.Error.NotImplemented)},Cb._remove=function(a,b,c){c(new jb.Error.NotImplemented)},Cb._clear=function(a,b){b(new jb.Error.NotImplemented)},Cb.set=function(a,b,c,d){c=c||jb.NOP,d=d||jb.NOP;var e="string"==typeof b?Cb.TEXT:Cb.OBJECT;return Cb._set(a,b,e,c,d),Cb},Cb.get=function(a,b,c){return b=b||jb.NOP,c=c||jb.NOP,Cb._get(a,b,c),Cb},Cb.remove=function(a,b,c){return b=b||jb.NOP,c=c||jb.NOP,Cb._remove(a,b,c),Cb},Cb.clear=function(a,b){return a=a||jb.NOP,b=b||jb.NOP,Cb._clear(a,b),Cb},function(a,b){function c(a){a()}function d(a){a(new b)}function e(a,b,c,d){o.open(l,function(e){if(e){null===b&&(b=n);var f=e.put(b,a);f.onerror=d,f.onsuccess=c}else d&&d()},d)}function f(a,b,c){o.open(m,function(d){if(d){var e=d.get(a);e.onerror=c,e.onsuccess=function(a){var d=a.target.result;return"undefined"==typeof d?(console.log(a.target),c()):(d===n&&(d=null),void b(d))}}else c()},c)}function g(a,b,c){o.open(l,function(d){var e=d.delete(a);e.onerror=c,e.onsuccess=b},c)}function h(a,b){o.open(l,function(c){var d=c.clear();d.onerror=b,d.onsuccess=a},b)}if(!a._implemented){var i=this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.msIndexedDB,j=this.IDBTransaction||this.webkitIDBTransaction,k=this.IDBFactory;if(i){a._implemented="html-indexeddb";var l=j.READ_WRITE||"readwrite",m=j.READ_ONLY||"readonly",n="__null__sjh12o384187r1tpgugq",o={NEW_API:!(!k||!k.prototype.deleteDatabase),DB_NAME:"SGP_Storage",DB_VERSION:1,STORE_NAME:"SGP",idb:null,open:function(a,b,c){if(this.idb)return this.transaction(a,b,c);var d=this.NEW_API?i.open(this.DB_NAME,this.DB_VERSION):i.open(this.DB_NAME);d.onupgradeneeded=function(a){a.target.result.createObjectStore(o.STORE_NAME)},d.onerror=c,d.onsuccess=function(d){var e=o.idb=d.target.result;if(o.NEW_API||o.DB_VERSION===parseInt(e.version))return o.transaction(a,b,c);var f=e.setVersion(o.DB_VERSION);f.onerror=c,f.onsuccess=function(d){e.createObjectStore(o.STORE_NAME),d.target.transaction.onsuccess=o.transaction.bind(o,a,b,c)}}},transaction:function(a,b,c){if(!this.idb)throw new ReferenceError;a=a||l;try{var d=a===l?l:m,e=this.idb.transaction(o.STORE_NAME,d),f=e.objectStore(o.STORE_NAME);b(f)}catch(g){c?c():b&&b()}}};a._set=function(a,b,f,g,h){g=c.bind(null,g),h=d.bind(null,h),e(a,b,g,h)},a._get=function(a,b,c){c=d.bind(null,c),f(a,b,c)},a._remove=function(a,b,e){b=c.bind(null,b),e=d.bind(null,e),g(a,b,e)},a._clear=function(a,b){a=c.bind(null,a),b=d.bind(null,b),h(a,b)}}}}.call(this,jb.Storage,jb.Error),function(a,b,c){function d(a){a()}function e(a,b){a(b)}function f(b,d,e,g,h,i){var j=arguments;if(i=i||1,e===a.OBJECT&&"string"!=typeof d)try{d=JSON.stringify(d)}catch(l){return h(l)}var m=setTimeout(function(){return g=c,h=c,1===i?f(b,d,e,j[3],j[4],2):void j[4]()
},700);g=function(){clearTimeout(m),j[3]()},h=function(){clearTimeout(m),j[4].apply(null,arguments)},k.open("readwrite",function(){k.executeSql("INSERT OR REPLACE INTO {} (key, value, type) VALUES (?,?,?)".format(escape(k.STORE_NAME)),[b,d,e],g,h)},h)}function g(b,c,d){k.open("readonly",function(){function e(b,e){if(!e.rows.length)return d();var f=e.rows.item(0),g=f.value;f.type===a.OBJECT&&(g=JSON.parse(g)),c(g)}k.executeSql("SELECT value, type FROM {} WHERE key=?".format(escape(k.STORE_NAME)),[b],e,d)},d)}function h(a,b,c){k.open("readwrite",function(){k.executeSql("DELETE FROM {} WHERE key=?".format(escape(k.STORE_NAME)),[a],b,c)},c)}function i(a,b){k.open("readwrite",function(){k.executeSql("DELETE FROM {}".format(escape(k.STORE_NAME)),null,a,b)},b)}if(!a._implemented){var j=this.openDatabase||this.openDatabaseSync;if(j){a._implemented="html-websql";var k={ASYNC_MODE:!!this.openDatabase,DB_NAME:"SGP_Storage",DB_VERSION:"2.0",STORE_NAME:"SGP",sqldb:null,tx:null,open:function(a,b,c){function d(){k.executeSql("DROP TABLE IF EXISTS {}".format(escape(k.STORE_NAME)),null,e,c)}function e(){k.transaction("readwrite",function(){k.executeSql("CREATE TABLE IF NOT EXISTS {} (key TEXT PRIMARY KEY, value TEXT, type INTEGER)".format(escape(k.STORE_NAME)),null,b,c)},c)}return this.sqldb?this.transaction(a,b,c):(this.sqldb=j(this.DB_NAME,"",this.DB_NAME,1048576),void(this.sqldb.version!==k.DB_VERSION?this.sqldb.changeVersion(this.sqldb.version,k.DB_VERSION,function(a){k.tx=a,d()},c):e()))},transaction:function(a,b){var c=this,d="readonly"===a?"readTransaction":"transaction";this.sqldb[d](function(a){c.tx=a,b()})},executeSql:function(a,b,c,d){if(b=b||[],this.ASYNC_MODE)this.tx.executeSql(a,b,c,d);else try{var e=this.tx.executeSql(a,b);c(this.tx,e)}catch(f){d(f)}}};a._set=function(a,b,c,g,h){g=d.bind(null,g),h=e.bind(null,h),f(a,b,c,g,h)},a._get=function(a,b,c){c=e.bind(null,c),g(a,b,c)},a._remove=function(a,b,c){b=d.bind(null,b),c=e.bind(null,c),h(a,b,c)},a._clear=function(a,b){a=d.bind(null,a),b=e.bind(null,b),i(a,b)}}}}.call(this,jb.Storage,jb.Error,jb.NOP),jb.Motion=function(a){function b(b){a.call(this,b),this.alpha=0,this.beta=0,this.gamma=0,this.acceleration={x:0,y:0,z:0,alpha:0,beta:0,gamma:0}}return b.ORIENTATION="orientation",b.MOTION="motion",gb.extend(b,a),b.property({alpha:0,beta:0,gamma:0,acceleration:{x:0,y:0,z:0,alpha:0,beta:0,gamma:0},isEnabled:!1}),b.method({enable:function(){return this.isEnabled?!1:(this.isEnabled=!0,!0)},disable:function(){return this.isEnabled?(this.isEnabled=!1,!0):!1},toggle:function(){this.isEnabled?this.disable():this.enable()},destroy:function(){this.disable(),a.prototype.destroy.call(this)},getScreenOrientation:function(a){void 0===a&&(a={});lb.screen.orientation;switch(jb.Device.screen.orientation){case 0:a.alpha=this.alpha,a.gamma=this.gamma,a.beta=this.beta;break;case 90:a.alpha=(this.alpha-90)%360,a.gamma=this.beta,a.beta=-this.gamma;break;case 180:a.alpha=(this.alpha-180)%360,a.gamma=-this.gamma,a.beta=-this.beta;break;case-90:a.alpha=(this.alpha+90)%360,a.gamma=-this.beta,a.beta=this.gamma}return a}}),b}(f),function(a){function b(b){for(var c=e(b.alpha),f=e(b.beta),g=e(b.gamma),h=0,i=d.length;i>h;h++){var j=d[h];(j.alpha!==c||j.beta!==f||j.gamma!==g)&&(j.alpha=c,j.beta=f,j.gamma=g,j.trigger(a.ORIENTATION,j))}}function c(b){for(var c=b.rotationRate,f=b.acceleration,g=e(c.alpha),h=e(c.beta),i=e(c.gamma),j=e(f.x),k=e(f.y),l=e(f.z),m=0,n=d.length;n>m;m++){var o=d[m],f=o.acceleration;(f.alpha!==g||f.beta!==h||f.gamma!==i||f.x!==j||f.y!==k||f.z!==l)&&(f.alpha=g,f.beta=h,f.gamma=i,f.x=j,f.y=k,f.z=l,o.trigger(a.MOTION,f))}}var d=[],e=Math.round;a.decorate({enable:function(){return this._super()?(d.add(this),1===d.length&&(window.addEventListener("deviceorientation",b),window.addEventListener("devicemotion",c)),!0):!1},disable:function(){return this._super()?(d.remove(this),d||(window.removeEventListener("deviceorientation",b),window.removeEventListener("devicemotion",c)),!0):!1}})}(jb.Motion);var Db;jb.Animation=$,$.START="start",$.END="end",$.prototype=Object.create(f.prototype),Object.addProperty($.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,$),Object.addProperty($.prototype,"_mutable",Object.CONFIGURABLE,!0),$.prototype.autoplay=!1,$.prototype.autodestroy=!1,$.prototype.duration=1e3,Object.addProperty($.prototype,"_playing",Object.CONFIGURABLE,!1),Object.addProperty($.prototype,"playing",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._playing},null),Object.addProperty($.prototype,"_paused",Object.CONFIGURABLE,!1),Object.addProperty($.prototype,"paused",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._paused},null),Object.addProperty($.prototype,"_loop",Object.CONFIGURABLE|Object.WRITABLE,!1),Object.addProperty($.prototype,"loop",Object.CONFIGURABLE|Object.ENUMERABLE,function(){return this._loop},function(a){this._loop=a,this._impl&&this._impl.setLoop(a)}),$.prototype.reverse=!1,$.prototype.onEnd=function(){this._playing=!1,this._paused=!1,this.trigger($.END),this.autodestroy&&this.destroy()},$.prototype.play=function(){this._playing=!0,this._paused=!1,this.trigger($.START),this._impl&&this._impl.play()},$.prototype.pause=function(){this._playing=!1,this._paused=!0,this._impl&&this._impl.pause()},$.prototype.stop=function(){this.onEnd(),this._impl&&this._impl.stop()},$.prototype.destroy=function(){this.playing&&this.stop(),this._mutable=!1,f.prototype.destroy.call(this),this._impl&&this._impl.destroy()},Object.preventExtensions($.prototype),jb.ready(function(){}),$.Group=_,_.setMutableDeep=function(a,b){if(a._mutable=b,a instanceof _)for(var c=a.animations,d=0,e=c.length;e>d;d++)_.setMutableDeep(c[d],b)},_.prototype=Object.create($.prototype),Object.addProperty(_.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,_),_.prototype.animations=null,_.prototype.duration=0,_.prototype.destroy=function(){$.prototype.destroy.call(this);for(var a=0,b=this.animations.length;b>a;a++)this.animations[a].destroy()},Object.preventExtensions(_.prototype),jb.SequentialAnimation=$.Sequential=ab,ab.getTotalDuration=function(a){for(var b=0,c=a.animations,d=0,e=c.length;e>d;d++)b+=c[d].duration;return b},ab.prototype=Object.create(_.prototype),Object.addProperty(ab.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,ab),Object.preventExtensions(ab.prototype),jb.ParallelAnimation=$.Sequential=bb,bb.getMaxDuration=function(a){for(var b=0,c=a.animations,d=0,e=c.length;e>d;d++)b=Math.max(b,c[d].duration);return b},bb.prototype=Object.create(_.prototype),Object.addProperty(bb.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,bb),Object.preventExtensions(bb.prototype),jb.PropertyAnimation=$.Property=cb,cb.Easing={linear:1,inQuad:4,outQuad:5,inOutQuad:6,outInQuad:7,inCubic:8,outCubic:9,inOutCubic:10,outInCubic:11,inQuart:16,outQuart:17,inOutQuart:18,outInQuart:19,inQuint:32,outQuint:33,inOutQuint:34,outInQuint:35,inSine:64,outSine:65,inOutSine:66,outInSine:67,inExpo:128,outExpo:129,inOutExpo:130,outInExpo:131,inCirc:256,outCirc:257,inOutCirc:258,outInCirc:259,inElastic:512,outElastic:513,inOutElastic:514,outInElastic:515,inBack:1024,outBack:1025,inOutBack:1026,outInBack:1027,inBounce:2048,outBounce:2049,inOutBounce:2050,outInBounce:2051},cb.prototype=Object.create($.prototype),Object.addProperty(cb.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,cb),cb.prototype.target=null,cb.prototype.property="",cb.prototype.updateProperty=!1,cb.prototype.easing=cb.Easing.linear,Object.preventExtensions(cb.prototype),jb.NumberAnimation=cb.Number=db,db.AUTO="auto",db.prototype=Object.create(cb.prototype),Object.addProperty(db.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,db),db.prototype.from=db.AUTO,db.prototype.to=0,Object.preventExtensions(db.prototype),H.prototype.animate=function(){var a={};return function(b,c,d,e){if(void 0===e&&(Object.isObject(d)?(e=d,d=void 0):Object.isObject(c)?(e=c,c=void 0):Object.isObject(b)&&(e=b,b=void 0)),a.autoplay=!0,a.autodestroy=!0,a.target=this,void 0!==b&&(a.property=b),void 0!==c&&(a.to=c),void 0!==d&&(a.duration=d),void 0!==e&&Object.merge(a,e),"number"!=typeof this[a.property])throw new jb.Error("Property `{}` in Node is not animatable".format(a.property));var f=db(a);return Object.clear(a),f}}(),Db=Db||function(){function a(){this._reversed=!1}return a.prototype={constructor:a,_reversed:!1,_stopped:!1,timer:null,reverse:!1,loop:!1,duration:0,initialize:function(a){this.duration=a.duration,this.reverse=a.reverse,this.setLoop(a.loop)},_update:function(){throw"Not implemented"},_reverse:function(){this._reversed=!this._reversed},_onStep:function(){this._update(Math.min(1,Math.max(0,this.timer.progress/this.timer.duration)))},_onLoop:function(){this.reverse&&this._reverse()},_onStop:function(){this._stopped||!this.reverse||this._reversed?(this._reversed&&this._reverse(),!this._stopped&&this.onEnd&&this.onEnd()):(this._reverse(),this.timer.play())},setLoop:function(a){this.loop=a,this.timer&&(this.timer.loop=a)},play:function(){this.timer=this.timer||new jb.Timer({type:jb.Timer.VSYNC,on:{step:this._onStep.bind(this),loop:this._onLoop.bind(this),stop:this._onStop.bind(this)}}),this.timer.duration=this.duration,this.timer.loop=this.loop,this.timer.play()},pause:function(){this.timer.pause()},stop:function(){this._stopped=!0,this.timer.stop(),this._stopped=!1}},a}(),Db&&function(){function a(){b.call(this)}var b=Db;b.PropertyAnimation=a,a.prototype=Object.merge(Object.create(b.prototype),{constructor:a,easing:null,initialize:function(c){b.prototype.initialize.call(this,c),this.easing=a.Easing[c.easing]}})}(),Db&&function(){function a(a,b,c){var d=.3;if(0===a)return b;if(1===a)return b+c;var e=d/(2*Math.PI)*Math.asin(1);return-(c*Math.pow(2,10*(a-1))*Math.sin(2*(a-1-e)*Math.PI/d))+b}function b(a,b,c){var d=.3;if(0===a)return 0;if(1===a)return 1;var e=d/(2*Math.PI)*Math.asin(1);return c*Math.pow(2,-10*a)*Math.sin(2*(a-e)*Math.PI/d)+c+b}function c(a,b){return 1/2.75>a?7.5625*b*a*a:2/2.75>a?(a-=1.5/2.75,b*(7.5625*a*a+.75)):2.5/2.75>a?(a-=2.25/2.75,b*(7.5625*a*a+.9375)):(a-=2.625/2.75,b*(7.5625*a*a+.984375))}var d=Object.clone(jb.PropertyAnimation.Easing);Db.PropertyAnimation.Easing=d,d[d.linear]=function(a){return a};var e=d[d.inQuad]=function(a){return a*a},f=d[d.outQuad]=function(a){return-a*(a-2)};d[d.inOutQuad]=function(a){return a*=2,1>a?a*a/2:(a--,-.5*(a*(a-2)-1))},d[d.outInQuad]=function(a){return.5>a?f(2*a)/2:e(2*a-1)/2+.5};var g=d[d.inCubic]=function(a){return a*a*a},h=d[d.outCubic]=function(a){return a--,a*a*a+1};d[d.inOutCubic]=function(a){return a*=2,1>a?.5*a*a*a:(a-=2,.5*(a*a*a+2))},d[d.outInCubic]=function(a){return.5>a?h(2*a)/2:g(2*a-1)/2+.5};var i=d[d.inQuart]=function(a){return a*a*a*a},j=d[d.outQuart]=function(a){return a--,-(a*a*a*a-1)};d[d.inOutQuart]=function(a){return a*=2,1>a?.5*a*a*a*a:(a-=2,-.5*(a*a*a*a-2))},d[d.outInQuart]=function(a){return.5>a?j(2*a)/2:i(2*a-1)/2+.5};var k=d[d.inQuint]=function(a){return a*a*a*a*a},l=d[d.outQuint]=function(a){return a-=1,a*a*a*a*a+1};d[d.inOutQuint]=function(a){return a*=2,1>a?.5*a*a*a*a*a:(a-=2,.5*(a*a*a*a*a+2))},d[d.outInQuint]=function(a){return.5>a?l(2*a)/2:k(2*a-1)/2+.5};var m=d[d.inSine]=function(a){return 1===a?1:-Math.cos(a*Math.PI/2)+1},n=d[d.outSine]=function(a){return Math.sin(a*Math.PI/2)};d[d.inOutSine]=function(a){return-.5*(Math.cos(Math.PI*a)-1)},d[d.outInSine]=function(a){return.5>a?n(2*a)/2:m(2*a-1)/2+.5};var o=d[d.inExpo]=function(a){return 0===a||1===a?a:Math.pow(2,10*(a-1))-.001},p=d[d.outExpo]=function(a){return 1===a?1:1.001*(-Math.pow(2,-10*a)+1)};d[d.inOutExpo]=function(a){return 0===a||1===a?a:(a*=2,1>a?.5*Math.pow(2,10*(a-1))-5e-4:.50025*(-Math.pow(2,-10*(a-1))+2))},d[d.outInExpo]=function(a){return.5>a?p(2*a)/2:o(2*a-1)/2+.5};var q=d[d.inCirc]=function(a){return-(Math.sqrt(1-a*a)-1)},r=d[d.outCirc]=function(a){return a--,Math.sqrt(1-a*a)};d[d.inOutCirc]=function(a){return a*=2,1>a?-.5*(Math.sqrt(1-a*a)-1):(a-=2,.5*(Math.sqrt(1-a*a)+1))},d[d.outInCirc]=function(a){return.5>a?r(2*a)/2:q(2*a-1)/2+.5},d[d.inElastic]=function(b){return a(b,0,1)},d[d.outElastic]=function(a){return b(a,0,1)},d[d.inOutElastic]=function(a){var b=.3*1.5;if(0===a)return 0;if(a*=2,2===a)return 1;var c=b/(2*Math.PI)*Math.asin(1);return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(2*(a-1-c)*Math.PI/b):Math.pow(2,-10*(a-1))*Math.sin(2*(a-1-c)*Math.PI/b)*.5+1},d[d.outInElastic]=function(c){return.5>c?b(2*c,0,.5):a(2*c-1,.5,.5)};var s=1.70158;d[d.inBack]=function(a){return a*a*((s+1)*a-s)},d[d.outBack]=function(a){return a--,a*a*((s+1)*a+s)+1},d[d.inOutBack]=function(a){var b=s;return a*=2,1>a?(b*=1.525,.5*a*a*((b+1)*a-b)):(a-=2,b*=1.525,.5*(a*a*((b+1)*a+b)+2))},d[d.outInBack]=function(a){return.5>a?d[d.outBack](2*a,s)/2:d[d.inBack](2*a-1,s)/2+.5},d[d.inBounce]=function(a){return 1-d[d.outBounce](1-a)},d[d.outBounce]=function(a){return c(a,1)},d[d.inOutBounce]=function(a){return.5>a?d[d.inBounce](2*a)/2:1===a?1:d[d.outBounce](2*a-1)/2+.5},d[d.outInBounce]=function(a){return.5>a?c(2*a,.5):1-c(2-2*a,.5)}}(),Db&&function(){function a(){var b=a.create();return c.call(b),b}var b=Db,c=b.PropertyAnimation;b.createNumberAnimation=function(){return a()},a.prototype=Object.merge(Object.create(c.prototype),{constructor:a,from:0,to:0,target:null,property:"",initialize:function(a){c.prototype.initialize.call(this,a),this.from=a.from,this.to=a.to,this.target=a.target,this.property=a.property},_reverse:function(){c.prototype._reverse.call(this);var a=this.to;this.to=this.from,this.from=a},_update:function(a){this.target[this.property]=this.easing(a)*(this.to-this.from)+this.from},destroy:function(){a.free(this)}})}(),Db&&function(){function a(){b.call(this),this._times=this._times||[],this._times.clear(),this._animations=this._animations||[],this._animations.clear()}var b=Db;b.AnimationsGroup=a,a.prototype=Object.merge(Object.create(b.prototype),{constructor:a,_times:null,_animations:null,initialize:function(a){b.prototype.initialize.call(this,a);for(var c=a.animations,d=0,e=c.length;e>d;d++)this._times.push(0),this._animations.push(c[d]._impl)},_reverse:function(){b.prototype._reverse.call(this);for(var a=this._times,c=this._animations,d=this.duration,e=0,f=a.length;f>e;e++)a[e]=d-c[e].duration-a[e],c[e]._reverse();a.reverse(),c.reverse()},_update:function(a){for(var b=a*this.duration,c=this._times,d=this._animations,e=0,f=c.length;f>e;e++){var g=c[e],h=d[e];if(!(g>b)){var a=(b-g)/h.duration;h._update(Math.min(1,a))}}}})}(),Db&&function(){function a(){var b=a.create();return c.call(b),b}var b=Db,c=b.AnimationsGroup;b.createParallelAnimation=function(){return a()},a.prototype=Object.merge(Object.create(c.prototype),{constructor:a,destroy:function(){a.free(this)}})}(),Db&&function(){function a(){var b=a.create();return c.call(b),b}var b=Db,c=b.AnimationsGroup;b.createSequentialAnimation=function(){return a()},a.prototype=Object.merge(Object.create(c.prototype),{constructor:a,initialize:function(a){c.prototype.initialize.call(this,a);for(var b=a.animations,d=0,e=0,f=b.length;f>e;e++)this._times[e]=d,d+=b[e].duration},destroy:function(){a.free(this)}})}();var Eb=jb.Sna={};return Eb.BYTESPERPIXEL=4,Eb.FRAMEDELAY=80,Eb.DURATION="duration",Eb.SOUND="sound",Eb.TICK=1,jb.Sna.Resource=function(a){function b(b){this.sets=null,this.states=null,a.call(this,b)}var c={};return gb.extend(b,a),b.property({type:"data"}),b.method({getState:function(a){return this.states&&this.states.hasOwnProperty(a)?this.states[a]:null}}),b.load=function(a){return c.hasOwnProperty(a)?c[a]:c[a]=new b({src:a})},b}(jb.Network.Resource),jb.Sna.Animation=function(a,b,c,d,e){function f(a){var c=a&&a.loop?a.loop:null;this.begin=c?parseInt(c[0])||0:0,this.end=c?parseInt(c[1])||0:0,this.cycle=c?c[2]>=0?h:g:h,this.repeat=c?0===c[2]||-1===c[2]?1/0:e(c[2]):0,this.last=d(a&&a.length>=1?parseInt(a.length)-1||0:0,this.end),this.number=this.repeat,this.direction=1,this.frame=0,b.call(this,a)}var g=1,h=2,i="frame";return gb.extend(f,b),f.property({type:b.VSYNC,loop:!0,delay:a.FRAMEDELAY,duration:a.FRAMEDELAY,onloop:function(){var a=this.frame;switch(this.cycle){case h:a=a===this.end&&--this.number>0?this.begin:a+this.direction;break;case g:a===this.begin&&a+this.direction<this.begin?--this.number>0?(this.direction*=-1,a+=this.direction):(this.direction=1,a=this.end+this.direction):a===this.end&&a+this.direction>this.end?--this.number>0?(this.direction*=-1,a+=this.direction):(this.direction=1,a+=this.direction):a+=this.direction}return 0>a||a>this.last?this.stop():(this.frame=a,void this.trigger(i,this.frame))}}),f.method({setFrame:function(a){return a=parseInt(a)||0,this.frame===a?!1:(this.frame=a,this.trigger(i,a),!0)},setLoop:function(a){null===a?(this.begin=0,this.end=0,this.cycle=g,this.repeat=0,this.last=0,this.reset(),this.stop()):(this.begin=a?parseInt(a[0])||0:0,this.end=a?parseInt(a[1])||0:0,this.cycle=a?a[2]>=0?h:g:h,this.repeat=a?0===a[2]||-1===a[2]?1/0:e(a[2]):0,this.last=d(this.last,this.end),this.reset(),this.play())},reset:function(){this.direction=1,this.number=this.repeat,this.frame=0,this.trigger(i,this.frame),this._super()},play:function(){return this.repeat&&this._super()?(this.trigger(i,this.frame),!0):!1},stop:function(){return this._super()?(this.frame=0,this.trigger(i,this.frame),!0):!1}}),f}(jb.Sna,jb.Timer,Math.min,Math.max,Math.abs),eb.prototype={buffer:null,index:0,current:function(){return this.index<0||this.index>=this.buffer.length?null:eb.decodeFrame(this.buffer[this.index])},next:function(){if(this.index<0||this.index>=this.buffer.length)return null;var a=eb.decodeNext(this.buffer[this.index]);return this.index=a,this.current()},rewind:function(){this.index=0}},eb._bufferCache={},eb.generateBuffer=function(a,b,c,d){if(0===c)var e=a+(b-a+1);else if(-1==c)var e=a+2*(b-a);else if(c>0)var e=a+(b-a+1)*c+(d-b-1);else if(0>c)var e=a+(b-a)*-c+1+(d-b-1);for(var f=hb("int",256,e),g=0;a>g;g++)f[g]=eb.encode(g,g+1);if(0===c){for(;b>g;g++)f[g]=eb.encode(g,g+1);f[g]=eb.encode(g,g+a-b)}else if(-1===c){for(var h=g,i=g;b>i;i++,g++)f[g]=eb.encode(i,g+1);for(;i>a+1;i--,g++)f[g]=eb.encode(i,g+1);f[g]=eb.encode(i,h)}else if(c>0){for(var j=0;c>j;j++)for(var i=a;b>=i;i++,g++)f[g]=eb.encode(i,g+1);for(var i=b+1;d>i;i++,g++)f[g]=eb.encode(i,g+1)}else if(0>c){for(var j=0,k=1,i=a;j>c;j--,k*=-1){for(;i>=a&&b>=i;i+=k,g++)f[g]=eb.encode(i,g+1);i=Math.max(a+1,i),i=Math.min(b-1,i)}for(var i=b+1;d>i;i++,g++)f[g]=eb.encode(i,g+1)}return f},eb.getBuffer=function(a,b,c,d){var e="{},{},{},{}".format(a,b,c,d);return eb._bufferCache.hasOwnProperty(e)||(eb._bufferCache[e]=eb.generateBuffer(a,b,c,d)),eb._bufferCache[e]},eb.encode=function(a,b){return a=255&a,b=255&b,(b<<8)+a},eb.decodeNext=function(a){return a>>8&255},eb.decodeFrame=function(a){return 255&a},jb.Sna.Iterator=eb,jb.Sna.Layer=fb,fb.prototype=Object.create(K.prototype),Object.addProperty(fb.prototype,"constructor",fb),fb.prototype.setFrame=function(a){if(a=+a||0,this.frame===a)return!1;this.frame=a;var b=this.frames[this.frame]||null;return b&&(this.x=b.x,this.y=b.y,this.width=b.w,this.height=b.h),!0},jb.Sna.Sound=function(){function a(b){var c=this instanceof a?this:a.create(),d=0,e=b&&"frames"in b?b.frames:"",f=Array.isArray(e)?e[d]||"":e,g=!Array.isArray(e);return c._sound=null,c.loop=g,c.frames=e,g&&c._playSound(f),H.call(c,b),c}return a.BASE="",a.prototype=Object.create(H.prototype),a.prototype.constructor=a,a.prototype._sound=null,a.prototype.loop=!1,a.prototype.frames=null,a.prototype._playSound=function(b){this._sound=Y({sound:a.BASE+b,autoplay:!0,loop:this.loop})},a.prototype.setFrame=function(a){if(this.loop)return!0;var b=this.frames,c=b&&b[a]||null;return this._sound&&(this._sound.destroy(),this._sound=null),c?(this._playSound(c),!0):!1},a.prototype.destroy=function(){this._sound&&this._sound.destroy(),H.prototype.destroy.call(this)},a}(),jb.Sna.Node=function(a,b,c,d,e,f){function g(a){this.state=String(a&&"state"in a?a.state:this.state),this.src=String(a&&"src"in a?a.src:this.src),this.sound=Boolean(a&&"sound"in a?a.sound:this.sound),this.animation=new e,b.call(this,a);var c=this;this.animation.on("stop",function(){c.trigger("stop")}),this.animation.on("frame",function(a){c.trigger("frame",a)}),this.on("frame",h),this.on("load",i),this.on("error",j),this.onLoad=function(){c.trigger("load")},m(this,this.src)}function h(b){var e=c.load(this.src).getState(this.state);if(!e)return!1;this.animation.duration=this.animation.delay=a.FRAMEDELAY*o(self,e.duration,b)*this.tick*a.TICK;for(var g=this.children,h=g.length;h-->0;){var i=g[h];(i instanceof d||i instanceof f)&&i.setFrame(b)}}function i(){l(this),k(this,this.state)}function j(){}function k(b,e){var g=c.load(b.src).states;if(!g)return!1;var h=g.hasOwnProperty(e)?g[e]:null;if(!h)return!1;var i=h.layers||null;if(i)for(var j in i)b.appendChild(new d(i[j]));var k=h.sound||null;return b.sound&&k&&b.appendChild(f({frames:k,width:h.width,height:h.height})),b.animation.setLoop(h.loop),b.width=h.width,b.height=h.height,b.trigger(a.READY),!0}function l(a){for(var b=a.children,c=b.length;c-->0;){var e=b[c];switch(!0){case e instanceof d:case e instanceof f:e.destroy()}}return a.animation.setLoop(null),!0}function m(a,b){var d=c.load(b);d.on("load",a.onLoad),d.complete&&k(a,a.state)}function n(a,b){c.load(b).off("load",a.onLoad)}function o(a,b,c){return"number"==typeof b?+b||1:null!==b&&null!==b[c]?+b[c]||1:1}return a.READY="ready",gb.extend(g,b),g.prototype=Object.create(b.prototype),Object.addProperty(g.prototype,"constructor",g),g.prototype.tick=1,g.prototype.state="",g.prototype.src="",g.prototype.opacity=1,g.prototype.sound=!0,Object.addProperty(g.prototype,"states",function(){return c.load(this.src).states},null),g.prototype.setLoop=function(a){this.animation.setLoop(a)},g.prototype.setState=function(a){return a=String(a),a===this.state?!1:(this.state=a,l(this),void k(this,a))},g.prototype.setSrc=function(a){return a=String(a),this.src===a?!1:(n(this,this.src),this.src=a,void m(this,a))},g}(jb.Sna,jb.Node,jb.Sna.Resource,jb.Sna.Layer,jb.Sna.Animation,jb.Sna.Sound,Math.min,Math.max),function(a,b){b.parseMeta=function(a){for(var c={sets:[],states:{}},d=0,e=c.states,f=(c.sets,0);f<a.length;f++){for(var g=a[f],h=g[2],i=g[3],j={name:g[0],loop:g[1],layers:{},duration:1,sound:null,width:h[0],height:h[1]},k=0;k<i.length;k++){var l=i[k],m=l[0];switch(m){case b.DURATION:j.duration=l[1];break;case b.SOUND:j.sound=l[1];break;default:for(var n=l[1],o=j.layers[m]={frames:[],width:h[0],height:h[1]},p=0;p<n.length;p++){for(var q=n[p],r=q[0],s=q[1],t=q[2];r<o.length;)o.push(u);var u={x:s[0],y:s[1],w:s[2],h:s[3],offset:d,diff:t};o.frames.push(u);for(var v=0;v<t.length;v++){var w=t[v];d+=w[2]*w[3]*b.BYTESPERPIXEL}}j.layers[m]=o,c.sets.push(o)}}e[j.name]=j}return c},b.parseSets=function(a,c,d){for(var e=jb.Renderer.ctx,f=e.canvas,g=0;g<a.length;g++)for(var h=a[g],i=h.frames,j=e.createImageData(h.width,h.height),k=j.data,l=0;l<i.length;l++){for(var m=i[l],n=m.diff,o=0;o<n.length;o++)for(var p=n[o],q=p[0],r=p[1],s=p[2],t=p[3],u=0;t>u;u++)for(var v=b.BYTESPERPIXEL*((r+u)*h.width+q),w=0;s>w;w++)for(var x=0;x<b.BYTESPERPIXEL;x++)k[v++]^=c[d++];f.width=m.w,f.height=m.h,e.putImageData(j,-m.x,-m.y,m.x,m.y,m.w,m.h),m.canvas=new window.Image,m.canvas.src=f.toDataURL()}return a}}(jb.Renderer,jb.Sna),function(a,b,c,d){b.decorate("initialize",function(a){this._super(a),this.offset=0}),b.decorate("onload",function(b){this.offset=2+(b[0]<<8)+b[1];var c=b.subarray||b.slice,e=d.unpack(c.call(b,2,this.offset)),f=a.parseMeta(e);this.states=f.states,this.sets=f.sets,a.parseSets(this.sets,b,this.offset),this._super(null)})}(jb.Sna,jb.Sna.Resource,jb.Renderer,msgpack),fb.prototype.render=function(a){H.prototype.render.call(this,a);var b=this.frames[this.frame]||null,c=b&&b.canvas;c&&a.drawImage(c,0,0)},fb.prototype.captureUI=jb.Geometry.Shape.prototype.captureUI,fb.override("setFrame",function(a){return function(b){a.call(this,b);var c=this.frames[this.frame]||null;c&&(this.x=c.x,this.y=c.y,this.width=c.w,this.height=c.h)}}),function(a){function b(){this.removeEventListener&&(this.removeEventListener("DOMContentLoaded",b),this.removeEventListener("load",b)),a.start()}this.addEventListener("DOMContentLoaded",b),this.addEventListener("load",b,!1)}.call(this,jb),jb}.call(this,global);
